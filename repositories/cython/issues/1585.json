{
    "assignee": null,
    "assignees": [],
    "body": "In the latest Cython documentation, it says:\r\n\r\n> The libc math library is special in that it is not linked by default on some Unix-like systems, such as Linux. In addition to cimporting the declarations, you must configure your build system to link against the shared library m.\r\n\r\nhttp://cython.readthedocs.io/en/latest/src/tutorial/external.html#dynamic-linking\r\n\r\nNow, I tried to compile this sample snippet which cimports from libc.math, on a Ubuntu 16.04 machine:\r\n\r\n```cython\r\nfrom libc.math cimport sin\r\n\r\ncpdef double sin2(double x):\r\n    return sin(x*x)\r\n```\r\n\r\nI did not link the `m` library in the distutils/setuptools `Extension.libraries`, so the resulting .so file looks like this:\r\n\r\n```sh\r\n$ ldd demo.so \r\n\tlinux-vdso.so.1 =>  (0x00007fff299a8000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f38f9e59000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f38f9a90000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x0000559ffa7c0000)\r\n```\r\n\r\nDespite what the cython docs say, even without explicitly linking the math library, this seems to be working fine when I run it from Python:\r\n\r\n```python\r\nIn [1]: from demo import sin2\r\n\r\nIn [2]: sin2(0.2)\r\nOut[2]: 0.03998933418663417\r\n```\r\n\r\nI'm thinking this works because python itself is linked with libm:\r\n\r\n```sh\r\n$ ldd /home/cosimolupo/.pyenv/versions/cython-test/bin/python\r\n\tlinux-vdso.so.1 =>  (0x00007ffe683dc000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f22c487a000)\r\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f22c4676000)\r\n\tlibutil.so.1 => /lib/x86_64-linux-gnu/libutil.so.1 (0x00007f22c4472000)\r\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f22c4169000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f22c3da0000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00005614020d7000)\r\n```\r\n\r\nThe question is then, does the recommendation to link 'm' library when compiling extension modules on Unix still hold?\r\n\r\nThe reason I ask is because I'm wrapping a C library which does require linking with the C math library, but my extension module does not use math directly.\r\n\r\nShould I add 'm' to the Extension libraries? Should I only do it if self.compiler.compiler_type == \"unix\"?\r\n\r\nThanks\r\n",
    "closed_at": "2017-01-18T17:30:57Z",
    "comment_data": [
        {
            "body": "I forgot to mention, I'm building the wrapped C library from source and statically linking it with my python extension module wrapper, so I am trying to replicate the compiler/linker flags in the original library's Makefile via distutils/setuptools. ",
            "created_at": "2017-01-18T11:28:10Z",
            "html_url": "https://github.com/cython/cython/issues/1585#issuecomment-273451841",
            "id": 273451841,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1585",
            "updated_at": "2017-01-18T11:28:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/273451841",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6939968?v=3",
                "events_url": "https://api.github.com/users/anthrotype/events{/privacy}",
                "followers_url": "https://api.github.com/users/anthrotype/followers",
                "following_url": "https://api.github.com/users/anthrotype/following{/other_user}",
                "gists_url": "https://api.github.com/users/anthrotype/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/anthrotype",
                "id": 6939968,
                "login": "anthrotype",
                "organizations_url": "https://api.github.com/users/anthrotype/orgs",
                "received_events_url": "https://api.github.com/users/anthrotype/received_events",
                "repos_url": "https://api.github.com/users/anthrotype/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/anthrotype/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/anthrotype/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/anthrotype"
            }
        },
        {
            "body": "It's not linked by default on \"some Unix-like systems.\" You can omit it and be fine most of the time, but it won't be as portable. ",
            "created_at": "2017-01-18T17:30:57Z",
            "html_url": "https://github.com/cython/cython/issues/1585#issuecomment-273543211",
            "id": 273543211,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1585",
            "updated_at": "2017-01-18T17:30:57Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/273543211",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "I understand that, and in fact it is not linked by default even here on this particular \"Unix-like system\" whch I'm using, i.e. Ubuntu 16.06.\r\nAt least the ldd tool on the complied *.so says it's not linked with libm, unless I tell distutils to tell gcc to do so.\r\n\r\nStill, I don't understand how come, being _not_ linked, it still works when I import the compiled extension module from Python.\r\n\r\nSorry if I'm dumb, I'm no expert C programmer.",
            "created_at": "2017-01-18T17:35:27Z",
            "html_url": "https://github.com/cython/cython/issues/1585#issuecomment-273544487",
            "id": 273544487,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1585",
            "updated_at": "2017-01-18T17:35:27Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/273544487",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6939968?v=3",
                "events_url": "https://api.github.com/users/anthrotype/events{/privacy}",
                "followers_url": "https://api.github.com/users/anthrotype/followers",
                "following_url": "https://api.github.com/users/anthrotype/following{/other_user}",
                "gists_url": "https://api.github.com/users/anthrotype/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/anthrotype",
                "id": 6939968,
                "login": "anthrotype",
                "organizations_url": "https://api.github.com/users/anthrotype/orgs",
                "received_events_url": "https://api.github.com/users/anthrotype/received_events",
                "repos_url": "https://api.github.com/users/anthrotype/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/anthrotype/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/anthrotype/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/anthrotype"
            }
        },
        {
            "body": "Exactly what gets found when not explicitly linked depends on the platform and the toolchain and the environment (often in surprising ways). I think this note was added due to issues on some platforms that explicitly linking against the math library resolved, but I don't have any examples off-hand. It may be overly cautious, but is always safe, to declare explicit dependencies on those things that you actually depend on. ",
            "created_at": "2017-01-18T19:24:19Z",
            "html_url": "https://github.com/cython/cython/issues/1585#issuecomment-273574182",
            "id": 273574182,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1585",
            "updated_at": "2017-01-18T19:24:19Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/273574182",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "Thanks for the clarification.",
            "created_at": "2017-01-18T19:37:18Z",
            "html_url": "https://github.com/cython/cython/issues/1585#issuecomment-273578010",
            "id": 273578010,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1585",
            "updated_at": "2017-01-18T19:37:18Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/273578010",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6939968?v=3",
                "events_url": "https://api.github.com/users/anthrotype/events{/privacy}",
                "followers_url": "https://api.github.com/users/anthrotype/followers",
                "following_url": "https://api.github.com/users/anthrotype/following{/other_user}",
                "gists_url": "https://api.github.com/users/anthrotype/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/anthrotype",
                "id": 6939968,
                "login": "anthrotype",
                "organizations_url": "https://api.github.com/users/anthrotype/orgs",
                "received_events_url": "https://api.github.com/users/anthrotype/received_events",
                "repos_url": "https://api.github.com/users/anthrotype/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/anthrotype/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/anthrotype/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/anthrotype"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1585/comments",
    "created_at": "2017-01-18T11:25:43Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-01-18T17:30:57Z",
            "event": "closed",
            "id": 927838403,
            "url": "https://api.github.com/repos/cython/cython/issues/events/927838403"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1585/events",
    "html_url": "https://github.com/cython/cython/issues/1585",
    "id": 201546939,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1585/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1585,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "is it necessary to link the libc math library? (-lm)",
    "updated_at": "2017-01-18T19:37:18Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1585",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6939968?v=3",
        "events_url": "https://api.github.com/users/anthrotype/events{/privacy}",
        "followers_url": "https://api.github.com/users/anthrotype/followers",
        "following_url": "https://api.github.com/users/anthrotype/following{/other_user}",
        "gists_url": "https://api.github.com/users/anthrotype/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/anthrotype",
        "id": 6939968,
        "login": "anthrotype",
        "organizations_url": "https://api.github.com/users/anthrotype/orgs",
        "received_events_url": "https://api.github.com/users/anthrotype/received_events",
        "repos_url": "https://api.github.com/users/anthrotype/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/anthrotype/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/anthrotype/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/anthrotype"
    }
}