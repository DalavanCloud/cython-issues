{
    "assignee": null,
    "assignees": [],
    "body": "**test.pyx**\r\n\r\n```python\r\n# cython: c_string_type=unicode, c_string_encoding=utf8, linetrace=True\r\n\r\ncdef class Hello:\r\n    cdef char* _c_test\r\n\r\n    def __cinit__(self):\r\n        self._c_test = \"†\"\r\n\r\n    def __str__(self):\r\n        cdef object ret = self._c_test\r\n        return ret\r\n```\r\n\r\n**run.py**\r\n\r\n```python\r\nimport locale\r\nimport test\r\n\r\nlocale.setlocale(locale.LC_ALL, '')\r\n\r\nh = test.Hello()\r\nprint(h)\r\n```\r\n\r\n---\r\n\r\n**Python 2**\r\n\r\n```python\r\nTraceback (most recent call last):\r\n  File \"run.py\", line 7, in <module>\r\n    print(h)\r\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\u2020' in position 0: ordinal not in range(128)\r\n```\r\n\r\n**Python 3**\r\n\r\n```python\r\n†\r\n```\r\n\r\n---\r\n\r\nIf I will change `object` -> `str` in `def __str__()` it will start working, but I think there is a bug in Cython.",
    "closed_at": null,
    "comment_data": [
        {
            "body": "IMO this is the expected behavior in Python 2. I'd expect to see the same error if the class were implemented in pure Python. `__str__()` should not return a `unicode`. In Python 2, implement `__unicode__()` instead.",
            "created_at": "2016-08-23T16:08:42Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241786003",
            "id": 241786003,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "updated_at": "2016-08-23T16:08:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241786003",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/307683?v=3",
                "events_url": "https://api.github.com/users/codewarrior0/events{/privacy}",
                "followers_url": "https://api.github.com/users/codewarrior0/followers",
                "following_url": "https://api.github.com/users/codewarrior0/following{/other_user}",
                "gists_url": "https://api.github.com/users/codewarrior0/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/codewarrior0",
                "id": 307683,
                "login": "codewarrior0",
                "organizations_url": "https://api.github.com/users/codewarrior0/orgs",
                "received_events_url": "https://api.github.com/users/codewarrior0/received_events",
                "repos_url": "https://api.github.com/users/codewarrior0/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codewarrior0/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codewarrior0/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/codewarrior0"
            }
        },
        {
            "body": "@codewarrior0 is there some example how to make it conditionally?",
            "created_at": "2016-08-23T16:14:25Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241787784",
            "id": 241787784,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "updated_at": "2016-08-23T16:14:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241787784",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2866862?v=3",
                "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}",
                "followers_url": "https://api.github.com/users/ignatenkobrain/followers",
                "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}",
                "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ignatenkobrain",
                "id": 2866862,
                "login": "ignatenkobrain",
                "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs",
                "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events",
                "repos_url": "https://api.github.com/users/ignatenkobrain/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ignatenkobrain"
            }
        },
        {
            "body": "also, should not it automagically change code? I don't use `cdef unicode`, but I use `cdef object` which can be automagically changed during cythonizing to string on py2 and to unicode on py3.",
            "created_at": "2016-08-23T16:28:31Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241791889",
            "id": 241791889,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "updated_at": "2016-08-23T16:28:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241791889",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2866862?v=3",
                "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}",
                "followers_url": "https://api.github.com/users/ignatenkobrain/followers",
                "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}",
                "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ignatenkobrain",
                "id": 2866862,
                "login": "ignatenkobrain",
                "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs",
                "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events",
                "repos_url": "https://api.github.com/users/ignatenkobrain/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ignatenkobrain"
            }
        },
        {
            "body": "You could return str(...), where str is the unicode type in Py3 and the\nbytes type in Py2.\n\nOn Tue, Aug 23, 2016 at 9:28 AM, Igor Gnatenko <notifications@github.com>\nwrote:\n\n> also, should not it automagically change code? I don't use cdef unicode,\n> but I use cdef object which can be automagically changed during\n> cythonizing to string on py2 and to unicode on py3.\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/cython/cython/issues/1448#issuecomment-241791889>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/ATqe4kbZ-BO7IpvkMEAS2BivG27zRfWdks5qix-1gaJpZM4JrFvx>\n> .\n>\n> --\n> You received this message because you are subscribed to the Google Groups\n> \"cython-github-notifications\" group.\n> To unsubscribe from this group and stop receiving emails from it, send an\n> email to cython-github-notifications+unsubscribe@googlegroups.com.\n> To post to this group, send email to cython-github-notifications@\n> googlegroups.com.\n> To view this discussion on the web visit https://groups.google.com/d/\n> msgid/cython-github-notifications/cython/cython/issues/1448/241791889%\n> 40github.com\n> <https://groups.google.com/d/msgid/cython-github-notifications/cython/cython/issues/1448/241791889%40github.com?utm_medium=email&utm_source=footer>\n> .\n>\n> For more options, visit https://groups.google.com/d/optout.\n>\n",
            "created_at": "2016-08-24T03:51:28Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241950421",
            "id": 241950421,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "updated_at": "2016-08-24T03:51:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241950421",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/20618978?v=3",
                "events_url": "https://api.github.com/users/cython-notifications/events{/privacy}",
                "followers_url": "https://api.github.com/users/cython-notifications/followers",
                "following_url": "https://api.github.com/users/cython-notifications/following{/other_user}",
                "gists_url": "https://api.github.com/users/cython-notifications/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cython-notifications",
                "id": 20618978,
                "login": "cython-notifications",
                "organizations_url": "https://api.github.com/users/cython-notifications/orgs",
                "received_events_url": "https://api.github.com/users/cython-notifications/received_events",
                "repos_url": "https://api.github.com/users/cython-notifications/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cython-notifications/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cython-notifications/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cython-notifications"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1448/comments",
    "created_at": "2016-08-23T15:54:44Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/307683?v=3",
                "events_url": "https://api.github.com/users/codewarrior0/events{/privacy}",
                "followers_url": "https://api.github.com/users/codewarrior0/followers",
                "following_url": "https://api.github.com/users/codewarrior0/following{/other_user}",
                "gists_url": "https://api.github.com/users/codewarrior0/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/codewarrior0",
                "id": 307683,
                "login": "codewarrior0",
                "organizations_url": "https://api.github.com/users/codewarrior0/orgs",
                "received_events_url": "https://api.github.com/users/codewarrior0/received_events",
                "repos_url": "https://api.github.com/users/codewarrior0/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codewarrior0/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codewarrior0/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/codewarrior0"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-23T16:14:25Z",
            "event": "mentioned",
            "id": 764727851,
            "url": "https://api.github.com/repos/cython/cython/issues/events/764727851"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/307683?v=3",
                "events_url": "https://api.github.com/users/codewarrior0/events{/privacy}",
                "followers_url": "https://api.github.com/users/codewarrior0/followers",
                "following_url": "https://api.github.com/users/codewarrior0/following{/other_user}",
                "gists_url": "https://api.github.com/users/codewarrior0/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/codewarrior0",
                "id": 307683,
                "login": "codewarrior0",
                "organizations_url": "https://api.github.com/users/codewarrior0/orgs",
                "received_events_url": "https://api.github.com/users/codewarrior0/received_events",
                "repos_url": "https://api.github.com/users/codewarrior0/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codewarrior0/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codewarrior0/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/codewarrior0"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-23T16:14:25Z",
            "event": "subscribed",
            "id": 764727852,
            "url": "https://api.github.com/repos/cython/cython/issues/events/764727852"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1448/events",
    "html_url": "https://github.com/cython/cython/issues/1448",
    "id": 172737865,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1448/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1448,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "def __str__(self) doesn't work properly with unicode",
    "updated_at": "2016-08-24T03:51:29Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1448",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2866862?v=3",
        "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}",
        "followers_url": "https://api.github.com/users/ignatenkobrain/followers",
        "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}",
        "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ignatenkobrain",
        "id": 2866862,
        "login": "ignatenkobrain",
        "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs",
        "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events",
        "repos_url": "https://api.github.com/users/ignatenkobrain/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ignatenkobrain"
    }
}