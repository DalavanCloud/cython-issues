{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "**test.pyx**\n\n``` python\n# cython: c_string_type=unicode, c_string_encoding=utf8, linetrace=True\n\ncdef class Hello:\n    cdef char* _c_test\n\n    def __cinit__(self):\n        self._c_test = \"†\"\n\n    def __str__(self):\n        cdef object ret = self._c_test\n        return ret\n```\n\n**run.py**\n\n``` python\nimport locale\nimport test\n\nlocale.setlocale(locale.LC_ALL, '')\n\nh = test.Hello()\nprint(h)\n```\n\n---\n\n**Python 2**\n\n``` python\nTraceback (most recent call last):\n  File \"run.py\", line 7, in <module>\n    print(h)\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\u2020' in position 0: ordinal not in range(128)\n```\n\n**Python 3**\n\n``` python\n†\n```\n\n---\n\nIf I will change `object` -> `str` in `def __str__()` it will start working, but I think there is a bug in Cython.\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "IMO this is the expected behavior in Python 2. I'd expect to see the same error if the class were implemented in pure Python. `__str__()` should not return a `unicode`. In Python 2, implement `__unicode__()` instead.\n",
            "created_at": "2016-08-23T16:08:42Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241786003",
            "id": 241786003,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTc4NjAwMw==",
            "updated_at": "2016-08-23T16:08:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241786003",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/307683?v=4",
                "events_url": "https://api.github.com/users/codewarrior0/events{/privacy}",
                "followers_url": "https://api.github.com/users/codewarrior0/followers",
                "following_url": "https://api.github.com/users/codewarrior0/following{/other_user}",
                "gists_url": "https://api.github.com/users/codewarrior0/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/codewarrior0",
                "id": 307683,
                "login": "codewarrior0",
                "node_id": "MDQ6VXNlcjMwNzY4Mw==",
                "organizations_url": "https://api.github.com/users/codewarrior0/orgs",
                "received_events_url": "https://api.github.com/users/codewarrior0/received_events",
                "repos_url": "https://api.github.com/users/codewarrior0/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codewarrior0/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codewarrior0/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/codewarrior0"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@codewarrior0 is there some example how to make it conditionally?\n",
            "created_at": "2016-08-23T16:14:25Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241787784",
            "id": 241787784,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTc4Nzc4NA==",
            "updated_at": "2016-08-23T16:14:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241787784",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/2866862?v=4",
                "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}",
                "followers_url": "https://api.github.com/users/ignatenkobrain/followers",
                "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}",
                "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ignatenkobrain",
                "id": 2866862,
                "login": "ignatenkobrain",
                "node_id": "MDQ6VXNlcjI4NjY4NjI=",
                "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs",
                "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events",
                "repos_url": "https://api.github.com/users/ignatenkobrain/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ignatenkobrain"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "also, should not it automagically change code? I don't use `cdef unicode`, but I use `cdef object` which can be automagically changed during cythonizing to string on py2 and to unicode on py3.\n",
            "created_at": "2016-08-23T16:28:31Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241791889",
            "id": 241791889,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTc5MTg4OQ==",
            "updated_at": "2016-08-23T16:28:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241791889",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/2866862?v=4",
                "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}",
                "followers_url": "https://api.github.com/users/ignatenkobrain/followers",
                "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}",
                "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ignatenkobrain",
                "id": 2866862,
                "login": "ignatenkobrain",
                "node_id": "MDQ6VXNlcjI4NjY4NjI=",
                "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs",
                "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events",
                "repos_url": "https://api.github.com/users/ignatenkobrain/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ignatenkobrain"
            }
        },
        {
            "author_association": "NONE",
            "body": "You could return str(...), where str is the unicode type in Py3 and the\r\nbytes type in Py2.",
            "created_at": "2016-08-24T03:51:28Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-241950421",
            "id": 241950421,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTk1MDQyMQ==",
            "updated_at": "2018-10-14T08:26:24Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/241950421",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/20618978?v=4",
                "events_url": "https://api.github.com/users/cython-notifications/events{/privacy}",
                "followers_url": "https://api.github.com/users/cython-notifications/followers",
                "following_url": "https://api.github.com/users/cython-notifications/following{/other_user}",
                "gists_url": "https://api.github.com/users/cython-notifications/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cython-notifications",
                "id": 20618978,
                "login": "cython-notifications",
                "node_id": "MDQ6VXNlcjIwNjE4OTc4",
                "organizations_url": "https://api.github.com/users/cython-notifications/orgs",
                "received_events_url": "https://api.github.com/users/cython-notifications/received_events",
                "repos_url": "https://api.github.com/users/cython-notifications/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cython-notifications/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cython-notifications/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cython-notifications"
            }
        },
        {
            "author_association": "NONE",
            "body": "Found this page while Googling for my problem before I realized someone else had already handled it in the codebase I was looking at. In case someone is looking for something similar, we have cases (such as a `__str__` function) that must be a `str` (`unicode`) object in Python 3, but a `str` (`bytes`) object in Python 2. We have a helper function to do the right thing:\r\n\r\nhttps://github.com/seomoz/reppy/blob/ecf82a8935d9bd2ac0c84e8371cbab0cadfb57e9/reppy/robots.pyx#L27-L31",
            "created_at": "2018-10-08T23:27:32Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-428010784",
            "id": 428010784,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyODAxMDc4NA==",
            "updated_at": "2018-10-08T23:27:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/428010784",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/669236?v=4",
                "events_url": "https://api.github.com/users/evanbattaglia/events{/privacy}",
                "followers_url": "https://api.github.com/users/evanbattaglia/followers",
                "following_url": "https://api.github.com/users/evanbattaglia/following{/other_user}",
                "gists_url": "https://api.github.com/users/evanbattaglia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/evanbattaglia",
                "id": 669236,
                "login": "evanbattaglia",
                "node_id": "MDQ6VXNlcjY2OTIzNg==",
                "organizations_url": "https://api.github.com/users/evanbattaglia/orgs",
                "received_events_url": "https://api.github.com/users/evanbattaglia/received_events",
                "repos_url": "https://api.github.com/users/evanbattaglia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/evanbattaglia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/evanbattaglia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/evanbattaglia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> also, should not it automagically change code? I don't use `cdef unicode`, but I use `cdef object` which can be automagically changed during cythonizing to string on py2 and to unicode on py3.\r\n\r\nThe problem in the original example is the `c_string_type=unicode` directive, which globally requests C strings to turn into Python unicode objects on conversion. Whether you then assign the result to an `object` variable or a `unicode` typed variable does not matter.\r\n\r\nI agree that an explicit conversion to the desired type is better here, but I also wonder if allowing a cast to `<str>` wouldn't be nice.",
            "created_at": "2018-10-14T08:32:11Z",
            "html_url": "https://github.com/cython/cython/issues/1448#issuecomment-429606684",
            "id": 429606684,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1448",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTYwNjY4NA==",
            "updated_at": "2018-10-14T08:32:11Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/429606684",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1448/comments",
    "created_at": "2016-08-23T15:54:44Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/307683?v=4",
                "events_url": "https://api.github.com/users/codewarrior0/events{/privacy}",
                "followers_url": "https://api.github.com/users/codewarrior0/followers",
                "following_url": "https://api.github.com/users/codewarrior0/following{/other_user}",
                "gists_url": "https://api.github.com/users/codewarrior0/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/codewarrior0",
                "id": 307683,
                "login": "codewarrior0",
                "node_id": "MDQ6VXNlcjMwNzY4Mw==",
                "organizations_url": "https://api.github.com/users/codewarrior0/orgs",
                "received_events_url": "https://api.github.com/users/codewarrior0/received_events",
                "repos_url": "https://api.github.com/users/codewarrior0/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codewarrior0/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codewarrior0/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/codewarrior0"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-23T16:14:25Z",
            "event": "mentioned",
            "id": 764727851,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NzY0NzI3ODUx",
            "url": "https://api.github.com/repos/cython/cython/issues/events/764727851"
        },
        {
            "actor": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/307683?v=4",
                "events_url": "https://api.github.com/users/codewarrior0/events{/privacy}",
                "followers_url": "https://api.github.com/users/codewarrior0/followers",
                "following_url": "https://api.github.com/users/codewarrior0/following{/other_user}",
                "gists_url": "https://api.github.com/users/codewarrior0/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/codewarrior0",
                "id": 307683,
                "login": "codewarrior0",
                "node_id": "MDQ6VXNlcjMwNzY4Mw==",
                "organizations_url": "https://api.github.com/users/codewarrior0/orgs",
                "received_events_url": "https://api.github.com/users/codewarrior0/received_events",
                "repos_url": "https://api.github.com/users/codewarrior0/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codewarrior0/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codewarrior0/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/codewarrior0"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-23T16:14:25Z",
            "event": "subscribed",
            "id": 764727852,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDc2NDcyNzg1Mg==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/764727852"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1448/events",
    "html_url": "https://github.com/cython/cython/issues/1448",
    "id": 172737865,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1448/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUxNzI3Mzc4NjU=",
    "number": 1448,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "def __str__(self) doesn't work properly with unicode",
    "updated_at": "2018-10-14T08:32:11Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1448",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/2866862?v=4",
        "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}",
        "followers_url": "https://api.github.com/users/ignatenkobrain/followers",
        "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}",
        "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ignatenkobrain",
        "id": 2866862,
        "login": "ignatenkobrain",
        "node_id": "MDQ6VXNlcjI4NjY4NjI=",
        "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs",
        "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events",
        "repos_url": "https://api.github.com/users/ignatenkobrain/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ignatenkobrain"
    }
}