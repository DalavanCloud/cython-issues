{
    "assignee": null,
    "assignees": [],
    "body": "Hi,\r\n\r\nI think there's something wrong with Cython 0.25.0\r\n\r\n#### How things should and do work:\r\n* Make a new virtualenv\r\n* pip install cython=0.24.1\r\n* pip install cassandra-driver==3.7.0 (i tried 3.2.0 and 3.0.0 too)\r\n* start python\r\n* import cassandra.cluster\r\n\r\n#### Where things break\r\n* Make a new virtualenv\r\n* pip install cython==0.25.0\r\n* pip install cassandra-driver==3.7.0\r\n* There will be an error about PyException_Check being implicitly declared but the install completes\r\n* start python\r\n* import cassandra.cluster\r\n* You will set another error about PyException_Check\r\n\r\nI honestly know nothing about Cython other than its a black box for making Python faster. But the fact that the only variable between the two scenarios above is the Cython version leads me to believe it's an issue with Cython and not the Cassandra driver.\r\n\r\nSorry of this doesn't meet criteria for a bug report. I'm happy to supply more info. ",
    "closed_at": "2016-10-26T04:52:53Z",
    "comment_data": [
        {
            "body": "Am having this exact same issue as of recent.",
            "created_at": "2016-10-25T22:34:16Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256197746",
            "id": 256197746,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T22:34:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256197746",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5489149?v=3",
                "events_url": "https://api.github.com/users/jhgg/events{/privacy}",
                "followers_url": "https://api.github.com/users/jhgg/followers",
                "following_url": "https://api.github.com/users/jhgg/following{/other_user}",
                "gists_url": "https://api.github.com/users/jhgg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jhgg",
                "id": 5489149,
                "login": "jhgg",
                "organizations_url": "https://api.github.com/users/jhgg/orgs",
                "received_events_url": "https://api.github.com/users/jhgg/received_events",
                "repos_url": "https://api.github.com/users/jhgg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jhgg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jhgg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jhgg"
            }
        },
        {
            "body": "It looks like this symbol has somehow appeared:\r\n\r\n```\r\n$ nm -g /home/deploy/virtualenvs/discord/local/lib/python2.7/site-packages/cassandra/cluster.so | grep PyException\r\n                 U PyException_Check\r\n```\r\n\r\nThis doesn't exist in the .so generated by cython 0.24.1",
            "created_at": "2016-10-25T22:37:15Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256198329",
            "id": 256198329,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T22:37:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256198329",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5489149?v=3",
                "events_url": "https://api.github.com/users/jhgg/events{/privacy}",
                "followers_url": "https://api.github.com/users/jhgg/followers",
                "following_url": "https://api.github.com/users/jhgg/following{/other_user}",
                "gists_url": "https://api.github.com/users/jhgg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jhgg",
                "id": 5489149,
                "login": "jhgg",
                "organizations_url": "https://api.github.com/users/jhgg/orgs",
                "received_events_url": "https://api.github.com/users/jhgg/received_events",
                "repos_url": "https://api.github.com/users/jhgg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jhgg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jhgg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jhgg"
            }
        },
        {
            "body": "I've uploaded cluster.c here: https://gist.github.com/ngoldbaum/ff58cd6d51002ca6dc574e34ff5016cd\r\n\r\nThe problematic call to the nonexistent PyException_Check is being generated by code in the cython file that looks like this:\r\n\r\n```\r\nfor exc in [f for f in results if isinstance(f, Exception)]:\r\n    ...\r\n```\r\n\r\n",
            "created_at": "2016-10-25T22:43:46Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256199804",
            "id": 256199804,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T22:43:46Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256199804",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "In fact the following test code after being cythonized produces a call to PyException_Check:\r\n\r\n```\r\nresults = ['foo', 'bar']\r\n\r\nfor exc in [f for f in results if isinstance(f, Exception)]:\r\n    pass\r\n```\r\n\r\n```\r\n$ cython test.pyx\r\n$ ag PyException_Check test.c\r\n998:    __pyx_t_6 = PyException_Check(__pyx_t_2);\r\n```",
            "created_at": "2016-10-25T22:46:28Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256200425",
            "id": 256200425,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T22:46:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256200425",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "Under cython 0.24.1 the same line looks like:\r\n\r\n```\r\n__pyx_t_6 = PyObject_IsInstance(__pyx_t_2, __pyx_builtin_Exception); if (unlikely(__pyx_t_6 == -1)) __PYX_ERR(0, 3, __pyx_L1_error)\r\n```",
            "created_at": "2016-10-25T22:49:05Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256200994",
            "id": 256200994,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T22:49:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256200994",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "Fairly certain the bug is here: https://github.com/cython/cython/blob/d8c5467133aa16c3eccb19427c41a62a51115837/Cython/Compiler/PyrexTypes.py#L1218\r\n\r\nIt is generating the incorrect type check. \r\n\r\n",
            "created_at": "2016-10-25T23:42:20Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256210680",
            "id": 256210680,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T23:45:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256210680",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5489149?v=3",
                "events_url": "https://api.github.com/users/jhgg/events{/privacy}",
                "followers_url": "https://api.github.com/users/jhgg/followers",
                "following_url": "https://api.github.com/users/jhgg/following{/other_user}",
                "gists_url": "https://api.github.com/users/jhgg/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jhgg",
                "id": 5489149,
                "login": "jhgg",
                "organizations_url": "https://api.github.com/users/jhgg/orgs",
                "received_events_url": "https://api.github.com/users/jhgg/received_events",
                "repos_url": "https://api.github.com/users/jhgg/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jhgg/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jhgg/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jhgg"
            }
        },
        {
            "body": "I think this was caused by https://github.com/cython/cython/commit/b1d7b0de9e4cdc1eb866661e34f3da8892993fba, ping @robertwb ",
            "created_at": "2016-10-25T23:58:49Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256213173",
            "id": 256213173,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-25T23:58:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256213173",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "Exactly the same problem in [uvloop](http://github.com/magicstack/uvloop). Here's a Travis CI [log](https://travis-ci.org/MagicStack/uvloop/builds/170654704).",
            "created_at": "2016-10-26T03:42:05Z",
            "html_url": "https://github.com/cython/cython/issues/1496#issuecomment-256241954",
            "id": 256241954,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1496",
            "updated_at": "2016-10-26T03:45:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/256241954",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/239003?v=3",
                "events_url": "https://api.github.com/users/1st1/events{/privacy}",
                "followers_url": "https://api.github.com/users/1st1/followers",
                "following_url": "https://api.github.com/users/1st1/following{/other_user}",
                "gists_url": "https://api.github.com/users/1st1/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/1st1",
                "id": 239003,
                "login": "1st1",
                "organizations_url": "https://api.github.com/users/1st1/orgs",
                "received_events_url": "https://api.github.com/users/1st1/received_events",
                "repos_url": "https://api.github.com/users/1st1/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/1st1/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/1st1/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/1st1"
            }
        }
    ],
    "comments": 8,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1496/comments",
    "created_at": "2016-10-25T22:06:36Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-10-25T23:58:49Z",
            "event": "mentioned",
            "id": 836324062,
            "url": "https://api.github.com/repos/cython/cython/issues/events/836324062"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-10-25T23:58:49Z",
            "event": "subscribed",
            "id": 836324064,
            "url": "https://api.github.com/repos/cython/cython/issues/events/836324064"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": "c506034bae45518d895b0aca9b4347895eae1153",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/c506034bae45518d895b0aca9b4347895eae1153",
            "created_at": "2016-10-26T04:51:35Z",
            "event": "referenced",
            "id": 836504942,
            "url": "https://api.github.com/repos/cython/cython/issues/events/836504942"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": "c506034bae45518d895b0aca9b4347895eae1153",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/c506034bae45518d895b0aca9b4347895eae1153",
            "created_at": "2016-10-26T04:52:53Z",
            "event": "closed",
            "id": 836505675,
            "url": "https://api.github.com/repos/cython/cython/issues/events/836505675"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-10-26T06:04:35Z",
            "event": "milestoned",
            "id": 836546364,
            "milestone": {
                "title": "0.25.1"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/836546364"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1496/events",
    "html_url": "https://github.com/cython/cython/issues/1496",
    "id": 185246839,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1496/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 1,
        "created_at": "2016-10-26T06:04:35Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
            "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
            "followers_url": "https://api.github.com/users/robertwb/followers",
            "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
            "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/robertwb",
            "id": 486017,
            "login": "robertwb",
            "organizations_url": "https://api.github.com/users/robertwb/orgs",
            "received_events_url": "https://api.github.com/users/robertwb/received_events",
            "repos_url": "https://api.github.com/users/robertwb/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/robertwb"
        },
        "description": null,
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestones/0.25.1",
        "id": 2094059,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/42/labels",
        "number": 42,
        "open_issues": 0,
        "state": "open",
        "title": "0.25.1",
        "updated_at": "2016-10-26T06:04:35Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/42"
    },
    "number": 1496,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "PyException_Check and the Python Cassandra Driver",
    "updated_at": "2016-10-26T06:04:35Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1496",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/49671?v=3",
        "events_url": "https://api.github.com/users/abrugh/events{/privacy}",
        "followers_url": "https://api.github.com/users/abrugh/followers",
        "following_url": "https://api.github.com/users/abrugh/following{/other_user}",
        "gists_url": "https://api.github.com/users/abrugh/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/abrugh",
        "id": 49671,
        "login": "abrugh",
        "organizations_url": "https://api.github.com/users/abrugh/orgs",
        "received_events_url": "https://api.github.com/users/abrugh/received_events",
        "repos_url": "https://api.github.com/users/abrugh/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/abrugh/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/abrugh/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/abrugh"
    }
}