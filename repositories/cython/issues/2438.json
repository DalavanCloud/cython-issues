{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "The attached test case causes a segmentation fault in 0.28.3 when running `genbreak.py`\r\n\r\n[gencase.zip](https://github.com/cython/cython/files/2141452/gencase.zip)\r\n\r\nThis also happens on regular cythonized modules, it's unrelated to pyximport (which genbreak.py uses as a handy way to compile and run the cythonized modules gentest and genmain).\r\n\r\nThis segfault seems to be triggered by exceptions raised from inside cpdef generator methods. It doesn't seem necessary that the call itself is done natively to cause the segfault - regular calls from python code also cause it, when the generator is cpdef.\r\n\r\nThe full gcc traceback of the segfault is attached.\r\n[gdb.txt](https://github.com/cython/cython/files/2141510/gdb.txt)\r\n\r\n\r\nRegular def generator methods don't cause a segfault, and neither do generator functions (def or cpdef). However, cpdef generator functions do cause an unusual SystemError. If the class is removed and `gen` turned into a module function instead, cimported and invoked, one gets:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"genbreak.py\", line 4, in <module>\r\n    genmain.main()\r\nSystemError: NULL result without error in PyObject_Call\r\n```\r\n\r\nWhich is clearly not the intended result either.\r\n",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2438/comments",
    "created_at": "2018-06-27T13:49:47Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2438/events",
    "html_url": "https://github.com/cython/cython/issues/2438",
    "id": 336238813,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2438/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzMzYyMzg4MTM=",
    "number": 2438,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Segmentation fault when raising errors from generator methods",
    "updated_at": "2018-06-27T13:49:47Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2438",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/1746892?v=4",
        "events_url": "https://api.github.com/users/klaussfreire/events{/privacy}",
        "followers_url": "https://api.github.com/users/klaussfreire/followers",
        "following_url": "https://api.github.com/users/klaussfreire/following{/other_user}",
        "gists_url": "https://api.github.com/users/klaussfreire/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/klaussfreire",
        "id": 1746892,
        "login": "klaussfreire",
        "node_id": "MDQ6VXNlcjE3NDY4OTI=",
        "organizations_url": "https://api.github.com/users/klaussfreire/orgs",
        "received_events_url": "https://api.github.com/users/klaussfreire/received_events",
        "repos_url": "https://api.github.com/users/klaussfreire/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/klaussfreire/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/klaussfreire/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/klaussfreire"
    }
}