{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "As pointed out in the [Cython documentation][1] if a C callback function which manipulates Python objects is called from non-Python threads, the `PyEval_InitThreads` function has be called before the callback is invoked otherwise the interpreter will crash. As Cython does not have a declaration for this function users have to manually create one.\r\n\r\nWould it make sense to add a declaration for this function to the existing declarations for CPython?\r\n\r\nI am happy to submit a PR if this makes sense.\r\n\r\n[1]: http://docs.cython.org/en/latest/src/userguide/external_C_code.html#acquiring-the-gil",
    "closed_at": "2018-06-02T09:34:26Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Sure, anything that's missing should be added, but the easiest is probably to set the C macro `__PYX_FORCE_INIT_THREADS=1`.",
            "created_at": "2018-04-20T07:32:46Z",
            "html_url": "https://github.com/cython/cython/issues/2205#issuecomment-383008756",
            "id": 383008756,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2205",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzAwODc1Ng==",
            "updated_at": "2018-04-20T07:32:46Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/383008756",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "That being said, a less hidden way would probably be nice, e.g. a new directive.",
            "created_at": "2018-04-20T07:37:31Z",
            "html_url": "https://github.com/cython/cython/issues/2205#issuecomment-383010111",
            "id": 383010111,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2205",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzAxMDExMQ==",
            "updated_at": "2018-04-20T07:37:31Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/383010111",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Is `__PYX_FORCE_INIT_THREADS` an implementation detail as pointed out [here](https://groups.google.com/forum/#!topic/cython-users/AqyQDREh4uI) or can users actually depend on it?\r\nWe can shoot a PR to add it to the docs if this is the way you would recommend people doing this from now on and therefore it becomes \"public\".",
            "created_at": "2018-04-20T09:06:43Z",
            "html_url": "https://github.com/cython/cython/issues/2205#issuecomment-383034961",
            "id": 383034961,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2205",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzAzNDk2MQ==",
            "updated_at": "2018-04-20T09:06:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/383034961",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3709683?v=4",
                "events_url": "https://api.github.com/users/mariocj89/events{/privacy}",
                "followers_url": "https://api.github.com/users/mariocj89/followers",
                "following_url": "https://api.github.com/users/mariocj89/following{/other_user}",
                "gists_url": "https://api.github.com/users/mariocj89/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mariocj89",
                "id": 3709683,
                "login": "mariocj89",
                "node_id": "MDQ6VXNlcjM3MDk2ODM=",
                "organizations_url": "https://api.github.com/users/mariocj89/orgs",
                "received_events_url": "https://api.github.com/users/mariocj89/received_events",
                "repos_url": "https://api.github.com/users/mariocj89/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mariocj89/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mariocj89/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mariocj89"
            }
        },
        {
            "author_association": "NONE",
            "body": "It may worth noting, as mentioned in the posted [google-groups link](https://groups.google.com/d/msg/cython-users/AqyQDREh4uI/1F7yhWRgvtcJ) along with the [documentation link](http://docs.cython.org/en/latest/src/userguide/external_C_code.html#acquiring-the-gil), that just cimporting the `cython.parallel` Cython module should suffice to ensure that `PyEval_InitThreads` is called, doing so would add the [`InitThreads`](https://github.com/cython/cython/blob/93c7400a5027ee57ea710d6a0a26e3e339de5182/Cython/Utility/ModuleSetupCode.c#L826) utility code to the module initialization function, specifically, to `__Pyx_InitGlobals`.\r\n\r\nTherefore, you don't exactly need to use anything from the `cython.parallel` module to initialize the GIL, and that's independent of whether `__PYX_FORCE_INIT_THREADS` is defined or not, unlike the case with using the `threading` library which only initializes the GIL when [creating a new thread](https://github.com/python/cpython/blob/71ca738f4cd2696d056d0cdb83bebd576f98ccc2/Modules/_threadmodule.c#L1064).",
            "created_at": "2018-06-19T19:07:57Z",
            "html_url": "https://github.com/cython/cython/issues/2205#issuecomment-398511174",
            "id": 398511174,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2205",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODUxMTE3NA==",
            "updated_at": "2018-06-19T19:07:57Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/398511174",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/8525842?v=4",
                "events_url": "https://api.github.com/users/Kamekameha/events{/privacy}",
                "followers_url": "https://api.github.com/users/Kamekameha/followers",
                "following_url": "https://api.github.com/users/Kamekameha/following{/other_user}",
                "gists_url": "https://api.github.com/users/Kamekameha/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Kamekameha",
                "id": 8525842,
                "login": "Kamekameha",
                "node_id": "MDQ6VXNlcjg1MjU4NDI=",
                "organizations_url": "https://api.github.com/users/Kamekameha/orgs",
                "received_events_url": "https://api.github.com/users/Kamekameha/received_events",
                "repos_url": "https://api.github.com/users/Kamekameha/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Kamekameha/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Kamekameha/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Kamekameha"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2205/comments",
    "created_at": "2018-04-18T15:51:39Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-06-02T09:34:26Z",
            "event": "closed",
            "id": 1659561775,
            "node_id": "MDExOkNsb3NlZEV2ZW50MTY1OTU2MTc3NQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1659561775"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2205/events",
    "html_url": "https://github.com/cython/cython/issues/2205",
    "id": 315539815,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2205/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzMTU1Mzk4MTU=",
    "number": 2205,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Add declaration for PyEval_InitThreads",
    "updated_at": "2018-06-19T19:07:57Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2205",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/791741?v=4",
        "events_url": "https://api.github.com/users/lkollar/events{/privacy}",
        "followers_url": "https://api.github.com/users/lkollar/followers",
        "following_url": "https://api.github.com/users/lkollar/following{/other_user}",
        "gists_url": "https://api.github.com/users/lkollar/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lkollar",
        "id": 791741,
        "login": "lkollar",
        "node_id": "MDQ6VXNlcjc5MTc0MQ==",
        "organizations_url": "https://api.github.com/users/lkollar/orgs",
        "received_events_url": "https://api.github.com/users/lkollar/received_events",
        "repos_url": "https://api.github.com/users/lkollar/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lkollar/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lkollar/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lkollar"
    }
}