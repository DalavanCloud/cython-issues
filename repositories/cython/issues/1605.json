{
    "assignee": null,
    "assignees": [],
    "body": "Typed memoryviews don't work with read-only buffers. A banal example:\r\n```cython\r\ncpdef getmax(double[:] x):\r\n    cdef double max = -float('inf')\r\n    for val in x:\r\n        if val > max:\r\n            max = val\r\n    return max\r\n```\r\nExample session:\r\n```py\r\n>>> import numpy as np\r\n>>> values = np.random.random(8)\r\n>>> values \r\narray([ 0.4574,  0.8468,  0.744 ,  0.3764,  0.7581,  0.8123,  0.8783,  0.9341])\r\n\r\n>>> import getmax\r\n>>> getmax.getmax(values)\r\n0.9341213061235054\r\n\r\n>>> values.setflags(write=False)\r\n>>> assert values.flags.writeable == False\r\n>>> getmax.getmax(values)\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-8-669165de7389> in <module>()\r\n----> 1 getmax.getmax(values)\r\n\r\n/tmp/getmax.pyx in getmax.getmax (getmax.c:1617)()\r\n----> 1 cpdef getmax(double[:] x):\r\n      2     cdef:\r\n      3         double max = -float('inf')\r\n      4 \r\n      5     for val in x:\r\n\r\n/tmp/getmax.so in View.MemoryView.memoryview_cwrapper (getmax.c:7403)()\r\n/tmp/getmax.so in View.MemoryView.memoryview.__cinit__ (getmax.c:3678)()\r\n\r\nValueError: buffer source array is read-only\r\n```\r\nThere is no evident reason why above simple function wouldn't work with a read-only buffer. About two years ago, this issue was raised on the mailing list along with a RFC patch:\r\nhttps://mail.python.org/pipermail/cython-devel/2015-February/004316.html\r\nSome discussion about a possible use for a `const` keyword:\r\nhttps://groups.google.com/forum/#!topic/cython-users/32CMgaLrNhc",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Hi, I also ran into this issue today. ",
            "created_at": "2017-07-16T04:26:54Z",
            "html_url": "https://github.com/cython/cython/issues/1605#issuecomment-315584715",
            "id": 315584715,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1605",
            "updated_at": "2017-07-16T04:26:54Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/315584715",
            "user": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            }
        },
        {
            "body": "I really liked the const keyword approach. What are the show stoppers?",
            "created_at": "2017-07-16T04:33:01Z",
            "html_url": "https://github.com/cython/cython/issues/1605#issuecomment-315584886",
            "id": 315584886,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1605",
            "updated_at": "2017-07-16T04:33:01Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/315584886",
            "user": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            }
        },
        {
            "body": "Currently, adding const to a fused type memory view gives a compiler crash in 0.25.2. Thus it appears to need some work on the parser to get this working.\r\n\r\nIs a pull request welcomed? @robertwb  @scoder \r\n\r\n```\r\n-----------------------------------------------------------\r\n...\r\n        self.painter.canvas_dtype_elsize = 0\r\n\r\n        pmesh_painter_init(self.painter)\r\n        self.support = self.painter.support\r\n\r\n    def paint(self, numpy.ndarray real, const postype [:, :] pos, const masstype [:] mass, order,\r\n   ^\r\n------------------------------------------------------------\r\n\r\npmesh/_window.pyx:86:4: Compiler crash in AnalyseExpressionsTransform\r\n\r\nFile 'Nodes.py', line 430, in analyse_expressions: StatListNode(_window.pyx:1:0)\r\nFile 'Nodes.py', line 430, in analyse_expressions: StatListNode(_window.pyx:50:5)\r\nFile 'Nodes.py', line 4636, in analyse_expressions: CClassDefNode(_window.pyx:50:5,\r\n    as_name = 'ResampleWindow',\r\n    class_name = 'ResampleWindow',\r\n    module_name = '',\r\n    visibility = 'private')\r\nFile 'Nodes.py', line 430, in analyse_expressions: StatListNode(_window.pyx:51:4)\r\nFile 'Nodes.py', line 3029, in analyse_expressions: DefNode(_window.pyx:86:4,\r\n    modifiers = [...]/0,\r\n    name = 'paint',\r\n    num_required_args = 8,\r\n    py_wrapper_required = True,\r\n    reqd_kw_flags_cname = '0',\r\n    used = True)\r\nFile 'Nodes.py', line 3164, in prepare_argument_coercion: DefNodeWrapper(_window.pyx:86:4,\r\n    args = [...]/8,\r\n    modifiers = [...]/0,\r\n    name = 'paint',\r\n    num_required_args = 8)\r\n\r\nCompiler crash traceback from this point on:\r\n  File \"/home/yfeng1/anaconda3/install/lib/python3.5/site-packages/Cython/Compiler/Nodes.py\", line 3164, in prepare_argument_coercion\r\n    if not arg.type.create_from_py_utility_code(env):\r\n  File \"/home/yfeng1/anaconda3/install/lib/python3.5/site-packages/Cython/Compiler/PyrexTypes.py\", line 856, in create_from_py_utility_code\r\n    suffix = self.specialization_suffix()\r\n  File \"/home/yfeng1/anaconda3/install/lib/python3.5/site-packages/Cython/Compiler/PyrexTypes.py\", line 828, in specialization_suffix\r\n    return \"%s_%s\" % (self.axes_to_name(), self.dtype_name)\r\nAttributeError: 'MemoryViewSliceType' object has no attribute 'dtype_name'\r\n\r\n```",
            "created_at": "2017-07-16T04:40:26Z",
            "html_url": "https://github.com/cython/cython/issues/1605#issuecomment-315585089",
            "id": 315585089,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1605",
            "updated_at": "2017-07-16T04:46:14Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/315585089",
            "user": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            }
        },
        {
            "body": "It appears this bug is keeping people away from the memoryview to use the older ndarray interface. for example, see this workaround in pandas https://github.com/pandas-dev/pandas/pull/12013 ",
            "created_at": "2017-07-16T05:43:38Z",
            "html_url": "https://github.com/cython/cython/issues/1605#issuecomment-315587381",
            "id": 315587381,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1605",
            "updated_at": "2017-07-16T05:43:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/315587381",
            "user": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1605/comments",
    "created_at": "2017-02-14T15:58:30Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars7.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-07-16T04:46:14Z",
            "event": "mentioned",
            "id": 1165479826,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1165479826"
        },
        {
            "actor": {
                "avatar_url": "https://avatars7.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-07-16T04:46:14Z",
            "event": "subscribed",
            "id": 1165479827,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1165479827"
        },
        {
            "actor": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-07-16T04:46:14Z",
            "event": "mentioned",
            "id": 1165479828,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1165479828"
        },
        {
            "actor": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-07-16T04:46:14Z",
            "event": "subscribed",
            "id": 1165479829,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1165479829"
        },
        {
            "actor": {
                "avatar_url": "https://avatars4.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            },
            "commit_id": "b85c1c3dd0f0632ba15b7e65f90a9ce4f1b44d3e",
            "commit_url": "https://api.github.com/repos/rainwoodman/pmesh/commits/b85c1c3dd0f0632ba15b7e65f90a9ce4f1b44d3e",
            "created_at": "2017-07-16T05:02:32Z",
            "event": "referenced",
            "id": 1165482017,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1165482017"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1605/events",
    "html_url": "https://github.com/cython/cython/issues/1605",
    "id": 207556472,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1605/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1605,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Typed memoryview doesn't work with read-only buffers",
    "updated_at": "2017-07-16T05:43:48Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1605",
    "user": {
        "avatar_url": "https://avatars6.githubusercontent.com/u/684364?v=4",
        "events_url": "https://api.github.com/users/kernc/events{/privacy}",
        "followers_url": "https://api.github.com/users/kernc/followers",
        "following_url": "https://api.github.com/users/kernc/following{/other_user}",
        "gists_url": "https://api.github.com/users/kernc/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kernc",
        "id": 684364,
        "login": "kernc",
        "organizations_url": "https://api.github.com/users/kernc/orgs",
        "received_events_url": "https://api.github.com/users/kernc/received_events",
        "repos_url": "https://api.github.com/users/kernc/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kernc/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kernc/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kernc"
    }
}