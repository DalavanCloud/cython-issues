{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "A ValueError is raised if one gives a numpy array with shape `(2, 0, 1)` to such Cython functions with a 3d memoryview as argument:\r\n\r\n```cython\r\ncimport numpy as np\r\nimport numpy as np\r\nnp.import_array()\r\n\r\ncpdef myfunc3d(np.float64_t[:, :, ::1] arr):\r\n    if arr.size > 0:\r\n        print(arr[0, 0, 0])\r\n    else:\r\n        print('size == 0')\r\n```\r\n\r\nThe code to get the error:\r\n\r\n```python\r\nimport numpy as np\r\narr = np.ones((2, 0, 1))\r\nprint(arr.flags)\r\nmyfunc3d(arr)\r\n```\r\nwhich gives:\r\n```\r\nC_CONTIGUOUS : True\r\n  F_CONTIGUOUS : True\r\n  OWNDATA : True\r\n  WRITEABLE : True\r\n  ALIGNED : True\r\n  UPDATEIFCOPY : False\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-7-81a397764d36> in <module>()\r\n      1 arr = np.ones((2, 0, 1))\r\n      2 print(arr.flags)\r\n----> 3 myfunc3d(arr)\r\n\r\n_cython_magic_5dfab2d7f2a0e837d79c56566c9147b4.pyx in _cython_magic_5dfab2d7f2a0e837d79c56566c9147b4.myfunc3d()\r\n\r\nValueError: Buffer and memoryview are not contiguous in the same dimension.\r\nIn [ ]:\r\n```\r\nStrangely, no error is raised for a shape `(1, 0, 1)`! ",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Strangely enough, by changing the function definition as shown below does not raise any error.\r\n\r\n```python\r\nfrom cython cimport view\r\n\r\ndef myfunc3d(np.float_t[:,:,::view.contiguous] arr):\r\n```\r\nPossible explanation from [Cython docs](https://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html?highlight=view#specifying-more-general-memory-layouts)\r\n\r\n> The difference between the contiguous flag and the ::1 specifier is that the former specifies contiguity for only one dimension, whereas the latter specifies contiguity for all following (Fortran) or preceding (C) dimensions:\r\n\r\nHowever this is not a solution, the issue still persists, IMHO.",
            "created_at": "2018-02-06T11:45:04Z",
            "html_url": "https://github.com/cython/cython/issues/2093#issuecomment-363398270",
            "id": 363398270,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2093",
            "updated_at": "2018-02-06T11:45:04Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/363398270",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/9155111?v=4",
                "events_url": "https://api.github.com/users/ashwinvis/events{/privacy}",
                "followers_url": "https://api.github.com/users/ashwinvis/followers",
                "following_url": "https://api.github.com/users/ashwinvis/following{/other_user}",
                "gists_url": "https://api.github.com/users/ashwinvis/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ashwinvis",
                "id": 9155111,
                "login": "ashwinvis",
                "organizations_url": "https://api.github.com/users/ashwinvis/orgs",
                "received_events_url": "https://api.github.com/users/ashwinvis/received_events",
                "repos_url": "https://api.github.com/users/ashwinvis/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ashwinvis/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ashwinvis/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ashwinvis"
            }
        },
        {
            "author_association": "NONE",
            "body": "To add to the previous comment, although no error is raised... the output `size == 0` is unexpected!\r\n```python\r\n>>> import numpy as np; arr = np.ascontiguousarray(np.ones((2, 0, 1))); print(arr.flags); myfunc3d(arr)\r\n\r\n  C_CONTIGUOUS : True\r\n  F_CONTIGUOUS : True\r\n  OWNDATA : True\r\n  WRITEABLE : True\r\n  ALIGNED : True\r\n  WRITEBACKIFCOPY : False\r\n  UPDATEIFCOPY : False\r\nsize == 0\r\n\r\n>>> arr.size\r\n\r\n0\r\n```",
            "created_at": "2018-02-06T17:52:06Z",
            "html_url": "https://github.com/cython/cython/issues/2093#issuecomment-363507491",
            "id": 363507491,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2093",
            "updated_at": "2018-02-06T17:52:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/363507491",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/9155111?v=4",
                "events_url": "https://api.github.com/users/ashwinvis/events{/privacy}",
                "followers_url": "https://api.github.com/users/ashwinvis/followers",
                "following_url": "https://api.github.com/users/ashwinvis/following{/other_user}",
                "gists_url": "https://api.github.com/users/ashwinvis/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ashwinvis",
                "id": 9155111,
                "login": "ashwinvis",
                "organizations_url": "https://api.github.com/users/ashwinvis/orgs",
                "received_events_url": "https://api.github.com/users/ashwinvis/received_events",
                "repos_url": "https://api.github.com/users/ashwinvis/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ashwinvis/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ashwinvis/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ashwinvis"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2093/comments",
    "created_at": "2018-02-06T10:55:35Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2093/events",
    "html_url": "https://github.com/cython/cython/issues/2093",
    "id": 294715423,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2093/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 2093,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "ValueError continuous memory view and 0-size numpy array",
    "updated_at": "2018-02-06T17:52:26Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2093",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/8842662?v=4",
        "events_url": "https://api.github.com/users/paugier/events{/privacy}",
        "followers_url": "https://api.github.com/users/paugier/followers",
        "following_url": "https://api.github.com/users/paugier/following{/other_user}",
        "gists_url": "https://api.github.com/users/paugier/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/paugier",
        "id": 8842662,
        "login": "paugier",
        "organizations_url": "https://api.github.com/users/paugier/orgs",
        "received_events_url": "https://api.github.com/users/paugier/received_events",
        "repos_url": "https://api.github.com/users/paugier/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/paugier/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/paugier/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/paugier"
    }
}