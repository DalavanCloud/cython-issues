{
    "assignee": null,
    "assignees": [],
    "body": "This idea is inspired by some work I did specifically for Sage in https://trac.sagemath.org/ticket/21682\r\n\r\nI consider it useful to add an entire `setup.py` command specifically for compiling Cython sources.  This has a few advantages over simply wrapping the `build_ext` command to run `cythonize()`.  In particular:\r\n\r\n1) It is possible to run just `cythonize`, without compiling extension modules. This maybe isn't that common, but can be useful for development, especially when testing issues with Cython itself. It will also be useful for generating source distributions, where one might want to ship Cythonized sources in the source tarball, and hence would need to generate them as part of the process of building the tarball (without necessarily compiling).\r\n\r\nThis also allows passing options directly from the command-line to `cythonize`.  E.g.\r\n\r\n```\r\n$ ./setup.py build_cython -j -X cdivision=true build_ext --inplace\r\n```\r\n\r\n2) Code is clearer and more modular. Specific details for compiling cython code are kept separate from details for compiling C/C++ code.\r\n\r\n\r\nIt occurs to me that much of the logic from https://github.com/cython/cython/blob/master/Cython/Build/Cythonize.py could be recycled for this purpose (with a little refactoring), so that the `build_cython` command has a similar interface (with applicable) to the `cythonize` stand-alone script.  In other words, it would mostly be providing an alternate front-end to `cythonize` in the form of a distutils command.\r\n\r\nI'm happy to provide a patch if this sounds reasonable.",
    "closed_at": null,
    "comment_data": [
        {
            "body": "This does sound interesting. Note that the cythonize(...) method takes a hodgepodge of commands, I'd like to clean up/structure that before making it even more visible. \n\nThis fits into the larger question of how we should recommend cython + distutils interaction. (For Sage it's easy as Cython's shipped as part of the sources.)\n",
            "created_at": "2016-11-16T05:08:53Z",
            "html_url": "https://github.com/cython/cython/issues/1514#issuecomment-260855564",
            "id": 260855564,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1514",
            "updated_at": "2016-11-16T05:08:53Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/260855564",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "> Note that the cythonize(...) method takes a hodgepodge of commands, I'd like to clean up/structure that before making it even more visible.\n\nCould you expand on that a bit more?  I don't disagree with the characterization, but I'm not sure what you have in mind to improve it.\n\nI was thinking for the `build_cython` command it would take more or less the same arguments as listed here: https://github.com/cython/cython/blob/master/Cython/Build/Cythonize.py#L135  Minus a few that are not applicable in the setup.py context.  That seems fine as a starting point regardless how `cythonize()`'s arguments themselves are laid out.\n",
            "created_at": "2016-11-17T13:48:02Z",
            "html_url": "https://github.com/cython/cython/issues/1514#issuecomment-261250585",
            "id": 261250585,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1514",
            "updated_at": "2016-11-17T13:48:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/261250585",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/676149?v=3",
                "events_url": "https://api.github.com/users/embray/events{/privacy}",
                "followers_url": "https://api.github.com/users/embray/followers",
                "following_url": "https://api.github.com/users/embray/following{/other_user}",
                "gists_url": "https://api.github.com/users/embray/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/embray",
                "id": 676149,
                "login": "embray",
                "organizations_url": "https://api.github.com/users/embray/orgs",
                "received_events_url": "https://api.github.com/users/embray/received_events",
                "repos_url": "https://api.github.com/users/embray/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/embray/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/embray/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/embray"
            }
        },
        {
            "body": "Let me mention here another reason to have a separate command for running Cython: it would be useful to run `build_cython` **before** the `build_py` command. This is because you could then use `package_data` (which is handled by `build_py`) to install some Cython-generated files.",
            "created_at": "2017-03-28T12:15:34Z",
            "html_url": "https://github.com/cython/cython/issues/1514#issuecomment-289750787",
            "id": 289750787,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1514",
            "updated_at": "2017-03-28T12:15:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/289750787",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "> For Sage it's easy as Cython's shipped as part of the sources\r\n\r\nAre there really Python projects for which a dependency on Cython is troublesome?",
            "created_at": "2017-03-29T08:53:32Z",
            "html_url": "https://github.com/cython/cython/issues/1514#issuecomment-290026293",
            "id": 290026293,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1514",
            "updated_at": "2017-03-29T08:53:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/290026293",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1514/comments",
    "created_at": "2016-11-07T15:48:24Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1514/events",
    "html_url": "https://github.com/cython/cython/issues/1514",
    "id": 187746753,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1514/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1514,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Add a build_cython command for distutils",
    "updated_at": "2017-03-29T08:53:32Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1514",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/676149?v=3",
        "events_url": "https://api.github.com/users/embray/events{/privacy}",
        "followers_url": "https://api.github.com/users/embray/followers",
        "following_url": "https://api.github.com/users/embray/following{/other_user}",
        "gists_url": "https://api.github.com/users/embray/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/embray",
        "id": 676149,
        "login": "embray",
        "organizations_url": "https://api.github.com/users/embray/orgs",
        "received_events_url": "https://api.github.com/users/embray/received_events",
        "repos_url": "https://api.github.com/users/embray/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/embray/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/embray/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/embray"
    }
}