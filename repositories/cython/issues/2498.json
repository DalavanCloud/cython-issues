{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "This is an issue to summarize the current status of NumPy C API support and what can/should be done to update Cython. (cc @mattip, this is what I was talking about yesterday - could be a useful thing to work on).\r\n\r\nCurrently Cython uses a NumPy API that has been deprecated since NumPy 1.6.0 in 2013. \r\n- Example: https://stackoverflow.com/questions/25789055/cython-numpy-warning-about-npy-no-deprecated-api-when-using-memoryview\r\n\r\nThe Cython docs say [here](https://cython.readthedocs.io/en/latest/src/reference/compilation.html): \"For the time being, it is just a warning that you can ignore.\".\r\n\r\nIt is about time to update this, it will save users a lot of confusion and shorten the build logs of many projects by hundreds of lines.\r\n\r\n@nouiz wrote a summary of how to support both old (<1.6.0) and new API: \r\n- https://github.com/scikit-learn/scikit-learn/issues/2573 (meant as a Cython issue, but never reopened here as far as I can tell)\r\n- https://mail.python.org/pipermail/numpy-discussion/2013-November/068172.html\r\n\r\nI would suggest that it's either no longer needed to support the old <1.6 API, or make that opt-in rather than the default (to avoid all the build warnings while remaining compatible with very old NumPy versions). Would be good to get the opinion of the Cython team on this before starting work on this.\r\n\r\nHere is an example of changing to the new API and avoiding the build warnings for `scipy.optimize`: https://github.com/scipy/scipy/pull/4351/files. Linking because the use of  ``numpy_nodepr_api`` there (the defines and passing them to `distutils`) may be useful to other projects; it's a bit nontrivial to get right.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Thanks for bringing this up and collecting the sources.\r\nIt's not entirely trivial to migrate, because we are currently exposing the array attributes directly to user code in [numpy.pxd](https://github.com/cython/cython/blob/master/Cython/Includes/numpy/__init__.pxd). Fixing Cython's own code is probably easy, but avoiding to break existing user code requires some thought.",
            "created_at": "2018-07-16T05:53:49Z",
            "html_url": "https://github.com/cython/cython/issues/2498#issuecomment-405154561",
            "id": 405154561,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2498",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTE1NDU2MQ==",
            "updated_at": "2018-07-16T05:53:49Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/405154561",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> It's not entirely trivial to migrate, because we are currently exposing the array attributes directly to user code in numpy.pxd. Fixing Cython's own code is probably easy, but avoiding to break existing user code requires some thought.\r\n\r\nGood point. Probably best to respect [NumPy's deprecation mechanism](https://docs.scipy.org/doc/numpy/reference/c-api.deprecations.html), not exposing array attributes only if\r\n\r\n    #if defined(NPY_NO_DEPRECATED_API) && NPY_NO_DEPRECATED_API >= NPY_1_7_API_VERSION",
            "created_at": "2018-07-16T14:42:29Z",
            "html_url": "https://github.com/cython/cython/issues/2498#issuecomment-405270793",
            "id": 405270793,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2498",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTI3MDc5Mw==",
            "updated_at": "2018-07-16T14:42:29Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/405270793",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/98330?v=4",
                "events_url": "https://api.github.com/users/rgommers/events{/privacy}",
                "followers_url": "https://api.github.com/users/rgommers/followers",
                "following_url": "https://api.github.com/users/rgommers/following{/other_user}",
                "gists_url": "https://api.github.com/users/rgommers/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rgommers",
                "id": 98330,
                "login": "rgommers",
                "node_id": "MDQ6VXNlcjk4MzMw",
                "organizations_url": "https://api.github.com/users/rgommers/orgs",
                "received_events_url": "https://api.github.com/users/rgommers/received_events",
                "repos_url": "https://api.github.com/users/rgommers/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rgommers/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rgommers/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rgommers"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2498/comments",
    "created_at": "2018-07-15T22:53:44Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/823911?v=4",
                "events_url": "https://api.github.com/users/mattip/events{/privacy}",
                "followers_url": "https://api.github.com/users/mattip/followers",
                "following_url": "https://api.github.com/users/mattip/following{/other_user}",
                "gists_url": "https://api.github.com/users/mattip/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mattip",
                "id": 823911,
                "login": "mattip",
                "node_id": "MDQ6VXNlcjgyMzkxMQ==",
                "organizations_url": "https://api.github.com/users/mattip/orgs",
                "received_events_url": "https://api.github.com/users/mattip/received_events",
                "repos_url": "https://api.github.com/users/mattip/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mattip/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mattip/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mattip"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-15T22:53:44Z",
            "event": "mentioned",
            "id": 1734382571,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTczNDM4MjU3MQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734382571"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/823911?v=4",
                "events_url": "https://api.github.com/users/mattip/events{/privacy}",
                "followers_url": "https://api.github.com/users/mattip/followers",
                "following_url": "https://api.github.com/users/mattip/following{/other_user}",
                "gists_url": "https://api.github.com/users/mattip/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mattip",
                "id": 823911,
                "login": "mattip",
                "node_id": "MDQ6VXNlcjgyMzkxMQ==",
                "organizations_url": "https://api.github.com/users/mattip/orgs",
                "received_events_url": "https://api.github.com/users/mattip/received_events",
                "repos_url": "https://api.github.com/users/mattip/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mattip/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mattip/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mattip"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-15T22:53:44Z",
            "event": "subscribed",
            "id": 1734382573,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDE3MzQzODI1NzM=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734382573"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/180987?v=4",
                "events_url": "https://api.github.com/users/nouiz/events{/privacy}",
                "followers_url": "https://api.github.com/users/nouiz/followers",
                "following_url": "https://api.github.com/users/nouiz/following{/other_user}",
                "gists_url": "https://api.github.com/users/nouiz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nouiz",
                "id": 180987,
                "login": "nouiz",
                "node_id": "MDQ6VXNlcjE4MDk4Nw==",
                "organizations_url": "https://api.github.com/users/nouiz/orgs",
                "received_events_url": "https://api.github.com/users/nouiz/received_events",
                "repos_url": "https://api.github.com/users/nouiz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nouiz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nouiz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nouiz"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-15T22:53:44Z",
            "event": "mentioned",
            "id": 1734382574,
            "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MTczNDM4MjU3NA==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734382574"
        },
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/180987?v=4",
                "events_url": "https://api.github.com/users/nouiz/events{/privacy}",
                "followers_url": "https://api.github.com/users/nouiz/followers",
                "following_url": "https://api.github.com/users/nouiz/following{/other_user}",
                "gists_url": "https://api.github.com/users/nouiz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nouiz",
                "id": 180987,
                "login": "nouiz",
                "node_id": "MDQ6VXNlcjE4MDk4Nw==",
                "organizations_url": "https://api.github.com/users/nouiz/orgs",
                "received_events_url": "https://api.github.com/users/nouiz/received_events",
                "repos_url": "https://api.github.com/users/nouiz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nouiz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nouiz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nouiz"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-15T22:53:44Z",
            "event": "subscribed",
            "id": 1734382575,
            "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDE3MzQzODI1NzU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734382575"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-16T05:50:04Z",
            "event": "labeled",
            "id": 1734576049,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE3MzQ1NzYwNDk=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734576049"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-16T05:50:04Z",
            "event": "labeled",
            "id": 1734576050,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE3MzQ1NzYwNTA=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734576050"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-16T05:50:04Z",
            "event": "labeled",
            "id": 1734576051,
            "label": {
                "color": "444444",
                "name": "Library"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE3MzQ1NzYwNTE=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734576051"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-07-16T05:50:04Z",
            "event": "labeled",
            "id": 1734576054,
            "label": {
                "color": "444444",
                "name": "numpy"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE3MzQ1NzYwNTQ=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1734576054"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2498/events",
    "html_url": "https://github.com/cython/cython/issues/2498",
    "id": 341359507,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425561823,
            "name": "Library",
            "node_id": "MDU6TGFiZWw0MjU1NjE4MjM=",
            "url": "https://api.github.com/repos/cython/cython/labels/Library"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425563611,
            "name": "numpy",
            "node_id": "MDU6TGFiZWw0MjU1NjM2MTE=",
            "url": "https://api.github.com/repos/cython/cython/labels/numpy"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2498/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNDEzNTk1MDc=",
    "number": 2498,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Change to non-deprecated NumPy C API",
    "updated_at": "2018-07-16T14:42:29Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2498",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/98330?v=4",
        "events_url": "https://api.github.com/users/rgommers/events{/privacy}",
        "followers_url": "https://api.github.com/users/rgommers/followers",
        "following_url": "https://api.github.com/users/rgommers/following{/other_user}",
        "gists_url": "https://api.github.com/users/rgommers/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rgommers",
        "id": 98330,
        "login": "rgommers",
        "node_id": "MDQ6VXNlcjk4MzMw",
        "organizations_url": "https://api.github.com/users/rgommers/orgs",
        "received_events_url": "https://api.github.com/users/rgommers/received_events",
        "repos_url": "https://api.github.com/users/rgommers/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rgommers/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rgommers/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rgommers"
    }
}