{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "After migrating from 0.26.1 to 0.27 on Python 3.6.2, calling the `PyInit_modname()` from C is no longer sufficient to fully initialize the module.  This like the string table are left uninitialized, which causes many segfaults, even for static data.  For example, an \"def f(): import json\" function in Cython will fail because the  `__pyx_string_tab` is never initializes the string constant for `json`, which implies that `__Pyx_InitGlobals` is never called.\r\n\r\nI believe that this is because of the new slot-based multiphase init.  \r\n\r\nIs there a new method for loading modules from C/C++ that I am missing? Or is this a bug?",
    "closed_at": "2017-09-27T19:42:10Z",
    "comment_data": [
        {
            "author_association": "OWNER",
            "body": "That's correct. The details are in PEP 489. I also sort-of updated the example in the docs, although it's still not recommended to do that at all.\n\nThe question is, why are you explicitly calling the module init function in the first place? Is that some kind of embedding scenario?\n",
            "created_at": "2017-09-27T04:30:40Z",
            "html_url": "https://github.com/cython/cython/issues/1891#issuecomment-332405881",
            "id": 332405881,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1891",
            "updated_at": "2017-09-27T04:30:40Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/332405881",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hi @scoder - yeah this is an embedding scenario.  I actually have a few python modules compiled into the same shared object.\r\n\r\nFor what it is worth, I found a work around for this in [the Python docs here](https://docs.python.org/3/extending/extending.html#the-module-s-method-table-and-initialization-function).  It basically amounts to,\r\n\r\n```C++\r\nPyImport_AppendInittab(\"modname\", PyInit_modname);\r\nPy_Initialize();\r\nPyImport_ImportModule(\"modname\");\r\n```\r\n\r\nThis is a little annoying because the flow in Python 2 is still, \r\n\r\n```C++\r\nPy_Initialize();\r\ninitmodname();\r\n```\r\n\r\nI guess that is life... Maybe this should be captured in the docs somewhere?",
            "created_at": "2017-09-27T05:34:05Z",
            "html_url": "https://github.com/cython/cython/issues/1891#issuecomment-332413619",
            "id": 332413619,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1891",
            "updated_at": "2017-09-27T05:34:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/332413619",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/320553?v=4",
                "events_url": "https://api.github.com/users/scopatz/events{/privacy}",
                "followers_url": "https://api.github.com/users/scopatz/followers",
                "following_url": "https://api.github.com/users/scopatz/following{/other_user}",
                "gists_url": "https://api.github.com/users/scopatz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scopatz",
                "id": 320553,
                "login": "scopatz",
                "organizations_url": "https://api.github.com/users/scopatz/orgs",
                "received_events_url": "https://api.github.com/users/scopatz/received_events",
                "repos_url": "https://api.github.com/users/scopatz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scopatz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scopatz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scopatz"
            }
        },
        {
            "author_association": "OWNER",
            "body": "I added a doc example here:\r\nhttps://github.com/cython/cython/commit/5c3b6e995d845e0a9511ff51521876cc13c1bdb1",
            "created_at": "2017-09-27T19:42:10Z",
            "html_url": "https://github.com/cython/cython/issues/1891#issuecomment-332633653",
            "id": 332633653,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1891",
            "updated_at": "2017-09-27T19:42:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/332633653",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks @scoder!",
            "created_at": "2017-09-27T20:08:38Z",
            "html_url": "https://github.com/cython/cython/issues/1891#issuecomment-332640329",
            "id": 332640329,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1891",
            "updated_at": "2017-09-27T20:08:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/332640329",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/320553?v=4",
                "events_url": "https://api.github.com/users/scopatz/events{/privacy}",
                "followers_url": "https://api.github.com/users/scopatz/followers",
                "following_url": "https://api.github.com/users/scopatz/following{/other_user}",
                "gists_url": "https://api.github.com/users/scopatz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scopatz",
                "id": 320553,
                "login": "scopatz",
                "organizations_url": "https://api.github.com/users/scopatz/orgs",
                "received_events_url": "https://api.github.com/users/scopatz/received_events",
                "repos_url": "https://api.github.com/users/scopatz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scopatz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scopatz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scopatz"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1891/comments",
    "created_at": "2017-09-26T23:42:35Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-09-27T05:34:05Z",
            "event": "mentioned",
            "id": 1267066551,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1267066551"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-09-27T05:34:05Z",
            "event": "subscribed",
            "id": 1267066553,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1267066553"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-09-27T19:42:10Z",
            "event": "closed",
            "id": 1268485016,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1268485016"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-09-27T20:08:38Z",
            "event": "mentioned",
            "id": 1268528808,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1268528808"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-09-27T20:08:38Z",
            "event": "subscribed",
            "id": 1268528809,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1268528809"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1891/events",
    "html_url": "https://github.com/cython/cython/issues/1891",
    "id": 260802887,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1891/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1891,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "PyInit_modname() functions no longer fully initialize modules on 0.27",
    "updated_at": "2017-09-27T20:08:39Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1891",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/320553?v=4",
        "events_url": "https://api.github.com/users/scopatz/events{/privacy}",
        "followers_url": "https://api.github.com/users/scopatz/followers",
        "following_url": "https://api.github.com/users/scopatz/following{/other_user}",
        "gists_url": "https://api.github.com/users/scopatz/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/scopatz",
        "id": 320553,
        "login": "scopatz",
        "organizations_url": "https://api.github.com/users/scopatz/orgs",
        "received_events_url": "https://api.github.com/users/scopatz/received_events",
        "repos_url": "https://api.github.com/users/scopatz/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/scopatz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scopatz/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/scopatz"
    }
}