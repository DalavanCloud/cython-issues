{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "Over in https://github.com/zopefoundation/zope.app.apidoc/issues/25 we noticed an issue with the `__qualname__` of functions (at least) on Python 2. Because it's implemented as a `PyGetSetDef`, when accessed on the class, it returns a `getset_descriptor` object instead of the class name.\r\n\r\n```pycon\r\nPython 2.7.15 (default, May  2 2018, 00:53:27)\r\n[GCC 4.2.1 Compatible Apple LLVM 9.1.0 (clang-902.0.39.1)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from Cython.Compiler.Visitor import recursively_replace_node\r\n>>> recursively_replace_node\r\n<cyfunction recursively_replace_node at 0x10cd04950>\r\n>>> recursively_replace_node.__class__\r\n<type 'cython_function_or_method'>\r\n>>> recursively_replace_node.__qualname__\r\n'recursively_replace_node'\r\n>>> recursively_replace_node.__class__.__qualname__\r\n<attribute '__qualname__' of 'cython_function_or_method' objects>\r\n```\r\n\r\nThat breaks code expecting a string.\r\n\r\nPython 3 (at least 3.6, the only version I checked) doesn't seem to have this problem; presumably the built-in meaning of `__qualname__` is taking over? The results are consistent with other built-in functions by returning a string.\r\n\r\n```pycon\r\nPython 3.6.6 (default, Jun 28 2018, 05:43:53)\r\n[GCC 4.2.1 Compatible Apple LLVM 9.1.0 (clang-902.0.39.2)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from Cython.Compiler.Visitor import recursively_replace_node\r\n>>> recursively_replace_node\r\n<cyfunction recursively_replace_node at 0x10e9a66c0>\r\n>>> recursively_replace_node.__class__\r\n<class 'cython_function_or_method'>\r\n>>> recursively_replace_node.__qualname__\r\n'recursively_replace_node'\r\n>>> recursively_replace_node.__class__.__qualname__\r\n'cython_function_or_method'\r\n>>> import os\r\n>>> os.chmod.__class__.__qualname__\r\n'builtin_function_or_method'\r\n```\r\n\r\nIt seems like it would be a lot of work to transform the `PyGetSetDef` for `__qualname__` into a custom descriptor that does in the `__dict__` (the only way I know how to fix it, but I am no CPython API expert!). Python 2 functions don't generally have `__qualname__`, perhaps the easiest thing to do would just be to `#ifdef` the `__qualname__` out of the `__pyx_CyFunction_getsets`?\r\n\r\n(I understand if that's not appealing either; this isn't a big deal, we plan to workaround it on that project.)",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2562/comments",
    "created_at": "2018-08-17T12:03:42Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2562/events",
    "html_url": "https://github.com/cython/cython/issues/2562",
    "id": 351567948,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2562/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNTE1Njc5NDg=",
    "number": 2562,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "__qualname__ inconsistent on Python 2, returns a descriptor on the class instead of class name",
    "updated_at": "2018-08-17T12:04:12Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2562",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/1256082?v=4",
        "events_url": "https://api.github.com/users/jamadden/events{/privacy}",
        "followers_url": "https://api.github.com/users/jamadden/followers",
        "following_url": "https://api.github.com/users/jamadden/following{/other_user}",
        "gists_url": "https://api.github.com/users/jamadden/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jamadden",
        "id": 1256082,
        "login": "jamadden",
        "node_id": "MDQ6VXNlcjEyNTYwODI=",
        "organizations_url": "https://api.github.com/users/jamadden/orgs",
        "received_events_url": "https://api.github.com/users/jamadden/received_events",
        "repos_url": "https://api.github.com/users/jamadden/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jamadden/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jamadden/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jamadden"
    }
}