{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Cython does not include definitions for `std::make_pair`\r\n\r\nThe blog post https://molpopgen.github.io/fwdpy/docs/examples/cython/WritingExtensions includes the following example\r\n\r\n```\r\n%%cython --cplus --compile-args=-std=c++11 -I $fwdpy_includes -I $fwdpp_includes -l sequence -l gsl -l gslcblas\r\n\r\nfrom fwdpy.fwdpy cimport *\r\nfrom libcpp.utility cimport pair\r\nimport numpy as np\r\n\r\nctypedef vector[double] vd\r\nctypedef pair[vd,vd] pvdvd\r\n\r\n#Annoyingly, Cython currently does not \r\n#expose std::make_pair, so we will \r\n#do it here ourselves!\r\n#If we don't have std::make_pair,\r\n#we end up making extra temporary copies\r\n#of our return values in memory.  That's \r\n#not cool, as we're doing this because\r\n#we care about efficiency!\r\ncdef extern from \"<utility>\" namespace \"std\" nogil:\r\n    pair[T,U] make_pair[T,U](T&,U&)\r\n\r\ncdef pvdvd freq_esize_cpp(const singlepop_t * pop):\r\n    cdef vd freq,esize\r\n    cdef double twoN = 2.0*float(pop.N)\r\n    cdef size_t i = 0\r\n    cdef size_t nm=0\r\n    for i in range(pop.mcounts.size()):\r\n        if pop.mcounts[i]>0:\r\n            if pop.mutations[i].neutral is False:\r\n                freq.push_back(float(pop.mcounts[i])/twoN)\r\n                #s records the effect size/selection coefficient\r\n                esize.push_back(pop.mutations[i].s)\r\n    #For some reason, we need to provide casts\r\n    #so that Cython can get the types right for the call to\r\n    #make_pair:\r\n    return make_pair(<vd>freq,<vd>esize)\r\n\r\ndef freq_esize(Spop pop):\r\n    return freq_esize_cpp(pop.pop.get())\r\n```\r\n\r\nIs this the \"best practice\" way? If so, would it make sense to include the make_pair definition in `Includes/libcpp/`?",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Yes, for sure. PRs welcome.\n\nOn Fri, Nov 9, 2018, 5:17 AM Leonard Lausen <notifications@github.com wrote:\n\n> Cython does not include definitions for std::make_pair\n>\n> The blog post\n> https://molpopgen.github.io/fwdpy/docs/examples/cython/WritingExtensions\n> includes the following example\n>\n> %%cython --cplus --compile-args=-std=c++11 -I $fwdpy_includes -I $fwdpp_includes -l sequence -l gsl -l gslcblas\n>\n> from fwdpy.fwdpy cimport *\n> from libcpp.utility cimport pair\n> import numpy as np\n>\n> ctypedef vector[double] vd\n> ctypedef pair[vd,vd] pvdvd\n>\n> #Annoyingly, Cython currently does not\n> #expose std::make_pair, so we will\n> #do it here ourselves!\n> #If we don't have std::make_pair,\n> #we end up making extra temporary copies\n> #of our return values in memory.  That's\n> #not cool, as we're doing this because\n> #we care about efficiency!\n> cdef extern from \"<utility>\" namespace \"std\" nogil:\n>     pair[T,U] make_pair[T,U](T&,U&)\n>\n> cdef pvdvd freq_esize_cpp(const singlepop_t * pop):\n>     cdef vd freq,esize\n>     cdef double twoN = 2.0*float(pop.N)\n>     cdef size_t i = 0\n>     cdef size_t nm=0\n>     for i in range(pop.mcounts.size()):\n>         if pop.mcounts[i]>0:\n>             if pop.mutations[i].neutral is False:\n>                 freq.push_back(float(pop.mcounts[i])/twoN)\n>                 #s records the effect size/selection coefficient\n>                 esize.push_back(pop.mutations[i].s)\n>     #For some reason, we need to provide casts\n>     #so that Cython can get the types right for the call to\n>     #make_pair:\n>     return make_pair(<vd>freq,<vd>esize)\n>\n> def freq_esize(Spop pop):\n>     return freq_esize_cpp(pop.pop.get())\n>\n> Is this the \"best practice\" way? If so, would it make sense to include the\n> make_pair definition in Includes/libcpp/?\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/cython/cython/issues/2706>, or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAdqgdEq4NjnD9Gt0IV6ctDBGN0Z3vb4ks5utQHAgaJpZM4YV702>\n> .\n>\n",
            "created_at": "2018-11-09T07:15:18Z",
            "html_url": "https://github.com/cython/cython/issues/2706#issuecomment-437271452",
            "id": 437271452,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2706",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzI3MTQ1Mg==",
            "updated_at": "2018-11-09T07:15:18Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/437271452",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "node_id": "MDQ6VXNlcjQ4NjAxNw==",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2706/comments",
    "created_at": "2018-11-09T04:17:03Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2706/events",
    "html_url": "https://github.com/cython/cython/issues/2706",
    "id": 379017106,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2706/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNzkwMTcxMDY=",
    "number": 2706,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "std::make_pair",
    "updated_at": "2018-11-09T07:15:19Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2706",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/946903?v=4",
        "events_url": "https://api.github.com/users/leezu/events{/privacy}",
        "followers_url": "https://api.github.com/users/leezu/followers",
        "following_url": "https://api.github.com/users/leezu/following{/other_user}",
        "gists_url": "https://api.github.com/users/leezu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/leezu",
        "id": 946903,
        "login": "leezu",
        "node_id": "MDQ6VXNlcjk0NjkwMw==",
        "organizations_url": "https://api.github.com/users/leezu/orgs",
        "received_events_url": "https://api.github.com/users/leezu/received_events",
        "repos_url": "https://api.github.com/users/leezu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/leezu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/leezu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/leezu"
    }
}