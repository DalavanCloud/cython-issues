{
    "assignee": null,
    "assignees": [],
    "body": "When a C++ function returns a reference we are forced to workaround: typically make the call inside a function accepting references\r\n\r\nIt would be desirable to support\r\n`cdef Foo & obj = func_bar()`\r\n\r\nCython apparently declares the reference and assigns to it in different steps, which obviously doesn't compile.",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Why not just take the address and reference the return value as a pointer?",
            "created_at": "2017-05-21T01:30:30Z",
            "html_url": "https://github.com/cython/cython/issues/1695#issuecomment-302909148",
            "id": 302909148,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1695",
            "updated_at": "2017-05-21T01:30:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/302909148",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/836839?v=3",
                "events_url": "https://api.github.com/users/netheril96/events{/privacy}",
                "followers_url": "https://api.github.com/users/netheril96/followers",
                "following_url": "https://api.github.com/users/netheril96/following{/other_user}",
                "gists_url": "https://api.github.com/users/netheril96/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/netheril96",
                "id": 836839,
                "login": "netheril96",
                "organizations_url": "https://api.github.com/users/netheril96/orgs",
                "received_events_url": "https://api.github.com/users/netheril96/received_events",
                "repos_url": "https://api.github.com/users/netheril96/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/netheril96/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/netheril96/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/netheril96"
            }
        },
        {
            "body": "References are just pointers that must be assigned at declaration time, which ties in strongly to C++'s scoping (which is at odds with Python/Cython's scoping) which means supporting this would be non-trivial (as well as require other changes, e.g. allowing a cdef definition to occur anywhere). In particular, legal constructions like \r\n\r\n```\r\nif Cond:\r\n    x = ...\r\ncommon code\r\nif Cond:\r\n    foo(x)\r\n```\r\n\r\nsimply wouldn't work (or require interesting gymnastics). \r\n\r\nInstead, write `cdef Foo* obj = &func_bar()` which is just as powerful. ",
            "created_at": "2017-05-21T06:35:30Z",
            "html_url": "https://github.com/cython/cython/issues/1695#issuecomment-302918420",
            "id": 302918420,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1695",
            "updated_at": "2017-05-21T06:35:30Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/302918420",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "Another side effect is that \r\n`cdef ObjT x = somefunc_returning_a_ObjT()`\r\n\r\nwill invoke the copy assignment operator... without warnings. With arrays the problem goes from performance penalty to compile errors (like when using boost::multi_array)",
            "created_at": "2017-07-03T15:11:57Z",
            "html_url": "https://github.com/cython/cython/issues/1695#issuecomment-312671923",
            "id": 312671923,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1695",
            "updated_at": "2017-07-03T15:17:45Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/312671923",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/915100?v=3",
                "events_url": "https://api.github.com/users/ferdonline/events{/privacy}",
                "followers_url": "https://api.github.com/users/ferdonline/followers",
                "following_url": "https://api.github.com/users/ferdonline/following{/other_user}",
                "gists_url": "https://api.github.com/users/ferdonline/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ferdonline",
                "id": 915100,
                "login": "ferdonline",
                "organizations_url": "https://api.github.com/users/ferdonline/orgs",
                "received_events_url": "https://api.github.com/users/ferdonline/received_events",
                "repos_url": "https://api.github.com/users/ferdonline/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ferdonline/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ferdonline/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ferdonline"
            }
        },
        {
            "body": "> Instead, write cdef Foo* obj = &func_bar() which is just as powerful.\r\n\r\nI was wondering if cython was specially handling that case, but no, it doesn't work.\r\n`...xxx:165:34: Taking address of non-lvalue (type Positions)\r\n`",
            "created_at": "2017-07-03T15:25:37Z",
            "html_url": "https://github.com/cython/cython/issues/1695#issuecomment-312675105",
            "id": 312675105,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1695",
            "updated_at": "2017-07-03T15:25:37Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/312675105",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/915100?v=3",
                "events_url": "https://api.github.com/users/ferdonline/events{/privacy}",
                "followers_url": "https://api.github.com/users/ferdonline/followers",
                "following_url": "https://api.github.com/users/ferdonline/following{/other_user}",
                "gists_url": "https://api.github.com/users/ferdonline/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ferdonline",
                "id": 915100,
                "login": "ferdonline",
                "organizations_url": "https://api.github.com/users/ferdonline/orgs",
                "received_events_url": "https://api.github.com/users/ferdonline/received_events",
                "repos_url": "https://api.github.com/users/ferdonline/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ferdonline/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ferdonline/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ferdonline"
            }
        },
        {
            "body": "The `cdef Foo* obj = &func_bar()` trick only works when func_bar returns a reference. It is correct that an assignment invokes the assignment operator.  ",
            "created_at": "2017-07-03T17:30:44Z",
            "html_url": "https://github.com/cython/cython/issues/1695#issuecomment-312699930",
            "id": 312699930,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1695",
            "updated_at": "2017-07-03T17:30:44Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/312699930",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1695/comments",
    "created_at": "2017-05-03T13:05:19Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": "bfd1aa795553a4289b9d5143073e041f2584ca51",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/bfd1aa795553a4289b9d5143073e041f2584ca51",
            "created_at": "2017-05-21T06:37:25Z",
            "event": "referenced",
            "id": 1090747010,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1090747010"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1695/events",
    "html_url": "https://github.com/cython/cython/issues/1695",
    "id": 225979151,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1695/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1695,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Support for cdef of C++ object references",
    "updated_at": "2017-07-03T17:30:44Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1695",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/915100?v=3",
        "events_url": "https://api.github.com/users/ferdonline/events{/privacy}",
        "followers_url": "https://api.github.com/users/ferdonline/followers",
        "following_url": "https://api.github.com/users/ferdonline/following{/other_user}",
        "gists_url": "https://api.github.com/users/ferdonline/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ferdonline",
        "id": 915100,
        "login": "ferdonline",
        "organizations_url": "https://api.github.com/users/ferdonline/orgs",
        "received_events_url": "https://api.github.com/users/ferdonline/received_events",
        "repos_url": "https://api.github.com/users/ferdonline/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ferdonline/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ferdonline/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ferdonline"
    }
}