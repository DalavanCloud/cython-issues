{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I am using Cython 0.26 on Ubuntu 18.04 with Python 3.6. This is my Cython file\r\n\r\n```\r\ncimport cython\r\nimport numpy as np\r\nimport sys\r\ncimport numpy as np\r\nimport ctypes\r\nfrom libc.stdint cimport (int8_t)\r\n\r\ncdef extern from \"stdint.h\":\r\n    ctypedef unsigned int uint32_t\r\n    ctypedef unsigned long long uint64_t\r\n    ctypedef unsigned char uint8_t\r\n    ctypedef bint updated\r\n    ctypedef struct _CSSL_DataNode:\r\n            uint64_t key;\r\n            _CSSL_DataNode* next;\r\n    ctypedef struct _CSSL_ProxyNode:\r\n            uint64_t keys[5];\r\n            _CSSL_DataNode* pointers[5];\r\n            bint updated;\r\n \r\n \r\n\r\n    ctypedef struct _CSSL_SkipList:\r\n            uint8_t max_level;\r\n            uint8_t           skip;\r\n            uint32_t          num_elements;\r\n            uint32_t*         items_per_level;\r\n            uint32_t*         flane_items;\r\n            uint32_t*         starts_of_flanes;\r\n            uint32_t*         flanes;\r\n            _CSSL_ProxyNode** flane_pointers;\r\n            _CSSL_DataNode    *head, *tail;\r\n\r\n    ctypedef struct  _CSSL_RangeSearchResult:\r\n            _CSSL_DataNode* start;\r\n            _CSSL_DataNode* end;\r\n            uint32_t        count;\r\n\r\n\r\n\r\n    _CSSL_SkipList*         createSkipList(uint8_t maxLevel, uint8_t skip);\r\n    void                    insertElement(_CSSL_SkipList* slist, uint64_t key);\r\n    uint32_t                insertItemIntoFastLane(_CSSL_SkipList* slist,\r\n                                               int8_t level,\r\n                                               _CSSL_DataNode* newNode);\r\n    void                    buildFastLanes(_CSSL_SkipList* slist);\r\n    void                    resizeFastLanes(_CSSL_SkipList* slist);\r\n    uint64_t                searchElement(_CSSL_SkipList* slist, uint64_t key);\r\n    _CSSL_RangeSearchResult searchRange(_CSSL_SkipList* slist, uint64_t startKey, uint64_t endKey);\r\n    _CSSL_DataNode*         newNode(uint64_t key);\r\n```\r\n\r\nfor this C file - https://github.com/flippingbits/cssl/blob/master/skiplist.c\r\n\r\nand when I run this command \r\n\r\n```\r\npython3.6 setup.py build_ext --in_place \r\n```\r\n\r\nI get this error\r\n\r\n```\r\nrunning build_ext\r\nbuilding 'skip_list' extension\r\nx86_64-linux-gnu-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/usr/include/python3.6m -c skip_list.c -o build/temp.linux-x86_64-3.6/skip_list.o\r\nIn file included from /usr/include/numpy/ndarraytypes.h:1809:0,\r\n                 from /usr/include/numpy/ndarrayobject.h:18,\r\n                 from /usr/include/numpy/arrayobject.h:4,\r\n                 from skip_list.c:499:\r\n/usr/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning \"Using deprecated NumPy API, disable it by \" \"#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION\" [-Wcpp]\r\n #warning \"Using deprecated NumPy API, disable it by \" \\\r\n  ^~~~~~~\r\nx86_64-linux-gnu-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -g -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -I/usr/include/python3.6m -c skiplist.c -o build/temp.linux-x86_64-3.6/skiplist.o\r\nskiplist.c: In function ‘searchRange’:\r\nskiplist.c:286:12: warning: AVX vector return without AVX enabled changes the ABI [-Wpsabi]\r\n   avx_sreg = _mm256_castsi256_ps(_mm256_set1_epi32(endKey));\r\n   ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/7/include/immintrin.h:41:0,\r\n                 from skiplist.h:32,\r\n                 from skiplist.c:17:\r\n/usr/lib/gcc/x86_64-linux-gnu/7/include/avxintrin.h:1435:1: error: inlining failed in call to always_inline ‘_mm256_castsi256_ps’: target specific option mismatch\r\n _mm256_castsi256_ps (__m256i __A)\r\n ^~~~~~~~~~~~~~~~~~~\r\nskiplist.c:286:12: note: called from here\r\n   avx_sreg = _mm256_castsi256_ps(_mm256_set1_epi32(endKey));\r\n   ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/7/include/immintrin.h:41:0,\r\n                 from skiplist.h:32,\r\n                 from skiplist.c:17:\r\n/usr/lib/gcc/x86_64-linux-gnu/7/include/avxintrin.h:1318:1: error: inlining failed in call to always_inline ‘_mm256_set1_epi32’: target specific option mismatch\r\n _mm256_set1_epi32 (int __A)\r\n ^~~~~~~~~~~~~~~~~\r\nskiplist.c:286:14: note: called from here\r\n   avx_sreg = _mm256_castsi256_ps(_mm256_set1_epi32(endKey));\r\n              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/7/include/immintrin.h:41:0,\r\n                 from skiplist.h:32,\r\n                 from skiplist.c:17:\r\n/usr/lib/gcc/x86_64-linux-gnu/7/include/avxintrin.h:1194:1: error: inlining failed in call to always_inline ‘_mm256_movemask_ps’: target specific option mismatch\r\n _mm256_movemask_ps (__m256 __A)\r\n ^~~~~~~~~~~~~~~~~~\r\nskiplist.c:293:14: note: called from here\r\n     bitmask  = _mm256_movemask_ps(res);\r\n     ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/7/include/immintrin.h:41:0,\r\n                 from skiplist.h:32,\r\n                 from skiplist.c:17:\r\n/usr/lib/gcc/x86_64-linux-gnu/7/include/avxintrin.h:403:1: error: inlining failed in call to always_inline ‘_mm256_cmp_ps’: target specific option mismatch\r\n _mm256_cmp_ps (__m256 __X, __m256 __Y, const int __P)\r\n ^~~~~~~~~~~~~\r\nskiplist.c:292:14: note: called from here\r\n     res      = _mm256_cmp_ps(avx_sreg, avx_creg, 30);\r\n     ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/7/include/immintrin.h:41:0,\r\n                 from skiplist.h:32,\r\n                 from skiplist.c:17:\r\n/usr/lib/gcc/x86_64-linux-gnu/7/include/avxintrin.h:1435:1: error: inlining failed in call to always_inline ‘_mm256_castsi256_ps’: target specific option mismatch\r\n _mm256_castsi256_ps (__m256i __A)\r\n ^~~~~~~~~~~~~~~~~~~\r\nskiplist.c:290:14: note: called from here\r\n     avx_creg = _mm256_castsi256_ps(\r\n     ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~\r\n         _mm256_loadu_si256((__m256i const *) &slist->flanes[curPos]));\r\n         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from /usr/lib/gcc/x86_64-linux-gnu/7/include/immintrin.h:41:0,\r\n                 from skiplist.h:32,\r\n                 from skiplist.c:17:\r\n/usr/lib/gcc/x86_64-linux-gnu/7/include/avxintrin.h:919:1: error: inlining failed in call to always_inline ‘_mm256_loadu_si256’: target specific option mismatch\r\n _mm256_loadu_si256 (__m256i_u const *__P)\r\n ^~~~~~~~~~~~~~~~~~\r\nskiplist.c:290:16: note: called from here\r\n     avx_creg = _mm256_castsi256_ps(\r\n                ^~~~~~~~~~~~~~~~~~~~\r\n         _mm256_loadu_si256((__m256i const *) &slist->flanes[curPos]));\r\n         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nerror: command 'x86_64-linux-gnu-gcc' failed with exit status 1\r\n```\r\nI guess the C code does not have  standard APIs. Is there a way I can get Cython to compile by fixing this ?\r\nBased on this SO answer - https://stackoverflow.com/questions/43128698/inlining-failed-in-call-to-always-inline-mm-mullo-epi32-target-specific-opti\r\n\r\nI added this to my setup.py\r\n```\r\nfrom distutils.core import setup,Extension\r\nfrom Cython.Build import cythonize\r\nimport os\r\n\r\nos.environ['CFLAGS'] = '-msse4.1'\r\next = Extension(name=\"skip_list\",sources=[\"skiplist.c\",\"skip_list.pyx\"])\r\nsetup(ext_modules = cythonize(ext))\r\n```\r\nbut still get the same inlining error",
    "closed_at": "2018-09-25T15:23:41Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Fixed it by adding this line\r\n```\r\nos.environ['CFLAGS'] = '-mavx'",
            "created_at": "2018-09-25T15:23:41Z",
            "html_url": "https://github.com/cython/cython/issues/2630#issuecomment-424388497",
            "id": 424388497,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2630",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQyNDM4ODQ5Nw==",
            "updated_at": "2018-09-25T15:23:41Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/424388497",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/9129700?v=4",
                "events_url": "https://api.github.com/users/winash12/events{/privacy}",
                "followers_url": "https://api.github.com/users/winash12/followers",
                "following_url": "https://api.github.com/users/winash12/following{/other_user}",
                "gists_url": "https://api.github.com/users/winash12/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/winash12",
                "id": 9129700,
                "login": "winash12",
                "node_id": "MDQ6VXNlcjkxMjk3MDA=",
                "organizations_url": "https://api.github.com/users/winash12/orgs",
                "received_events_url": "https://api.github.com/users/winash12/received_events",
                "repos_url": "https://api.github.com/users/winash12/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/winash12/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/winash12/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/winash12"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2630/comments",
    "created_at": "2018-09-25T14:38:22Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/9129700?v=4",
                "events_url": "https://api.github.com/users/winash12/events{/privacy}",
                "followers_url": "https://api.github.com/users/winash12/followers",
                "following_url": "https://api.github.com/users/winash12/following{/other_user}",
                "gists_url": "https://api.github.com/users/winash12/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/winash12",
                "id": 9129700,
                "login": "winash12",
                "node_id": "MDQ6VXNlcjkxMjk3MDA=",
                "organizations_url": "https://api.github.com/users/winash12/orgs",
                "received_events_url": "https://api.github.com/users/winash12/received_events",
                "repos_url": "https://api.github.com/users/winash12/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/winash12/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/winash12/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/winash12"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-09-25T15:23:41Z",
            "event": "closed",
            "id": 1866071596,
            "node_id": "MDExOkNsb3NlZEV2ZW50MTg2NjA3MTU5Ng==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1866071596"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2630/events",
    "html_url": "https://github.com/cython/cython/issues/2630",
    "id": 363612611,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2630/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNjM2MTI2MTE=",
    "number": 2630,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Inlining failed in call to always_inline ‘_mm256_loadu_si256’: target specific option mismatch",
    "updated_at": "2018-09-25T15:23:41Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2630",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/9129700?v=4",
        "events_url": "https://api.github.com/users/winash12/events{/privacy}",
        "followers_url": "https://api.github.com/users/winash12/followers",
        "following_url": "https://api.github.com/users/winash12/following{/other_user}",
        "gists_url": "https://api.github.com/users/winash12/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/winash12",
        "id": 9129700,
        "login": "winash12",
        "node_id": "MDQ6VXNlcjkxMjk3MDA=",
        "organizations_url": "https://api.github.com/users/winash12/orgs",
        "received_events_url": "https://api.github.com/users/winash12/received_events",
        "repos_url": "https://api.github.com/users/winash12/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/winash12/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/winash12/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/winash12"
    }
}