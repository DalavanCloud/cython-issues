{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I have some very strange UnicodeEncodeError in my application. I could reduce the problem to the following example:\r\n```\r\nfrom __future__ import unicode_literals\r\ndeg = u'\\u00B0'\r\n'%s%s' % ('15', deg)\r\n```\r\nWhen I compile this example with cython>=0.28.0 and run is with Python 2.7.14 I get the following error:\r\n\r\n```\r\nC:\\tmp\\python\r\nPython 2.7.14 (v2.7.14:84471935ed, Sep 16 2017, 20:25:58) [MSC v.1500 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import crash\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"crash.pyx\", line 3, in init crash\r\n    '%s%s' % ('15', deg)\r\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xb0' in position 0: ordinal not in range(128)\r\n```\r\n\r\nUsing cython==0.27.3 there is no such error and the example works fine.\r\n\r\nBy looking at the code it seems the \"PyObject_Str\" statement causes the problem. However I have no idea how to fix the issue except for using cython 0.27.3 for python 2.7.\r\n```\r\n  /* \"crash.pyx\":3\r\n * from __future__ import unicode_literals\r\n * deg = u'\\u00B0'\r\n * '%s%s' % ('15', deg)             # <<<<<<<<<<<<<<\r\n */\r\n  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_deg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_1);\r\n  __pyx_t_2 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Str(__pyx_t_1), __pyx_empty_unicode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_2);\r\n  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;\r\n  __pyx_t_1 = __Pyx_PyUnicode_Concat(__pyx_kp_u_15, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)\r\n  __Pyx_GOTREF(__pyx_t_1);\r\n  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;\r\n  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;\r\n```",
    "closed_at": "2018-05-18T14:06:23Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Thanks for the report, it's really a Py2 issue.\r\nFixed here: ac6b858e79e83f991eee21667ab0cd8031faad73",
            "created_at": "2018-05-18T14:06:23Z",
            "html_url": "https://github.com/cython/cython/issues/2276#issuecomment-390218308",
            "id": 390218308,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2276",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDIxODMwOA==",
            "updated_at": "2018-05-18T14:06:23Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/390218308",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I recompiled my application with the latest cython version and I can confirm the problem is gone.\r\nThanks a lot for fixing this issue.",
            "created_at": "2018-05-18T20:08:16Z",
            "html_url": "https://github.com/cython/cython/issues/2276#issuecomment-390318353",
            "id": 390318353,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2276",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDMxODM1Mw==",
            "updated_at": "2018-05-18T20:08:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/390318353",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/25794575?v=4",
                "events_url": "https://api.github.com/users/derterz/events{/privacy}",
                "followers_url": "https://api.github.com/users/derterz/followers",
                "following_url": "https://api.github.com/users/derterz/following{/other_user}",
                "gists_url": "https://api.github.com/users/derterz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/derterz",
                "id": 25794575,
                "login": "derterz",
                "node_id": "MDQ6VXNlcjI1Nzk0NTc1",
                "organizations_url": "https://api.github.com/users/derterz/orgs",
                "received_events_url": "https://api.github.com/users/derterz/received_events",
                "repos_url": "https://api.github.com/users/derterz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/derterz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/derterz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/derterz"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2276/comments",
    "created_at": "2018-05-18T13:25:34Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-05-18T14:05:33Z",
            "event": "milestoned",
            "id": 1634359304,
            "milestone": {
                "title": "0.28.3"
            },
            "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDE2MzQzNTkzMDQ=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1634359304"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-05-18T14:05:46Z",
            "event": "labeled",
            "id": 1634359789,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE2MzQzNTk3ODk=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1634359789"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-05-18T14:05:46Z",
            "event": "labeled",
            "id": 1634359792,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE2MzQzNTk3OTI=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1634359792"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-05-18T14:05:56Z",
            "event": "labeled",
            "id": 1634360221,
            "label": {
                "color": "444444",
                "name": "Python3 Semantics"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE2MzQzNjAyMjE=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1634360221"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-05-18T14:06:23Z",
            "event": "closed",
            "id": 1634361176,
            "node_id": "MDExOkNsb3NlZEV2ZW50MTYzNDM2MTE3Ng==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1634361176"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2276/events",
    "html_url": "https://github.com/cython/cython/issues/2276",
    "id": 324409853,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425564666,
            "name": "Python3 Semantics",
            "node_id": "MDU6TGFiZWw0MjU1NjQ2NjY=",
            "url": "https://api.github.com/repos/cython/cython/labels/Python3%20Semantics"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2276/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 2,
        "created_at": "2018-05-03T10:22:51Z",
        "creator": {
            "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": null,
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/54",
        "id": 3317331,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/54/labels",
        "node_id": "MDk6TWlsZXN0b25lMzMxNzMzMQ==",
        "number": 54,
        "open_issues": 0,
        "state": "open",
        "title": "0.28.3",
        "updated_at": "2018-06-03T20:11:54Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/54"
    },
    "node_id": "MDU6SXNzdWUzMjQ0MDk4NTM=",
    "number": 2276,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Python 2.7 and \"from __future__ import unicode_literals\" causes UnicodeEncodeError",
    "updated_at": "2018-05-18T20:08:16Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2276",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/25794575?v=4",
        "events_url": "https://api.github.com/users/derterz/events{/privacy}",
        "followers_url": "https://api.github.com/users/derterz/followers",
        "following_url": "https://api.github.com/users/derterz/following{/other_user}",
        "gists_url": "https://api.github.com/users/derterz/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/derterz",
        "id": 25794575,
        "login": "derterz",
        "node_id": "MDQ6VXNlcjI1Nzk0NTc1",
        "organizations_url": "https://api.github.com/users/derterz/orgs",
        "received_events_url": "https://api.github.com/users/derterz/received_events",
        "repos_url": "https://api.github.com/users/derterz/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/derterz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/derterz/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/derterz"
    }
}