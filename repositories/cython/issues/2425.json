{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "Given this code in `foo.py`:\r\n```python\r\nfrom __future__ import print_function\r\nto_catch = (AssertionError,)\r\ntry:\r\n\traise AssertionError(\"AssertionError\")\r\nexcept to_catch as e:\r\n\tprint(\"Caught\", e)\r\nexcept:\r\n\tprint(\"Uncaught!\")\r\n```\r\n\r\nBoth Python 2 and Python 3 will print 'Caught':\r\n```console\r\n$ python2.7 foo.py\r\nCaught AssertionError\r\n$ python3.6 foo.py\r\nCaught AssertionError\r\n```\r\n\r\nBut if we compile `foo.py` with Cython 0.28.3 and then invoke it, only Python 2 correctly catches the exception:\r\n```console\r\n$ cat setup.py\r\nfrom setuptools import setup\r\nfrom Cython.Build import cythonize\r\nfrom setuptools import Extension\r\n\r\nsetup(\r\n\tname='foo',\r\n\text_modules=cythonize('foo.py')\r\n)\r\n$ cat bar.py\r\nimport foo\r\n$ python2.7 setup.py build_ext -i\r\n...\r\n$ python3.6 setup.py build_ext -i\r\n...\r\n$ mv foo.py foo.py.off # make sure we get the extension\r\n$ python2.7 bar.py\r\nCaught AssertionError\r\n$ python3.6 bar.py\r\nUncaught!\r\n```\r\n\r\nThe catch line compiles into a call to `__Pyx_PyErr_GivenExceptionMatches`\r\n```c\r\n    /* \"foo.py\":5\r\n * try:\r\n * \traise AssertionError(\"AssertionError\")\r\n * except to_catch as e:             # <<<<<<<<<<<<<<\r\n * \tprint(\"Caught\", e)\r\n * except:\r\n */\r\n    __Pyx_ErrFetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);\r\n    __pyx_t_7 = __Pyx_GetModuleGlobalName(__pyx_n_s_to_catch); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5, __pyx_L4_except_error)\r\n    __Pyx_GOTREF(__pyx_t_7);\r\n    __pyx_t_8 = __Pyx_PyErr_GivenExceptionMatches(__pyx_t_4, __pyx_t_7);\r\n\r\n```\r\n```c\r\nstatic CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject* exc_type) {\r\n    if (likely(err == exc_type)) return 1;\r\n    if (likely(PyExceptionClass_Check(err))) {\r\n        return __Pyx_inner_PyErr_GivenExceptionMatches2(err, NULL, exc_type);\r\n    }\r\n    return PyErr_GivenExceptionMatches(err, exc_type);\r\n}\r\n```\r\n\r\nThe definitions of `__Pyx_inner_PyErr_GivenExceptionMatches2` are different on Python 2 and 3. On Python 2, it goes directly to `PyObject_IsSubclass(err, exc_type)`, which correctly handles tuples.\r\n\r\nOn Python 3, though, it calls `__Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);` \r\n```c\r\nstatic CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {\r\n    int res = exc_type1 ? __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type1) : 0;\r\n    if (!res) {\r\n        res = __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);\r\n    }\r\n    return res;\r\n}\r\n```\r\nThat's an incorrect cast in the second parameter, and `Pyx_IsSubtype` doesn't correctly handle tuples for its second argument (luckily it doesn't crash!). If I modify this function to use `PyObject_IsSubclass` it works as expected.",
    "closed_at": "2018-06-26T20:47:47Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "https://github.com/cython/cython/issues/2426 might be the same problem as this one.\r\nI bisected the original breakage to 6cc0a3a.\r\nFor me, with current master it only fails to catch the exception, if the tuple is not a local.\r\nSo something between 6cc0a3a and master slightly improved the situation.",
            "created_at": "2018-06-26T18:03:59Z",
            "html_url": "https://github.com/cython/cython/issues/2425#issuecomment-400409336",
            "id": 400409336,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2425",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDQwOTMzNg==",
            "updated_at": "2018-06-26T18:03:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/400409336",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/3619761?v=4",
                "events_url": "https://api.github.com/users/mbuesch/events{/privacy}",
                "followers_url": "https://api.github.com/users/mbuesch/followers",
                "following_url": "https://api.github.com/users/mbuesch/following{/other_user}",
                "gists_url": "https://api.github.com/users/mbuesch/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mbuesch",
                "id": 3619761,
                "login": "mbuesch",
                "node_id": "MDQ6VXNlcjM2MTk3NjE=",
                "organizations_url": "https://api.github.com/users/mbuesch/orgs",
                "received_events_url": "https://api.github.com/users/mbuesch/received_events",
                "repos_url": "https://api.github.com/users/mbuesch/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mbuesch/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mbuesch/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mbuesch"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks for the excellent analysis.",
            "created_at": "2018-06-26T20:48:25Z",
            "html_url": "https://github.com/cython/cython/issues/2425#issuecomment-400457070",
            "id": 400457070,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2425",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDQ1NzA3MA==",
            "updated_at": "2018-06-26T20:48:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/400457070",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for the quick fix!",
            "created_at": "2018-06-26T20:50:03Z",
            "html_url": "https://github.com/cython/cython/issues/2425#issuecomment-400457529",
            "id": 400457529,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2425",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDQ1NzUyOQ==",
            "updated_at": "2018-06-26T20:50:03Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/400457529",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1256082?v=4",
                "events_url": "https://api.github.com/users/jamadden/events{/privacy}",
                "followers_url": "https://api.github.com/users/jamadden/followers",
                "following_url": "https://api.github.com/users/jamadden/following{/other_user}",
                "gists_url": "https://api.github.com/users/jamadden/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jamadden",
                "id": 1256082,
                "login": "jamadden",
                "node_id": "MDQ6VXNlcjEyNTYwODI=",
                "organizations_url": "https://api.github.com/users/jamadden/orgs",
                "received_events_url": "https://api.github.com/users/jamadden/received_events",
                "repos_url": "https://api.github.com/users/jamadden/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jamadden/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jamadden/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jamadden"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2425/comments",
    "created_at": "2018-06-26T16:25:32Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/1256082?v=4",
                "events_url": "https://api.github.com/users/jamadden/events{/privacy}",
                "followers_url": "https://api.github.com/users/jamadden/followers",
                "following_url": "https://api.github.com/users/jamadden/following{/other_user}",
                "gists_url": "https://api.github.com/users/jamadden/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jamadden",
                "id": 1256082,
                "login": "jamadden",
                "node_id": "MDQ6VXNlcjEyNTYwODI=",
                "organizations_url": "https://api.github.com/users/jamadden/orgs",
                "received_events_url": "https://api.github.com/users/jamadden/received_events",
                "repos_url": "https://api.github.com/users/jamadden/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jamadden/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jamadden/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jamadden"
            },
            "commit_id": "5ced9a20e97d2821655af82e0a839a3ef9f4d56c",
            "commit_url": "https://api.github.com/repos/NextThought/nti.externalization/commits/5ced9a20e97d2821655af82e0a839a3ef9f4d56c",
            "created_at": "2018-06-26T16:32:18Z",
            "event": "referenced",
            "id": 1701915625,
            "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDE3MDE5MTU2MjU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1701915625"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-06-26T20:15:36Z",
            "event": "labeled",
            "id": 1702378185,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE3MDIzNzgxODU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1702378185"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-06-26T20:15:40Z",
            "event": "milestoned",
            "id": 1702378320,
            "milestone": {
                "title": "0.28.4"
            },
            "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDE3MDIzNzgzMjA=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1702378320"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": "7f41244db2479eaf07343c5d3b07b4183fc6877a",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/7f41244db2479eaf07343c5d3b07b4183fc6877a",
            "created_at": "2018-06-26T20:46:58Z",
            "event": "referenced",
            "id": 1702441569,
            "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDE3MDI0NDE1Njk=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1702441569"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": "7f41244db2479eaf07343c5d3b07b4183fc6877a",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/7f41244db2479eaf07343c5d3b07b4183fc6877a",
            "created_at": "2018-06-26T20:47:47Z",
            "event": "closed",
            "id": 1702443159,
            "node_id": "MDExOkNsb3NlZEV2ZW50MTcwMjQ0MzE1OQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1702443159"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-06-26T20:48:42Z",
            "event": "labeled",
            "id": 1702445013,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE3MDI0NDUwMTM=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1702445013"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2425/events",
    "html_url": "https://github.com/cython/cython/issues/2425",
    "id": 335898946,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425556330,
            "name": "Code Generation",
            "node_id": "MDU6TGFiZWw0MjU1NTYzMzA=",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2425/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 2,
        "created_at": "2018-06-03T20:11:54Z",
        "creator": {
            "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": null,
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/55",
        "id": 3396640,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/55/labels",
        "node_id": "MDk6TWlsZXN0b25lMzM5NjY0MA==",
        "number": 55,
        "open_issues": 0,
        "state": "open",
        "title": "0.28.4",
        "updated_at": "2018-06-26T20:47:47Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/55"
    },
    "node_id": "MDU6SXNzdWUzMzU4OTg5NDY=",
    "number": 2425,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "`except dynamic_tuple:` fails to catch on Python 3",
    "updated_at": "2018-06-26T20:50:03Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2425",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/1256082?v=4",
        "events_url": "https://api.github.com/users/jamadden/events{/privacy}",
        "followers_url": "https://api.github.com/users/jamadden/followers",
        "following_url": "https://api.github.com/users/jamadden/following{/other_user}",
        "gists_url": "https://api.github.com/users/jamadden/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jamadden",
        "id": 1256082,
        "login": "jamadden",
        "node_id": "MDQ6VXNlcjEyNTYwODI=",
        "organizations_url": "https://api.github.com/users/jamadden/orgs",
        "received_events_url": "https://api.github.com/users/jamadden/received_events",
        "repos_url": "https://api.github.com/users/jamadden/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jamadden/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jamadden/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jamadden"
    }
}