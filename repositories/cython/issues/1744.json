{
    "assignee": null,
    "assignees": [],
    "body": "Using Cython master on Python 2.7.13:\r\n\r\nThis code\r\n```\r\ncdef inline bint g(int x, int y): return True\r\n\r\ncdef cython_bug(int u):\r\n    try:\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n        g(u, u)\r\n    finally:\r\n        g(u, u)\r\n```\r\nhits Python's recursion limit of 1000 frames:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/local/src/sage-config/local/bin/cython\", line 11, in <module>\r\n    load_entry_point('Cython==0.26a0', 'console_scripts', 'cython')()\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Main.py\", line 694, in setuptools_main\r\n    return main(command_line = 1)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Main.py\", line 711, in main\r\n    result = compile(sources, options)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Main.py\", line 686, in compile\r\n    return compile_multiple(source, options)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Main.py\", line 664, in compile_multiple\r\n    result = run_pipeline(source, options, context=context)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Main.py\", line 494, in run_pipeline\r\n    err, enddata = Pipeline.run_pipeline(pipeline, source)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Pipeline.py\", line 340, in run_pipeline\r\n    data = phase(data)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Pipeline.py\", line 53, in generate_pyx_code_stage\r\n    module_node.process_implementation(options, result)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/ModuleNode.py\", line 137, in process_implementation\r\n    self.generate_c_code(env, options, result)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/ModuleNode.py\", line 365, in generate_c_code\r\n    self.body.generate_function_definitions(env, code)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Nodes.py\", line 418, in generate_function_definitions\r\n    stat.generate_function_definitions(env, code)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Nodes.py\", line 1920, in generate_function_definitions\r\n    self.generate_function_body(env, code)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Nodes.py\", line 1683, in generate_function_body\r\n    self.body.generate_execution_code(code)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Nodes.py\", line 424, in generate_execution_code\r\n    stat.generate_execution_code(code)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Nodes.py\", line 7034, in generate_execution_code\r\n    fresh_finally_clause().generate_execution_code(code)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/Cython/Compiler/Nodes.py\", line 7022, in fresh_finally_clause\r\n    node_copy = copy.deepcopy(node)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/copy.py\", line 190, in deepcopy\r\n    y = _reconstruct(x, rv, 1, memo)\r\n  File \"/usr/local/src/sage-config/local/lib/python2.7/copy.py\", line 334, in _reconstruct\r\n    state = deepcopy(state, memo)\r\n[...long traceback involving deepcopy...]\r\n```\r\n\r\nIt's not an infinite recursion since `sys.setrecursionlimit(2000)` fixes the problem.",
    "closed_at": null,
    "comment_data": [
        {
            "body": "This works fine for me. Are there some different options/directives I should be passing?",
            "created_at": "2017-06-21T15:48:29Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310121959",
            "id": 310121959,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-21T15:48:29Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310121959",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "Maybe it depends on the Python version. Are you using 2.7.13?",
            "created_at": "2017-06-21T16:47:36Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310138599",
            "id": 310138599,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-21T16:47:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310138599",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "> Are there some different options/directives I should be passing?\r\n\r\nNo, this is just executing `cython test.pyx` with `test.pyx` the file in the issue description.",
            "created_at": "2017-06-21T16:50:00Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310139203",
            "id": 310139203,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-21T16:50:00Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310139203",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "What is worrying here is that the required stack depth is `O(n)` in the number of statements inside the `try` clause.",
            "created_at": "2017-06-22T08:43:32Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310316299",
            "id": 310316299,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-22T08:43:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310316299",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "```\r\nf8b3405e926d2ba9bc2ee24d79848235875ee12e is the first bad commit\r\ncommit f8b3405e926d2ba9bc2ee24d79848235875ee12e\r\nAuthor: Robert Bradshaw <robertwb@gmail.com>\r\nDate:   Thu Jun 15 15:51:15 2017 -0700\r\n\r\n    Don't override unknown inherited __reduce__.\r\n```",
            "created_at": "2017-06-22T09:15:16Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310324320",
            "id": 310324320,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-22T09:15:16Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310324320",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "Yeah, that is worrying. I built a fresh 2.7.13 Python and cloned a fresh branch of cython/master and I still can't reproduce, e.g.\r\n\r\n`python cython.py lots_of_asserts.pyx`\r\n\r\nworks just fine for me, even doubling the number of asserts.",
            "created_at": "2017-06-23T04:41:06Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310569533",
            "id": 310569533,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-23T04:41:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310569533",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "Well, Sage is using a slightly patched version of Python 2.7.13 so it could always be that some of those patches are relevant. I'll investigate further.",
            "created_at": "2017-06-23T08:04:52Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310600458",
            "id": 310600458,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-23T08:04:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310600458",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "It is failing on Travis CI, see #1745.\r\n\r\nCould it be OS-specific? I'm on Linux and I guess Travis CI also.",
            "created_at": "2017-06-23T08:33:45Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310606504",
            "id": 310606504,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-23T08:33:45Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310606504",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "I tried that test (thanks) on two separate Linux (Ubuntu) installs as well as my OS X laptop, and had no issues. But I do see the error up on Travis. The code touched at f8b3405e926d2ba9bc2ee24d79848235875ee12e shouldn't even get invoked if there aren't any cdef classes, so something really strange is going on here...",
            "created_at": "2017-06-23T08:46:42Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310609343",
            "id": 310609343,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-23T08:46:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310609343",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "Here it's actually copying the finally clause, which shouldn't be sensitive to the size of the body. (I've always considered literally copying the finally for each exit to be a bit hackish though...maybe this will be the motivation to re-write, though I'd like to understand why there's such a deep stack here.)",
            "created_at": "2017-06-23T08:56:14Z",
            "html_url": "https://github.com/cython/cython/issues/1744#issuecomment-310611441",
            "id": 310611441,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1744",
            "updated_at": "2017-06-23T08:56:14Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310611441",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 10,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1744/comments",
    "created_at": "2017-06-21T13:54:24Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            },
            "commit_id": "8c1c87f55105b2321d1ba4c30d6b6ff9bd67fdc4",
            "commit_url": "https://api.github.com/repos/jdemeyer/cython/commits/8c1c87f55105b2321d1ba4c30d6b6ff9bd67fdc4",
            "created_at": "2017-06-23T08:09:21Z",
            "event": "referenced",
            "id": 1136059454,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1136059454"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1744/events",
    "html_url": "https://github.com/cython/cython/issues/1744",
    "id": 237542672,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1744/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1744,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "\"maximum recursion depth exceeded\" in deepcopy() in fresh_finally_clause()",
    "updated_at": "2017-06-23T08:56:14Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1744",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/3625785?v=3",
        "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
        "followers_url": "https://api.github.com/users/jdemeyer/followers",
        "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
        "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jdemeyer",
        "id": 3625785,
        "login": "jdemeyer",
        "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
        "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
        "repos_url": "https://api.github.com/users/jdemeyer/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jdemeyer"
    }
}