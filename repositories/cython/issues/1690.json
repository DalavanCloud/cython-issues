{
    "assignee": null,
    "assignees": [],
    "body": "I recently added borgbackup to https://scan.coverity.com/ and after analyzing the uploaded Python and C code, it complained quite a lot about the generated C code from Cython.\r\n\r\nJust wanted to ask whether you want to have a look at that, I could file issues about the most frequent issues. Stuff like uninitialized vars, break statements missing. I didn't verify the stuff, maybe some of it are false positives (but even then, maybe one could try to avoid them somehow, so that Cython-using projects don't get lots of them).\r\n\r\nMaybe an even better idea would be if you added Cython as a project to coverity scan, so you could have it analyzed (and also have code generated by it analyzed).",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Can you give some specific examples? I've found that generated code often\nhas false positives that are hard to avoid (e.g. control flow that you can\nrule out from the input, but is hard to deduce from the output due to\nemulating control flow of one language in another). We also use\nfall-through intentionally (though it'd be good to annotate this). That\nbeing said, it's good go avoid what we can.\n\nOn Fri, Apr 28, 2017 at 6:25 PM, TW <notifications@github.com> wrote:\n\n> I recently added borgbackup to scan.coverity.com and after analyzing the\n> uploaded Python and C code, it complained quite a lot about the generated C\n> code from Cython.\n>\n> Just wanted to ask whether you want to have a look at that, I could file\n> issues about the most frequent issues. Stuff like uninitialized vars, break\n> statements missing. I didn't verify the stuff, maybe some of it are false\n> positives (but even then, maybe one could try to avoid them somehow, so\n> that Cython-using projects don't gets lots of them).\n>\n> Maybe an even better idea would be if you added Cython as a project to\n> coverity scan, so you could have it analyzed (and also have code generated\n> by it analyzed).\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/cython/cython/issues/1690>, or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ATqe4t_AULpFFJgO1d5JD0nPzve-yBSYks5r0pF3gaJpZM4NMG5d>\n> .\n>\n> --\n> You received this message because you are subscribed to the Google Groups\n> \"cython-github-notifications\" group.\n> To unsubscribe from this group and stop receiving emails from it, send an\n> email to cython-github-notifications+unsubscribe@googlegroups.com.\n> To post to this group, send email to cython-github-notifications@\n> googlegroups.com.\n> To view this discussion on the web visit https://groups.google.com/d/\n> msgid/cython-github-notifications/cython/cython/issues/1690%40github.com\n> <https://groups.google.com/d/msgid/cython-github-notifications/cython/cython/issues/1690%40github.com?utm_medium=email&utm_source=footer>\n> .\n> For more options, visit https://groups.google.com/d/optout.\n>\n",
            "created_at": "2017-04-29T06:12:48Z",
            "html_url": "https://github.com/cython/cython/issues/1690#issuecomment-298150054",
            "id": 298150054,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1690",
            "updated_at": "2017-04-29T06:12:48Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/298150054",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/20618978?v=3",
                "events_url": "https://api.github.com/users/cython-notifications/events{/privacy}",
                "followers_url": "https://api.github.com/users/cython-notifications/followers",
                "following_url": "https://api.github.com/users/cython-notifications/following{/other_user}",
                "gists_url": "https://api.github.com/users/cython-notifications/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cython-notifications",
                "id": 20618978,
                "login": "cython-notifications",
                "organizations_url": "https://api.github.com/users/cython-notifications/orgs",
                "received_events_url": "https://api.github.com/users/cython-notifications/received_events",
                "repos_url": "https://api.github.com/users/cython-notifications/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cython-notifications/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cython-notifications/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cython-notifications"
            }
        },
        {
            "body": "```\r\n2622      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;\r\n2623      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;\r\n2624      goto __pyx_L15;\r\n2625    }\r\n\r\n    CID 1431985 (#1 of 1): Structurally dead code (UNREACHABLE)unreachable:\r\n    This code cannot be reached: {  PyThreadState *__pyx_ts....\r\n\r\n2626    /*exception exit:*/{\r\n2627      __Pyx_PyThreadState_declare\r\n2628      __pyx_L14_error:;\r\n2629      __pyx_t_3 = 0; __pyx_t_2 = 0; __pyx_t_1 = 0; __pyx_t_13 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0;\r\n2630      __Pyx_PyThreadState_assign\r\n2631      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;\r\n2632      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;\r\n2633      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;\r\n```",
            "created_at": "2017-04-29T12:27:50Z",
            "html_url": "https://github.com/cython/cython/issues/1690#issuecomment-298166022",
            "id": 298166022,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1690",
            "updated_at": "2017-04-29T12:28:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/298166022",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/356103?v=3",
                "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
                "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ThomasWaldmann",
                "id": 356103,
                "login": "ThomasWaldmann",
                "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
                "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
                "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ThomasWaldmann"
            }
        },
        {
            "body": "```\r\n1412      kw_args = PyDict_Size(__pyx_kwds);\r\n1413      switch (pos_args) {\r\n\r\n    CID 1431949: Missing break in switch (MISSING_BREAK) [select issue]\r\n\r\n1414        case  0:\r\n1415        if (likely((values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_path)) != 0)) kw_args--;\r\n1416        else goto __pyx_L5_argtuple_error;\r\n\r\n    CID 1431972 (#1 of 1): Missing break in switch (MISSING_BREAK)unterminated_case:\r\n    The case for value 1L is not terminated by a 'break' statement.\r\n\r\n1417        case  1:\r\n1418        if (likely((values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s_bsd_flags)) != 0)) kw_args--;\r\n1419        else {\r\n1420          __Pyx_RaiseArgtupleInvalid(\"set_flags\", 0, 2, 3, 1); __PYX_ERR(0, 74, __pyx_L3_error)\r\n1421        }\r\n\r\n    fallthrough: The above case falls through to this one.\r\n\r\n1422        case  2:\r\n1423        if (kw_args > 0) {\r\n1424          PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s_fd);\r\n1425          if (value) { values[2] = value; kw_args--; }\r\n1426        }\r\n1427      }\r\n```\r\nThis is the most frequent issue seen on coverity scan for cython-generated C code.",
            "created_at": "2017-04-29T12:31:16Z",
            "html_url": "https://github.com/cython/cython/issues/1690#issuecomment-298166218",
            "id": 298166218,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1690",
            "updated_at": "2017-04-29T12:45:02Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/298166218",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/356103?v=3",
                "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
                "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ThomasWaldmann",
                "id": 356103,
                "login": "ThomasWaldmann",
                "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
                "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
                "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ThomasWaldmann"
            }
        },
        {
            "body": "```\r\n 903  /* \"borg/crc32.pyx\":13\r\n 904 * \r\n 905 * \r\n 906 * cdef Py_buffer ro_buffer(object data) except *:             # <<<<<<<<<<<<<<\r\n 907 *     cdef Py_buffer view\r\n 908 *     PyObject_GetBuffer(data, &view, PyBUF_SIMPLE)\r\n 909 */\r\n 910\r\n 911  /* function exit code */\r\n 912  __pyx_L1_error:;\r\n 913  __Pyx_AddTraceback(\"borg.crc32.ro_buffer\", __pyx_clineno, __pyx_lineno, __pyx_filename);\r\n 914  __pyx_L0:;\r\n 915  __Pyx_RefNannyFinishContext();\r\n\r\n    CID 1431984 (#1 of 1): Uninitialized scalar variable (UNINIT)5. uninit_use:\r\n    Using uninitialized value __pyx_r. Field __pyx_r.buf is uninitialized.\r\n \r\n 916  return __pyx_r;\r\n 917}\r\n```\r\nThis one is less frequent, but gets classified as \"high impact\".\r\n",
            "created_at": "2017-04-29T12:52:24Z",
            "html_url": "https://github.com/cython/cython/issues/1690#issuecomment-298167289",
            "id": 298167289,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1690",
            "updated_at": "2017-04-29T12:52:24Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/298167289",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/356103?v=3",
                "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
                "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
                "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
                "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ThomasWaldmann",
                "id": 356103,
                "login": "ThomasWaldmann",
                "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
                "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
                "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ThomasWaldmann"
            }
        },
        {
            "body": "Thanks for bringing this up, Thomas.\r\n\r\nWe try to avoid dead code during generation where possible, but sometimes it's just (too) difficult to avoid. It's definitely harmless, but probably worth taking a look in this case.\r\n\r\nThe \"missing\" break is intentional. The switch statement is essentially used as a jump-ahead goto here. It appears in pretty much every function with a Python signature.\r\n\r\nThe missing initialisation of \"`__pyx_r`\" is usually a false positive but could also refer to a real bug in your own code here. My guess is, however, that coverty is unable to understand the exception handling path here, which should ignore the partially uninitialised struct in the calling code.",
            "created_at": "2017-04-29T16:11:05Z",
            "html_url": "https://github.com/cython/cython/issues/1690#issuecomment-298178100",
            "id": 298178100,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1690",
            "updated_at": "2017-04-29T16:11:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/298178100",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/491659?v=3",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1690/comments",
    "created_at": "2017-04-29T01:25:08Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1690/events",
    "html_url": "https://github.com/cython/cython/issues/1690",
    "id": 225224703,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1690/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1690,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "coverity scan complaining about Cython-generated C code",
    "updated_at": "2017-04-29T16:11:05Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1690",
    "user": {
        "avatar_url": "https://avatars3.githubusercontent.com/u/356103?v=3",
        "events_url": "https://api.github.com/users/ThomasWaldmann/events{/privacy}",
        "followers_url": "https://api.github.com/users/ThomasWaldmann/followers",
        "following_url": "https://api.github.com/users/ThomasWaldmann/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThomasWaldmann/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ThomasWaldmann",
        "id": 356103,
        "login": "ThomasWaldmann",
        "organizations_url": "https://api.github.com/users/ThomasWaldmann/orgs",
        "received_events_url": "https://api.github.com/users/ThomasWaldmann/received_events",
        "repos_url": "https://api.github.com/users/ThomasWaldmann/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ThomasWaldmann/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThomasWaldmann/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ThomasWaldmann"
    }
}