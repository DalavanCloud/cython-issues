{
    "assignee": null,
    "assignees": [],
    "body": "From the ML:\n\n```\nI just installed numpy for both python2 and 3 from an up-to-date\ncheckout of the 1.5.x branch.\n\nI am attempting to cythonize the following code with cython-0.13:\n\n---\ncimport numpy as np\nimport numpy as np\n\ndef test():\n   cdef np.ndarray[ndim=1](np.float64_t,) ret\n   ret_arr = np.zeros((20,), dtype=np.float64)\n   ret = ret_arr\n---\n\nI have this setup.py file:\n\n---\nfrom distutils.core import setup\nfrom distutils.extension import Extension\nfrom Cython.Distutils import build_ext\n\nimport numpy\n\nsetup(\n    cmdclass = {'build_ext': build_ext},\n    ext_modules = [       Extension(\n            \"test_open\", [\"test_open.pyx\"](\n), include_dirs=[           )\n        ](numpy.get_include()]\n)\n    )\n---\n\nWhen I run \"python setup.py build_ext --inplace\", everything is fine.\nWhen I run \"python3 setup.py build_ext --inplace\", I get an error:\n\nrunning build_ext\ncythoning test_open.pyx to test_open.c\n\nError converting Pyrex file to C:\n------------------------------------------------------------\n...\n        # For use in situations where ndarray can't replace PyArrayObject*,\n        # like PyArrayObject**.\n        pass\n\n    ctypedef class numpy.ndarray [PyArrayObject](object):\n        cdef __cythonbufferdefaults__ = {\"mode\": \"strided\"}\n                                                ^\n------------------------------------------------------------\n\n/home/darren/.local/lib/python3.1/site-packages/Cython/Includes/numpy.pxd:173:49:\n\"mode\" is not a buffer option\n\nError converting Pyrex file to C:\n------------------------------------------------------------\n...\ncimport numpy as np\nimport numpy as np\n\n\ndef test():\n   cdef np.ndarray[ndim=1](np.float64_t,) ret\n       ^\n------------------------------------------------------------\n\n/home/darren/temp/test/test_open.pyx:6:8: 'ndarray' is not a type identifier\nbuilding 'test_open' extension\ngcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fPIC\n-I/home/darren/.local/lib/python3.1/site-packages/numpy/core/include\n-I/usr/include/python3.1 -c test_open.c -o\nbuild/temp.linux-x86_64-3.1/test_open.o\ntest_open.c:1: error: #error Do not use this file, it is the result of\na failed Cython compilation.\nerror: command 'gcc' failed with exit status 1\n```\n\nMigrated from http://trac.cython.org/ticket/597",
    "closed_at": "2011-02-25T20:13:43Z",
    "comment_data": [
        {
            "body": "@dagss commented\n\nFollow-up from ML:\n```\nI think I found the problem. In Cython/Compiler/Buffer.py:\n\nbuffer_options = (\"dtype\", \"ndim\", \"mode\", \"negative_indices\", \"cast\")\n\nThe error is being raised somewhere around line 146, so I added some\nprint statements:\n\n    ERR_BUF_OPTION_UNKNOWN = '\"%s\" is not a buffer option: \"%s\"'\n\n    for name, (value, pos) in dictargs.iteritems():\n        if not name in buffer_options:\n            print(type(name), type(buffer_options[           raise CompileError(pos, ERR_BUF_OPTION_UNKNOWN % (name,\nbuffer_options))\n        options[name](0]))\n) = value\n\n    for name, (value, pos) in zip(buffer_options, posargs):\n        if not name in buffer_options:\n            print(type(name), type(buffer_options[           raise CompileError(pos, ERR_BUF_OPTION_UNKNOWN % (name,\nbuffer_options))\n\nThe result:\n\n(<class 'Cython.Compiler.StringEncoding.BytesLiteral'>, <class 'str'>)\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n        # For use in situations where ndarray can't replace PyArrayObject*,\n        # like PyArrayObject**.\n        pass\n\n    ctypedef class numpy.ndarray [object PyArrayObject](0]))\n):\n        cdef __cythonbufferdefaults__ = {\"mode\": \"strided\"}\n                                                ^\n------------------------------------------------------------\n\n/Users/darren/.local/lib/python3.1/site-packages/Cython/Includes/numpy.pxd:173:49:\n\"mode\" is not a buffer option: \"('dtype', 'ndim', 'mode',\n'negative_indices', 'cast')\"\n\nSo the problem appears to be that numpy.pxd is defining\n__cythonbufferdefaults__ with instances of\nCython.Compiler.StringEncoding.BytesLiteral, but Buffer.py is defining\nvalid options as instances of str.\n\n\n```",
            "created_at": "2010-11-22T19:06:40Z",
            "html_url": "https://github.com/cython/cython/issues/1156#issuecomment-240047811",
            "id": 240047811,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1156",
            "updated_at": "2016-08-16T09:10:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/240047811",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "@dalcinl changed **resolution** to `fixed`\n**status** from `new` to `closed`\ncommented\n\nFixed: https://github.com/cython/cython/commit/e12615215b862bf1a240252dd35a90906794559a",
            "created_at": "2011-02-25T20:13:43Z",
            "html_url": "https://github.com/cython/cython/issues/1156#issuecomment-240047819",
            "id": 240047819,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1156",
            "updated_at": "2016-08-16T09:10:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/240047819",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1156/comments",
    "created_at": "2010-11-22T19:06:05Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:41Z",
            "event": "labeled",
            "id": 756762744,
            "label": {
                "color": "444444",
                "name": "Code Generation"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762744"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:41Z",
            "event": "labeled",
            "id": 756762745,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762745"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:42Z",
            "event": "milestoned",
            "id": 756762748,
            "milestone": {
                "title": "0.15"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762748"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2011-02-25T20:13:43Z",
            "event": "closed",
            "id": 756762750,
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762750"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/118410?v=3",
                "events_url": "https://api.github.com/users/dagss/events{/privacy}",
                "followers_url": "https://api.github.com/users/dagss/followers",
                "following_url": "https://api.github.com/users/dagss/following{/other_user}",
                "gists_url": "https://api.github.com/users/dagss/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dagss",
                "id": 118410,
                "login": "dagss",
                "organizations_url": "https://api.github.com/users/dagss/orgs",
                "received_events_url": "https://api.github.com/users/dagss/received_events",
                "repos_url": "https://api.github.com/users/dagss/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dagss/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dagss/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dagss"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:42Z",
            "event": "mentioned",
            "id": 756762753,
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762753"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/118410?v=3",
                "events_url": "https://api.github.com/users/dagss/events{/privacy}",
                "followers_url": "https://api.github.com/users/dagss/followers",
                "following_url": "https://api.github.com/users/dagss/following{/other_user}",
                "gists_url": "https://api.github.com/users/dagss/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dagss",
                "id": 118410,
                "login": "dagss",
                "organizations_url": "https://api.github.com/users/dagss/orgs",
                "received_events_url": "https://api.github.com/users/dagss/received_events",
                "repos_url": "https://api.github.com/users/dagss/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dagss/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dagss/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dagss"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:42Z",
            "event": "subscribed",
            "id": 756762754,
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762754"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/294981?v=3",
                "events_url": "https://api.github.com/users/dalcinl/events{/privacy}",
                "followers_url": "https://api.github.com/users/dalcinl/followers",
                "following_url": "https://api.github.com/users/dalcinl/following{/other_user}",
                "gists_url": "https://api.github.com/users/dalcinl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dalcinl",
                "id": 294981,
                "login": "dalcinl",
                "organizations_url": "https://api.github.com/users/dalcinl/orgs",
                "received_events_url": "https://api.github.com/users/dalcinl/received_events",
                "repos_url": "https://api.github.com/users/dalcinl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dalcinl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dalcinl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dalcinl"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:42Z",
            "event": "mentioned",
            "id": 756762782,
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762782"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/294981?v=3",
                "events_url": "https://api.github.com/users/dalcinl/events{/privacy}",
                "followers_url": "https://api.github.com/users/dalcinl/followers",
                "following_url": "https://api.github.com/users/dalcinl/following{/other_user}",
                "gists_url": "https://api.github.com/users/dalcinl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dalcinl",
                "id": 294981,
                "login": "dalcinl",
                "organizations_url": "https://api.github.com/users/dalcinl/orgs",
                "received_events_url": "https://api.github.com/users/dalcinl/received_events",
                "repos_url": "https://api.github.com/users/dalcinl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dalcinl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dalcinl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dalcinl"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-08-16T09:10:42Z",
            "event": "subscribed",
            "id": 756762783,
            "url": "https://api.github.com/repos/cython/cython/issues/events/756762783"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1156/events",
    "html_url": "https://github.com/cython/cython/issues/1156",
    "id": 171360695,
    "labels": [
        {
            "color": "444444",
            "name": "Code Generation",
            "url": "https://api.github.com/repos/cython/cython/labels/Code%20Generation"
        },
        {
            "color": "444444",
            "name": "defect",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1156/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": "2016-08-16T08:38:59Z",
        "closed_issues": 41,
        "created_at": "2016-08-16T08:38:59Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
            "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
            "followers_url": "https://api.github.com/users/robertwb/followers",
            "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
            "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/robertwb",
            "id": 486017,
            "login": "robertwb",
            "organizations_url": "https://api.github.com/users/robertwb/orgs",
            "received_events_url": "https://api.github.com/users/robertwb/received_events",
            "repos_url": "https://api.github.com/users/robertwb/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/robertwb"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestones/0.15",
        "id": 1944460,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/22/labels",
        "number": 22,
        "open_issues": 1,
        "state": "closed",
        "title": "0.15",
        "updated_at": "2016-08-16T09:14:37Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/22"
    },
    "number": 1156,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "NumPy + Cython + Python 3 = compiler crash",
    "updated_at": "2011-02-25T20:13:43Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1156",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/486017?v=3",
        "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
        "followers_url": "https://api.github.com/users/robertwb/followers",
        "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
        "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/robertwb",
        "id": 486017,
        "login": "robertwb",
        "organizations_url": "https://api.github.com/users/robertwb/orgs",
        "received_events_url": "https://api.github.com/users/robertwb/received_events",
        "repos_url": "https://api.github.com/users/robertwb/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/robertwb"
    }
}