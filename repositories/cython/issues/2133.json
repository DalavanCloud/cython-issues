{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "## Problem ##\r\nWhen specifying numeric constants with the unusual syntax:\r\n10 ** -1\r\ncython most probably inteprets the result as integer, while the python interpreter interprets it as float.\r\nThis only affects constants and does not affect variables.\r\n\r\n\r\n## Minimal Example ##\r\n\r\n### Code ###\r\n_test.pyx / test.py_\r\n\r\n    print (10 ** -1)\r\n    print (1E-1)\r\n    a = 10\r\n    print (a ** -1)\r\n\r\n_setup.py_\r\n\r\n    from distutils.core import setup\r\n    from Cython.Build import cythonize\r\n\r\n    setup(\r\n        ext_modules = cythonize(\"test.pyx\")\r\n    )\r\n\r\n_Compilation_\r\n\r\n    python ./setup.py build_ext --inplace\r\n\r\n### Results ###\r\n\r\npython -c \"import test\"   # with uncompiled test.py\r\n\r\n    0.1\r\n    0.1\r\n    0.1\r\n\r\npython -c \"import test\"   # with compiled test.pyx\r\n    \r\n    0\r\n    0.1\r\n    0.1\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "A bit of an edge case, but I'm inclined to agree. If one of the two operands is a (typed) variable, the result type depends on the variable type. If both sides are literals, however, it should follow Python code semantics, which means that the result is either an arbitrary size non-negative integer or a double float. And that needs to be decided at compile time, as C is quite picky about types. ;)\r\n\r\nThis can still get tricky when the actual code is something like `10 ** (1-2)`, i.e. the right side is an expression rather than a literal, maybe even one that cannot safely be evaluated at compile time. Specifically, Cython does not currently do that for constant float expressions in order to avoid loss (or gain) of precision on string serialisation, so `10 ** -1` is actually not folded into a literal `0.1` in the C code.\r\n\r\nThe problem with literal IEEE-754 float expressions is really that some users might be spelling them out in a specific way (instead of using literals) because they actually rely on the exact semantics, so evaluating them at compile time with any semantics that are not strictly IEEE-754 (such as `fractions.Fraction()`) is straight out, and even evaluating them as Python floats and then using repr() to write them into the C code might not result in exactly the binary double float in C that users expected from the specific expression they wrote.\r\n\r\nLong story short, I think what needs to be done is what CPython does here: if the exponent is negative, coerce both operands to double floats and evaluate the whole expression as double. For numeric literal expressions, the sign should always be available at compile time via internal constant calculation. See `PowNode` and its base classes in `ExprNodes.py`.",
            "created_at": "2018-03-06T19:47:45Z",
            "html_url": "https://github.com/cython/cython/issues/2133#issuecomment-370904936",
            "id": 370904936,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2133",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDkwNDkzNg==",
            "updated_at": "2018-03-06T19:52:42Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/370904936",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I'll note here for whoever wants to fix this issue the places in the documentation that will need to be changed accordingly:\r\n\r\nhttps://github.com/cython/cython/blob/master/docs/src/tutorial/caveats.rst#caveats",
            "created_at": "2018-07-04T11:24:13Z",
            "html_url": "https://github.com/cython/cython/issues/2133#issuecomment-402450198",
            "id": 402450198,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2133",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQwMjQ1MDE5OA==",
            "updated_at": "2018-07-04T11:24:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/402450198",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/12891691?v=4",
                "events_url": "https://api.github.com/users/gabrieldemarmiesse/events{/privacy}",
                "followers_url": "https://api.github.com/users/gabrieldemarmiesse/followers",
                "following_url": "https://api.github.com/users/gabrieldemarmiesse/following{/other_user}",
                "gists_url": "https://api.github.com/users/gabrieldemarmiesse/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gabrieldemarmiesse",
                "id": 12891691,
                "login": "gabrieldemarmiesse",
                "node_id": "MDQ6VXNlcjEyODkxNjkx",
                "organizations_url": "https://api.github.com/users/gabrieldemarmiesse/orgs",
                "received_events_url": "https://api.github.com/users/gabrieldemarmiesse/received_events",
                "repos_url": "https://api.github.com/users/gabrieldemarmiesse/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gabrieldemarmiesse/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gabrieldemarmiesse/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gabrieldemarmiesse"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2133/comments",
    "created_at": "2018-03-06T15:30:43Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-03-06T19:20:48Z",
            "event": "milestoned",
            "id": 1507296423,
            "milestone": {
                "title": "0.29"
            },
            "node_id": "MDE1Ok1pbGVzdG9uZWRFdmVudDE1MDcyOTY0MjM=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1507296423"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-03-06T19:21:08Z",
            "event": "labeled",
            "id": 1507297297,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE1MDcyOTcyOTc=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1507297297"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-03-06T19:21:09Z",
            "event": "labeled",
            "id": 1507297301,
            "label": {
                "color": "444444",
                "name": "Type Analysis"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE1MDcyOTczMDE=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1507297301"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-03-06T19:47:57Z",
            "event": "labeled",
            "id": 1507352241,
            "label": {
                "color": "0e8a16",
                "name": "help wanted"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE1MDczNTIyNDE=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1507352241"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-03-06T19:47:57Z",
            "event": "labeled",
            "id": 1507352242,
            "label": {
                "color": "1d76db",
                "name": "good first issue"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE1MDczNTIyNDI=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1507352242"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2133/events",
    "html_url": "https://github.com/cython/cython/issues/2133",
    "id": 302747005,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425558824,
            "name": "Type Analysis",
            "node_id": "MDU6TGFiZWw0MjU1NTg4MjQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/Type%20Analysis"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        },
        {
            "color": "1d76db",
            "default": true,
            "id": 414805682,
            "name": "good first issue",
            "node_id": "MDU6TGFiZWw0MTQ4MDU2ODI=",
            "url": "https://api.github.com/repos/cython/cython/labels/good%20first%20issue"
        },
        {
            "color": "0e8a16",
            "default": true,
            "id": 414800879,
            "name": "help wanted",
            "node_id": "MDU6TGFiZWw0MTQ4MDA4Nzk=",
            "url": "https://api.github.com/repos/cython/cython/labels/help%20wanted"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2133/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 8,
        "created_at": "2018-03-06T19:20:48Z",
        "creator": {
            "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": null,
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/51",
        "id": 3166944,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/51/labels",
        "node_id": "MDk6TWlsZXN0b25lMzE2Njk0NA==",
        "number": 51,
        "open_issues": 5,
        "state": "open",
        "title": "0.29",
        "updated_at": "2018-07-04T18:28:36Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/51"
    },
    "node_id": "MDU6SXNzdWUzMDI3NDcwMDU=",
    "number": 2133,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "Exponentiation of integer constants interpreted as integer",
    "updated_at": "2018-07-04T11:24:13Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2133",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/3316177?v=4",
        "events_url": "https://api.github.com/users/timostrunk/events{/privacy}",
        "followers_url": "https://api.github.com/users/timostrunk/followers",
        "following_url": "https://api.github.com/users/timostrunk/following{/other_user}",
        "gists_url": "https://api.github.com/users/timostrunk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/timostrunk",
        "id": 3316177,
        "login": "timostrunk",
        "node_id": "MDQ6VXNlcjMzMTYxNzc=",
        "organizations_url": "https://api.github.com/users/timostrunk/orgs",
        "received_events_url": "https://api.github.com/users/timostrunk/received_events",
        "repos_url": "https://api.github.com/users/timostrunk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/timostrunk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/timostrunk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/timostrunk"
    }
}