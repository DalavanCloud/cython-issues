{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Hi! I'm new to Cython, and I've encountered a bug at the compiler level. I must do something wrong, but it's difficult to track since it's in the generated c++ file. Maybe Cython can throw an error in this case?\r\n\r\nI tried to make a minimal example so that it's easier to understand ( and possible help me).\r\nI'm trying to use a c++ class in Cython. \r\n\r\nI use Windows and Anaconda with python 3.6.\r\nWith `pip freeze`, I get `Cython==0.27.3`\r\n\r\n#### the `wrapper.pxd` file:\r\n```python\r\ncdef extern from \"arithmetic_codec.h\" nogil:\r\n\r\n    cdef cppclass Static_Data_Model:\r\n        Static_Data_Model()\r\n        unsigned model_symbols()\r\n        void set_distribution(unsigned number_of_symbols,\r\n                              const double probability[] = 0)\r\n\r\n```\r\n\r\n\r\n#### The `no_context.pyx` file:\r\n```python\r\n# distutils: sources = ecoding/arithmetic_codec.cpp\r\n\r\nimport numpy as np\r\nfrom wrapper cimport *\r\n\r\n\r\ncpdef _compile(self):\r\n    cdef Static_Data_Model data_model\r\n\r\n    distribution = np.array([4,3,8])\r\n    data_model = Static_Data_Model()\r\n\r\n    cdef double [::1] distribution_view = distribution\r\n    cdef unsigned number_of_symbols = len(distribution)\r\n    cdef double* my_ptr = &distribution_view[0]\r\n    data_model.set_distribution(number_of_symbols, my_ptr)\r\n```\r\n\r\n#### the `setup.py` file:\r\n```python\r\nfrom setuptools import setup\r\nfrom setuptools import find_packages\r\nfrom distutils import core\r\nfrom Cython.Build import cythonize\r\n\r\nsetup(name='Entropy-Coding',\r\n      version='0.2',\r\n      install_requires=['numpy', 'Cython'],\r\n      packages=find_packages())\r\n\r\ncore.setup(\r\n    ext_modules=cythonize(\"ecoding/no_context.pyx\",\r\n                          annotate=True,\r\n                          language='c++')\r\n)\r\n```\r\n\r\n#### Here is the error message:\r\n```\r\npython setup.py build_ext --inplace\r\nrunning build_ext\r\nPlease put \"# distutils: language=c++\" in your .pyx or .pxd file(s)\r\nrunning build_ext\r\nbuilding 'ecoding.no_context' extension\r\nC:\\x86_64-5.4.0-release-posix-seh-rt_v5-rev0\\mingw64\\bin\\gcc.exe -mdll -O -Wall -DMS_WIN64 -I.\\ecoding -IC:\\Users\\smith\\Miniconda3\\include -IC:\\Users\\smith\\Miniconda3\\include -c ecoding/no_context.cpp -o build\\temp.win-amd64-3.6\\Release\\ecoding\\no_context.o\r\necoding/no_context.cpp: In function 'PyObject* __pyx_f_7ecoding_10no_context__compile(PyObject*, int)':\r\necoding/no_context.cpp:1894:62: error: aggregate '__pyx_f_7ecoding_10no_context__compile(PyObject*, int)::__pyx_opt_args_17Static_Data_Model_set_distribution __pyx_t_10' has incomplete type and cannot be defined\r\n   struct __pyx_opt_args_17Static_Data_Model_set_distribution __pyx_t_10;\r\n                                                              ^\r\nerror: command 'C:\\\\x86_64-5.4.0-release-posix-seh-rt_v5-rev0\\\\mingw64\\\\bin\\\\gcc.exe' failed with exit status 1\r\n```\r\n\r\nThank you for the help.\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "After further research, it seems that it's the default argument causing the error. It's strange though that Cython doesn't warn about it.",
            "created_at": "2018-02-11T13:34:10Z",
            "html_url": "https://github.com/cython/cython/issues/2098#issuecomment-364751977",
            "id": 364751977,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2098",
            "updated_at": "2018-02-11T13:34:10Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/364751977",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/12891691?v=4",
                "events_url": "https://api.github.com/users/gabrieldemarmiesse/events{/privacy}",
                "followers_url": "https://api.github.com/users/gabrieldemarmiesse/followers",
                "following_url": "https://api.github.com/users/gabrieldemarmiesse/following{/other_user}",
                "gists_url": "https://api.github.com/users/gabrieldemarmiesse/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gabrieldemarmiesse",
                "id": 12891691,
                "login": "gabrieldemarmiesse",
                "organizations_url": "https://api.github.com/users/gabrieldemarmiesse/orgs",
                "received_events_url": "https://api.github.com/users/gabrieldemarmiesse/received_events",
                "repos_url": "https://api.github.com/users/gabrieldemarmiesse/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gabrieldemarmiesse/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gabrieldemarmiesse/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gabrieldemarmiesse"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2098/comments",
    "created_at": "2018-02-11T12:42:24Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/12891691?v=4",
                "events_url": "https://api.github.com/users/gabrieldemarmiesse/events{/privacy}",
                "followers_url": "https://api.github.com/users/gabrieldemarmiesse/followers",
                "following_url": "https://api.github.com/users/gabrieldemarmiesse/following{/other_user}",
                "gists_url": "https://api.github.com/users/gabrieldemarmiesse/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gabrieldemarmiesse",
                "id": 12891691,
                "login": "gabrieldemarmiesse",
                "organizations_url": "https://api.github.com/users/gabrieldemarmiesse/orgs",
                "received_events_url": "https://api.github.com/users/gabrieldemarmiesse/received_events",
                "repos_url": "https://api.github.com/users/gabrieldemarmiesse/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gabrieldemarmiesse/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gabrieldemarmiesse/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gabrieldemarmiesse"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-02-11T13:55:54Z",
            "event": "renamed",
            "id": 1468435243,
            "rename": {
                "from": "xxx has incomplete type and cannot be defined",
                "to": "xxx has incomplete type and cannot be defined (cython doesn't warn the user)"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1468435243"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2098/events",
    "html_url": "https://github.com/cython/cython/issues/2098",
    "id": 296187170,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2098/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 2098,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "xxx has incomplete type and cannot be defined (cython doesn't warn the user)",
    "updated_at": "2018-02-11T13:55:54Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2098",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/12891691?v=4",
        "events_url": "https://api.github.com/users/gabrieldemarmiesse/events{/privacy}",
        "followers_url": "https://api.github.com/users/gabrieldemarmiesse/followers",
        "following_url": "https://api.github.com/users/gabrieldemarmiesse/following{/other_user}",
        "gists_url": "https://api.github.com/users/gabrieldemarmiesse/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gabrieldemarmiesse",
        "id": 12891691,
        "login": "gabrieldemarmiesse",
        "organizations_url": "https://api.github.com/users/gabrieldemarmiesse/orgs",
        "received_events_url": "https://api.github.com/users/gabrieldemarmiesse/received_events",
        "repos_url": "https://api.github.com/users/gabrieldemarmiesse/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gabrieldemarmiesse/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gabrieldemarmiesse/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gabrieldemarmiesse"
    }
}