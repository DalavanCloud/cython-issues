{
    "assignee": null,
    "assignees": [],
    "body": "I ran into this trying to compile [yt](http://yt-project.org) using the latest version of cython to work around an issue in the latest release. Unfortunately that's not possible right now due to what I think is a regression in the cython compiler.\r\n\r\nReproducible with the following test script:\r\n\r\n```bash\r\nwget https://raw.githubusercontent.com/yt-project/yt/master/yt/frontends/artio/_artio_caller.pyx\r\ncython _artio_caller.pyx\r\n```\r\n\r\nCython 0.25.2 compiles this with no problems. Cython's current master branch (specifically 0ef812567) raises the following compiler error:\r\n\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n\r\ncdef extern from *:\r\n    object PyErr_Format(exc, const char *format, ...)\r\n\r\n@cname(\"__Pyx_carray_from_py_float64__t\")\r\ncdef int __Pyx_carray_from_py_float64__t(object o, float64_t *v, Py_ssize_t length) except -1:\r\n                                                  ^\r\n------------------------------------------------------------\r\n\r\ncarray.from_py:77:51: 'float64_t' is not a type identifier\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n    void PyTuple_SET_ITEM(object  p, Py_ssize_t pos, object o)\r\n    void PyList_SET_ITEM(object  p, Py_ssize_t pos, object o)\r\n\r\n\r\n@cname(\"__Pyx_carray_to_py_float64__t\")\r\ncdef inline list __Pyx_carray_to_py_float64__t(float64_t *v, Py_ssize_t length):\r\n                                              ^\r\n------------------------------------------------------------\r\n\r\ncarray.to_py:112:47: 'float64_t' is not a type identifier\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n        PyList_SET_ITEM(l, i, value)\r\n    return l\r\n\r\n\r\n@cname(\"__Pyx_carray_to_tuple_float64__t\")\r\ncdef inline tuple __Pyx_carray_to_tuple_float64__t(float64_t *v, Py_ssize_t length):\r\n                                                  ^\r\n------------------------------------------------------------\r\n\r\ncarray.to_py:124:51: 'float64_t' is not a type identifier\r\n```",
    "closed_at": "2017-06-16T07:19:45Z",
    "comment_data": [
        {
            "body": "Bisect tells me this commit is the culprit:\r\n\r\n```\r\n437fcbe8fc81a10c89d46152f3240dde9c679c32 is the first bad commit\r\ncommit 437fcbe8fc81a10c89d46152f3240dde9c679c32\r\nAuthor: Robert Bradshaw <robertwb@gmail.com>\r\nDate:   Mon May 15 15:52:47 2017 -0700\r\n\r\n    Basic pickling suport.\r\n\r\n:040000 040000 be9c31d654ab738fbdcffb5946481ccdc7fbfb7f ef6d35bb41edb25d6603829fc21563e80b840692 M\tCython\r\n:040000 040000 0ca49e51413da84c629074c891371f3823d46042 b219b42a86bf022d62aa4431588e716b763b8e17 M\ttests\r\n```\r\n\r\nping @robertwb ",
            "created_at": "2017-06-15T21:31:50Z",
            "html_url": "https://github.com/cython/cython/issues/1737#issuecomment-308871618",
            "id": 308871618,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1737",
            "updated_at": "2017-06-15T21:32:03Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/308871618",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "I can work around this issue by setting `auto_pickle=False` in my cython compiler directives.",
            "created_at": "2017-06-15T21:46:15Z",
            "html_url": "https://github.com/cython/cython/issues/1737#issuecomment-308874717",
            "id": 308874717,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1737",
            "updated_at": "2017-06-15T21:46:15Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/308874717",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "Thanks for helping us get ready for the release :). \r\n\r\nThe repro fails due to missing `.pxd` files (and I suspect the root cause was due to a failure to cimport). Can you boil this down to a smaller example? ",
            "created_at": "2017-06-15T23:53:36Z",
            "html_url": "https://github.com/cython/cython/issues/1737#issuecomment-308895891",
            "id": 308895891,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1737",
            "updated_at": "2017-06-15T23:53:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/308895891",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        },
        {
            "body": "argh, sorry for the complicated example in the initial report, I should have realized that you need yt installed to compile that file.\r\n\r\nHere's a minimal example that fails to compile for me:\r\n\r\n```\r\ncimport numpy as np\r\n\r\ncdef class foo:\r\n    cdef np.float64_t bar[3]\r\n```",
            "created_at": "2017-06-16T00:11:06Z",
            "html_url": "https://github.com/cython/cython/issues/1737#issuecomment-308898210",
            "id": 308898210,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1737",
            "updated_at": "2017-06-16T00:11:06Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/308898210",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/3126246?v=3",
                "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
                "followers_url": "https://api.github.com/users/ngoldbaum/followers",
                "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
                "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ngoldbaum",
                "id": 3126246,
                "login": "ngoldbaum",
                "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
                "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
                "repos_url": "https://api.github.com/users/ngoldbaum/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ngoldbaum"
            }
        },
        {
            "body": "Thanks! Scratching my head at what pickling would have to do with this, I found an even simpler repro\r\n\r\n```\r\ncdef np.float64_t bar[3]\r\nprint bar\r\n```\r\nsimilarly \r\n```\r\nfrom numpy cimport float64_t as my_float\r\ncdef my_float bar[3]\r\nprint bar\r\n```\r\n\r\nThe issue is that we're using the declared name (rather than its name in the scope) when generating Cython code. (Surprised this hasn't come up before, maybe people have worked around it?) \r\n\r\nWe'll likely have to do something similar to https://github.com/cython/cython/blob/master/Cython/Compiler/PyrexTypes.py#L3335 , hopefully more principled. ",
            "created_at": "2017-06-16T00:46:56Z",
            "html_url": "https://github.com/cython/cython/issues/1737#issuecomment-308902791",
            "id": 308902791,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1737",
            "updated_at": "2017-06-16T00:46:56Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/308902791",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1737/comments",
    "created_at": "2017-06-15T21:06:58Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-06-15T21:31:50Z",
            "event": "mentioned",
            "id": 1125899920,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1125899920"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-06-15T21:31:50Z",
            "event": "subscribed",
            "id": 1125899921,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1125899921"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-06-16T00:47:03Z",
            "event": "milestoned",
            "id": 1126079245,
            "milestone": {
                "title": "0.26"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1126079245"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": "b5ef664c492813e7e0687043091744eb17d026e9",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/b5ef664c492813e7e0687043091744eb17d026e9",
            "created_at": "2017-06-16T07:19:45Z",
            "event": "referenced",
            "id": 1126354112,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1126354112"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": "750ce9c49de774c138a69ea01a1ed2d45e50a709",
            "commit_url": "https://api.github.com/repos/cython/cython/commits/750ce9c49de774c138a69ea01a1ed2d45e50a709",
            "created_at": "2017-06-16T07:19:45Z",
            "event": "closed",
            "id": 1126354120,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1126354120"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1737/events",
    "html_url": "https://github.com/cython/cython/issues/1737",
    "id": 236314619,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1737/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 4,
        "created_at": "2017-05-18T06:47:17Z",
        "creator": {
            "avatar_url": "https://avatars0.githubusercontent.com/u/486017?v=3",
            "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
            "followers_url": "https://api.github.com/users/robertwb/followers",
            "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
            "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/robertwb",
            "id": 486017,
            "login": "robertwb",
            "organizations_url": "https://api.github.com/users/robertwb/orgs",
            "received_events_url": "https://api.github.com/users/robertwb/received_events",
            "repos_url": "https://api.github.com/users/robertwb/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/robertwb"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/44",
        "id": 2528533,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/44/labels",
        "number": 44,
        "open_issues": 1,
        "state": "open",
        "title": "0.26",
        "updated_at": "2017-06-16T08:20:10Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/44"
    },
    "number": 1737,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Internal compiler error on latest dev version of cython",
    "updated_at": "2017-06-16T07:19:45Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1737",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/3126246?v=3",
        "events_url": "https://api.github.com/users/ngoldbaum/events{/privacy}",
        "followers_url": "https://api.github.com/users/ngoldbaum/followers",
        "following_url": "https://api.github.com/users/ngoldbaum/following{/other_user}",
        "gists_url": "https://api.github.com/users/ngoldbaum/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ngoldbaum",
        "id": 3126246,
        "login": "ngoldbaum",
        "organizations_url": "https://api.github.com/users/ngoldbaum/orgs",
        "received_events_url": "https://api.github.com/users/ngoldbaum/received_events",
        "repos_url": "https://api.github.com/users/ngoldbaum/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ngoldbaum/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ngoldbaum/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ngoldbaum"
    }
}