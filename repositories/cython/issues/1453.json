{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Here is the reproduction code:\n\n``` cython\nfrom cpython cimport array\nimport array\n\n\ncdef struct MyStruct:\n    #float data\n    float [:] data\n\n\ncdef test():\n    print(\"TEST\")\n\n    #cdef float data = 1.\n    cdef array.array data = array.array('f', [1., 2., 3.])\n\n    cdef MyStruct s = MyStruct(data)\n\n    print(s.data[0])\n    print(s)\n\n    cdef list l = [s]\n    cdef MyStruct extracted_s = l[0]\n\n    print(extracted_s.data[0])\n\n    # Make sure that `data` survives at least until now\n    print(data)\n    print(\"DONE\")\n\ntest()\n```\n\nRunning the code I get printed only `\"TEST\"` and `s.data[0]` value. `print(s)` and all subsequent `print` calls crash Python with SEGFAULT (`terminated by signal SIGSEGV (Address boundary error)`).\n\nChanging `float [:]` to a single `float` (uncomment the commented lines in the example above) makes the code work just fine.\n\nI have tried several versions of Cython (0.24.1, 0.23.5, 0.22.1) with Python 3.5.2 and Python 2.7.12 on Arch Linux x64, and Python 2.7.3 on Ubuntu 12.04. The result is always the same - SEGFAULT.\n",
    "closed_at": "2018-02-11T21:26:43Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "As a workaround, I switched to a raw `float*` pointer.\n",
            "created_at": "2016-09-10T09:10:38Z",
            "html_url": "https://github.com/cython/cython/issues/1453#issuecomment-246101214",
            "id": 246101214,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1453",
            "updated_at": "2016-09-10T09:10:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/246101214",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/304265?v=4",
                "events_url": "https://api.github.com/users/frol/events{/privacy}",
                "followers_url": "https://api.github.com/users/frol/followers",
                "following_url": "https://api.github.com/users/frol/following{/other_user}",
                "gists_url": "https://api.github.com/users/frol/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/frol",
                "id": 304265,
                "login": "frol",
                "organizations_url": "https://api.github.com/users/frol/orgs",
                "received_events_url": "https://api.github.com/users/frol/received_events",
                "repos_url": "https://api.github.com/users/frol/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/frol/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/frol/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/frol"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I also hit this. The problem is that Cython does not properly initialize memviewslices in structs, only in the top level scope (function/class).\r\n\r\nA workaround seems to be to manually set `data = None` before you use it, but this will probably still leak memory. This really needs to be fixed.",
            "created_at": "2018-02-11T19:54:57Z",
            "html_url": "https://github.com/cython/cython/issues/1453#issuecomment-364782275",
            "id": 364782275,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1453",
            "updated_at": "2018-02-11T19:56:04Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/364782275",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/5740732?v=4",
                "events_url": "https://api.github.com/users/c-f-h/events{/privacy}",
                "followers_url": "https://api.github.com/users/c-f-h/followers",
                "following_url": "https://api.github.com/users/c-f-h/following{/other_user}",
                "gists_url": "https://api.github.com/users/c-f-h/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/c-f-h",
                "id": 5740732,
                "login": "c-f-h",
                "organizations_url": "https://api.github.com/users/c-f-h/orgs",
                "received_events_url": "https://api.github.com/users/c-f-h/received_events",
                "repos_url": "https://api.github.com/users/c-f-h/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/c-f-h/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/c-f-h/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/c-f-h"
            }
        },
        {
            "author_association": "OWNER",
            "body": "I think the same restriction as for Python objects applies here. The lifetime of structs cannot generally be controlled by Cython, so it should rather be forbidden to use memoryviews as struct members.",
            "created_at": "2018-02-11T21:02:38Z",
            "html_url": "https://github.com/cython/cython/issues/1453#issuecomment-364788179",
            "id": 364788179,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1453",
            "updated_at": "2018-02-11T21:02:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/364788179",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "OWNER",
            "body": "I made this an error here: 0961b9a758592b667495e9155267c6b337b8b214",
            "created_at": "2018-02-11T21:26:43Z",
            "html_url": "https://github.com/cython/cython/issues/1453#issuecomment-364790428",
            "id": 364790428,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1453",
            "updated_at": "2018-02-11T21:26:43Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/364790428",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "But the lifetime can be controlled if the struct is a class member. Until now, I manually worked around this by nulling out the memviews on class creation and in __dealloc__(). Sadly, now you took away this possibility. Can you reconsider this? I'll have to restructure significant parts of my code if this becomes an error.\r\n\r\nIn general, memviews would be a great data structure, but in practice they limit you so much because they are not actually first class citizens and you aren't allowed to use them anywhere except as function locals and direct (!) class members (not in structs or arrays, e.g.). Wouldn't it be better, in the long run, to try to fix some of these shortcomings and make them more of a first class datatype?",
            "created_at": "2018-02-12T09:08:32Z",
            "html_url": "https://github.com/cython/cython/issues/1453#issuecomment-364864228",
            "id": 364864228,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1453",
            "updated_at": "2018-02-12T09:08:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/364864228",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/5740732?v=4",
                "events_url": "https://api.github.com/users/c-f-h/events{/privacy}",
                "followers_url": "https://api.github.com/users/c-f-h/followers",
                "following_url": "https://api.github.com/users/c-f-h/following{/other_user}",
                "gists_url": "https://api.github.com/users/c-f-h/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/c-f-h",
                "id": 5740732,
                "login": "c-f-h",
                "organizations_url": "https://api.github.com/users/c-f-h/orgs",
                "received_events_url": "https://api.github.com/users/c-f-h/received_events",
                "repos_url": "https://api.github.com/users/c-f-h/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/c-f-h/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/c-f-h/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/c-f-h"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1453/comments",
    "created_at": "2016-09-06T17:18:22Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-02-11T21:26:32Z",
            "event": "labeled",
            "id": 1468601104,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1468601104"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-02-11T21:26:32Z",
            "event": "labeled",
            "id": 1468601105,
            "label": {
                "color": "444444",
                "name": "Error Reporting"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1468601105"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-02-11T21:26:32Z",
            "event": "labeled",
            "id": 1468601107,
            "label": {
                "color": "444444",
                "name": "Memory Leak"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1468601107"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-02-11T21:26:36Z",
            "event": "milestoned",
            "id": 1468601136,
            "milestone": {
                "title": "0.28"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1468601136"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-02-11T21:26:43Z",
            "event": "closed",
            "id": 1468601189,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1468601189"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1453/events",
    "html_url": "https://github.com/cython/cython/issues/1453",
    "id": 175302335,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425557478,
            "name": "Error Reporting",
            "url": "https://api.github.com/repos/cython/cython/labels/Error%20Reporting"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425558227,
            "name": "Memory Leak",
            "url": "https://api.github.com/repos/cython/cython/labels/Memory%20Leak"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1453/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 37,
        "created_at": "2017-10-13T20:20:37Z",
        "creator": {
            "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
            "events_url": "https://api.github.com/users/scoder/events{/privacy}",
            "followers_url": "https://api.github.com/users/scoder/followers",
            "following_url": "https://api.github.com/users/scoder/following{/other_user}",
            "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/scoder",
            "id": 491659,
            "login": "scoder",
            "organizations_url": "https://api.github.com/users/scoder/orgs",
            "received_events_url": "https://api.github.com/users/scoder/received_events",
            "repos_url": "https://api.github.com/users/scoder/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/scoder"
        },
        "description": null,
        "due_on": null,
        "html_url": "https://github.com/cython/cython/milestone/49",
        "id": 2836705,
        "labels_url": "https://api.github.com/repos/cython/cython/milestones/49/labels",
        "number": 49,
        "open_issues": 0,
        "state": "open",
        "title": "0.28",
        "updated_at": "2018-02-11T21:26:43Z",
        "url": "https://api.github.com/repos/cython/cython/milestones/49"
    },
    "number": 1453,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "SEGFAULT when using typed memoryview in structs",
    "updated_at": "2018-02-12T09:08:32Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1453",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/304265?v=4",
        "events_url": "https://api.github.com/users/frol/events{/privacy}",
        "followers_url": "https://api.github.com/users/frol/followers",
        "following_url": "https://api.github.com/users/frol/following{/other_user}",
        "gists_url": "https://api.github.com/users/frol/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/frol",
        "id": 304265,
        "login": "frol",
        "organizations_url": "https://api.github.com/users/frol/orgs",
        "received_events_url": "https://api.github.com/users/frol/received_events",
        "repos_url": "https://api.github.com/users/frol/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/frol/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/frol/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/frol"
    }
}