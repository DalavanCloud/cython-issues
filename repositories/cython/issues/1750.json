{
    "assignee": null,
    "assignees": [],
    "body": "I am interested in using `contextlib` with a `cdef` class in cython in order to nicely wrap some OpenGL code. I had asked [this question](https://stackoverflow.com/questions/44733520/using-contextlib-with-cython/44738561) on stackoverflow. While the workaround I had received worked (using `__enter__` and `__exit__`), \r\n\r\nHere is the test code for `vbo.pyx` that was in that answer for reference:\r\n\r\n```\r\nimport contextlib\r\n\r\ncdef class Vbo:\r\n\r\n    def __init__(self):\r\n        pass\r\n\r\n    @contextlib.contextmanager\r\n    def bind(self):\r\n        self.do_something()\r\n        try:\r\n            yield\r\n        finally:\r\n            print(\"Finally\")\r\n\r\n    def do_something(self):\r\n        print(\"something\")\r\n```\r\n\r\nThis code works for me if I remove the `cdef` but this should not be necessary. If I use the sample code as is, I get an error message like this when I use that `cdef` class from python: \r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 2, in <module>\r\n    import vbo\r\n  File \"vbo.pyx\", line 21, in init vbo (vbo.c:15766)\r\n    @contextlib.contextmanager\r\n  File \"C:\\Python27\\lib\\contextlib.py\", line 82, in contextmanager\r\n    @wraps(func)\r\n  File \"C:\\Python27\\lib\\functools.py\", line 33, in update_wrapper\r\n    setattr(wrapper, attr, getattr(wrapped, attr))\r\nAttributeError: 'method_descriptor' object has no attribute '__module__'\r\n```\r\n\r\nIt appears that this behavior might be a possible regression as this works apparently in cython 0.25.1 and python 3.6.1.  I am using cython 0.25.2 and python 2.7.12.",
    "closed_at": "2017-06-24T17:40:42Z",
    "comment_data": [
        {
            "body": "Enabling the \"binding\" directive would probably fix this, i.e. put this comment at the top of your source file:\r\n```# cython: binding=True```\r\nhttp://docs.cython.org/en/latest/src/reference/compilation.html#compiler-directives\r\n\r\nI'm closing this as \"not a bug\", please reopen if that seems wrong to you, but you're probably best off asking on the Cython users mailing list instead.",
            "created_at": "2017-06-24T17:40:42Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-310853041",
            "id": 310853041,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-06-24T17:40:59Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310853041",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "body": "Thanks for pointing me to that page, it is very helpful! Unfortunately, after adding `# cython: binding=True` to the top of the `vbo.pyx`, I now get a different error, which looks like this.\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 28, in <module>\r\n    with v.bind():\r\n  File \"C:\\Python27\\lib\\contextlib.py\", line 17, in __enter__\r\n    return self.gen.next()\r\nAttributeError: 'GeneratorContextManager' object has no attribute 'next'\r\n```\r\n\r\nAny ideas would be appreciated.",
            "created_at": "2017-06-24T20:52:26Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-310865171",
            "id": 310865171,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-06-24T20:52:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/310865171",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/4753028?v=4",
                "events_url": "https://api.github.com/users/AnishN/events{/privacy}",
                "followers_url": "https://api.github.com/users/AnishN/followers",
                "following_url": "https://api.github.com/users/AnishN/following{/other_user}",
                "gists_url": "https://api.github.com/users/AnishN/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/AnishN",
                "id": 4753028,
                "login": "AnishN",
                "organizations_url": "https://api.github.com/users/AnishN/orgs",
                "received_events_url": "https://api.github.com/users/AnishN/received_events",
                "repos_url": "https://api.github.com/users/AnishN/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/AnishN/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/AnishN/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/AnishN"
            }
        },
        {
            "body": "With `binding=True`, you are probably hitting #1724. Can you try Cython master to check if it works now?",
            "created_at": "2017-06-26T10:00:33Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-311016306",
            "id": 311016306,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-06-26T10:00:33Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/311016306",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        },
        {
            "body": "Didn't realize this question was still being looked at after it got closed! I updated to Cython master using `python setup.py install` (Cython version 0.26b0) and tested out my `vbo.pyx` file. Whatever was done in the new update, it absolutely works and I can now use `contextlib` again instead of [this ugly hack](https://stackoverflow.com/a/44738561/2588654) if I use `binding=True`. Thank you!",
            "created_at": "2017-07-09T05:26:03Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-313899831",
            "id": 313899831,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-07-09T05:26:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/313899831",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/4753028?v=4",
                "events_url": "https://api.github.com/users/AnishN/events{/privacy}",
                "followers_url": "https://api.github.com/users/AnishN/followers",
                "following_url": "https://api.github.com/users/AnishN/following{/other_user}",
                "gists_url": "https://api.github.com/users/AnishN/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/AnishN",
                "id": 4753028,
                "login": "AnishN",
                "organizations_url": "https://api.github.com/users/AnishN/orgs",
                "received_events_url": "https://api.github.com/users/AnishN/received_events",
                "repos_url": "https://api.github.com/users/AnishN/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/AnishN/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/AnishN/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/AnishN"
            }
        },
        {
            "body": "Hi, I bumped into this issue and realized the documentation of the 'binding' directive may need some additional explanation by adding an example (such as this case). Reading it twice I still have little clue what 'like len' and 'binding to an instance' really means. Thanks!\r\n(actually perhaps all of the directives need more documentation...)",
            "created_at": "2017-08-10T18:29:00Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-321635245",
            "id": 321635245,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-08-10T18:29:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/321635245",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/138060?v=4",
                "events_url": "https://api.github.com/users/rainwoodman/events{/privacy}",
                "followers_url": "https://api.github.com/users/rainwoodman/followers",
                "following_url": "https://api.github.com/users/rainwoodman/following{/other_user}",
                "gists_url": "https://api.github.com/users/rainwoodman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rainwoodman",
                "id": 138060,
                "login": "rainwoodman",
                "organizations_url": "https://api.github.com/users/rainwoodman/orgs",
                "received_events_url": "https://api.github.com/users/rainwoodman/received_events",
                "repos_url": "https://api.github.com/users/rainwoodman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rainwoodman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rainwoodman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rainwoodman"
            }
        },
        {
            "body": "Is this better? 7d61c7782704237477e883de6bfbfc3526074385\r\nIf you have anything to clarify or add, I'd be happy about a pull request.",
            "created_at": "2017-08-10T21:40:45Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-321681093",
            "id": 321681093,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-08-10T21:40:45Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/321681093",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "body": "Allow me to point to a blogpost of mine which explains some of this: http://opendreamkit.org/2017/06/09/CythonSphinx/",
            "created_at": "2017-08-11T07:37:09Z",
            "html_url": "https://github.com/cython/cython/issues/1750#issuecomment-321748584",
            "id": 321748584,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1750",
            "updated_at": "2017-08-11T07:37:09Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/321748584",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/3625785?v=4",
                "events_url": "https://api.github.com/users/jdemeyer/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdemeyer/followers",
                "following_url": "https://api.github.com/users/jdemeyer/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdemeyer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdemeyer",
                "id": 3625785,
                "login": "jdemeyer",
                "organizations_url": "https://api.github.com/users/jdemeyer/orgs",
                "received_events_url": "https://api.github.com/users/jdemeyer/received_events",
                "repos_url": "https://api.github.com/users/jdemeyer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdemeyer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdemeyer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdemeyer"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1750/comments",
    "created_at": "2017-06-24T17:26:03Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-06-24T17:40:39Z",
            "event": "labeled",
            "id": 1137518914,
            "label": {
                "color": "444444",
                "name": "R: invalid"
            },
            "url": "https://api.github.com/repos/cython/cython/issues/events/1137518914"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-06-24T17:40:42Z",
            "event": "closed",
            "id": 1137518925,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1137518925"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1750/events",
    "html_url": "https://github.com/cython/cython/issues/1750",
    "id": 238330481,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425557122,
            "name": "R: invalid",
            "url": "https://api.github.com/repos/cython/cython/labels/R:%20invalid"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1750/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1750,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Using contextlib with cython",
    "updated_at": "2017-08-11T07:37:09Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1750",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/4753028?v=4",
        "events_url": "https://api.github.com/users/AnishN/events{/privacy}",
        "followers_url": "https://api.github.com/users/AnishN/followers",
        "following_url": "https://api.github.com/users/AnishN/following{/other_user}",
        "gists_url": "https://api.github.com/users/AnishN/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/AnishN",
        "id": 4753028,
        "login": "AnishN",
        "organizations_url": "https://api.github.com/users/AnishN/orgs",
        "received_events_url": "https://api.github.com/users/AnishN/received_events",
        "repos_url": "https://api.github.com/users/AnishN/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/AnishN/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/AnishN/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/AnishN"
    }
}