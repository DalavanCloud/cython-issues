{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Is there any easy way to parallelize Cython compilation? I have a system with 192CPUs and 1TB RAM but it still takes ~7m to build Pandas (even with ccache)\r\n\r\nI opened an issue with Pandas and the devs pointed to Cython, though there wasn’t any certainty that anything could be done to improve the situation within Cython.\r\n\r\nIs there any easy way to cause a third party project to Cythonize in parallel? Is this even a Cython issue?\r\n\r\nThanks, I apologize if this isn’t a Cython issue, or is one that just can’t be trivially addresses by Cython devs. I’ve not had much opportunity to work with Cython which I hope explains my lack of direction in trying to chase this down.\r\n\r\nI did modify the Pandas setup.py to utilize ‘nthreads’ but I’m looking more for something like ‘make -j’ behavior- it seems ‘nthreads’ only optimizes for one file at a time, whereas I’m looking for multiple files being compiled simultaneously\r\n\r\nI’m wondering if the logic in each third party project would need to be rewritten to look more like this: https://github.com/cython/cython/blob/master/Tools/cystdlib.py",
    "closed_at": "2019-02-17T21:26:34Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Oh and just to be clear- I’m not talking about runtime parallelism, the GIL, etc.. I’m purely talking about the process of Cythonizing code that utilizes Cython, which as I understand it takes place at build/install time of the third party project (in this example, Pandas, probably the project using Cuthon most heavily)\r\n\r\nAnd I understand it’s not for Cython devs to PR to third parties if such functionality exists- I’m happy to do that myself.",
            "created_at": "2019-02-13T20:17:36Z",
            "html_url": "https://github.com/cython/cython/issues/2841#issuecomment-463351932",
            "id": 463351932,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2841",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzM1MTkzMg==",
            "updated_at": "2019-02-13T20:18:26Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/463351932",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/8016228?v=4",
                "events_url": "https://api.github.com/users/mzpqnxow/events{/privacy}",
                "followers_url": "https://api.github.com/users/mzpqnxow/followers",
                "following_url": "https://api.github.com/users/mzpqnxow/following{/other_user}",
                "gists_url": "https://api.github.com/users/mzpqnxow/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mzpqnxow",
                "id": 8016228,
                "login": "mzpqnxow",
                "node_id": "MDQ6VXNlcjgwMTYyMjg=",
                "organizations_url": "https://api.github.com/users/mzpqnxow/orgs",
                "received_events_url": "https://api.github.com/users/mzpqnxow/received_events",
                "repos_url": "https://api.github.com/users/mzpqnxow/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mzpqnxow/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mzpqnxow/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mzpqnxow"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "In Python 3.4(or 3.5?) and later, you can use something like `python setup.py build_ext -j20` to run 20 parallel build jobs for the extension module builds. Then normally building the whole package afterwards should reuse the already compiled extensions.\r\n\r\nOther than that, yes, passing `nthreads` to `cythonize()` will also parallelise the code generation of Cython, although that is usually dominated by the C compilation time. Both options together should get you pretty far.",
            "created_at": "2019-02-13T20:35:36Z",
            "html_url": "https://github.com/cython/cython/issues/2841#issuecomment-463358359",
            "id": 463358359,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2841",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzM1ODM1OQ==",
            "updated_at": "2019-02-13T20:35:36Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/463358359",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Fair enough, I think for my usage (Python 2.7, deploying via virtualenv/requirements.txt) there's probably not much I can do without forking cython and making the build use a process pool. Thank you for the help, I will close this out now",
            "created_at": "2019-02-17T21:26:34Z",
            "html_url": "https://github.com/cython/cython/issues/2841#issuecomment-464511606",
            "id": 464511606,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2841",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NDUxMTYwNg==",
            "updated_at": "2019-02-17T21:26:34Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/464511606",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/8016228?v=4",
                "events_url": "https://api.github.com/users/mzpqnxow/events{/privacy}",
                "followers_url": "https://api.github.com/users/mzpqnxow/followers",
                "following_url": "https://api.github.com/users/mzpqnxow/following{/other_user}",
                "gists_url": "https://api.github.com/users/mzpqnxow/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mzpqnxow",
                "id": 8016228,
                "login": "mzpqnxow",
                "node_id": "MDQ6VXNlcjgwMTYyMjg=",
                "organizations_url": "https://api.github.com/users/mzpqnxow/orgs",
                "received_events_url": "https://api.github.com/users/mzpqnxow/received_events",
                "repos_url": "https://api.github.com/users/mzpqnxow/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mzpqnxow/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mzpqnxow/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mzpqnxow"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "You shouldn't have to fork Cython, as cythonize(..., nthreads=N) already uses a process pool to compile multiple files in parallel. Different logic is needed to get setuptools to do the C compilation in parallel (for older version of Python). ",
            "created_at": "2019-02-18T10:44:13Z",
            "html_url": "https://github.com/cython/cython/issues/2841#issuecomment-464681646",
            "id": 464681646,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2841",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NDY4MTY0Ng==",
            "updated_at": "2019-02-18T10:44:13Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/464681646",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "node_id": "MDQ6VXNlcjQ4NjAxNw==",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2841/comments",
    "created_at": "2019-02-13T20:13:50Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/8016228?v=4",
                "events_url": "https://api.github.com/users/mzpqnxow/events{/privacy}",
                "followers_url": "https://api.github.com/users/mzpqnxow/followers",
                "following_url": "https://api.github.com/users/mzpqnxow/following{/other_user}",
                "gists_url": "https://api.github.com/users/mzpqnxow/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mzpqnxow",
                "id": 8016228,
                "login": "mzpqnxow",
                "node_id": "MDQ6VXNlcjgwMTYyMjg=",
                "organizations_url": "https://api.github.com/users/mzpqnxow/orgs",
                "received_events_url": "https://api.github.com/users/mzpqnxow/received_events",
                "repos_url": "https://api.github.com/users/mzpqnxow/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mzpqnxow/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mzpqnxow/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mzpqnxow"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2019-02-17T21:26:34Z",
            "event": "closed",
            "id": 2144909689,
            "node_id": "MDExOkNsb3NlZEV2ZW50MjE0NDkwOTY4OQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/2144909689"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2841/events",
    "html_url": "https://github.com/cython/cython/issues/2841",
    "id": 409981341,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2841/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU0MDk5ODEzNDE=",
    "number": 2841,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Parallelism during Cython compilation of third party projects",
    "updated_at": "2019-02-18T10:44:13Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2841",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/8016228?v=4",
        "events_url": "https://api.github.com/users/mzpqnxow/events{/privacy}",
        "followers_url": "https://api.github.com/users/mzpqnxow/followers",
        "following_url": "https://api.github.com/users/mzpqnxow/following{/other_user}",
        "gists_url": "https://api.github.com/users/mzpqnxow/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mzpqnxow",
        "id": 8016228,
        "login": "mzpqnxow",
        "node_id": "MDQ6VXNlcjgwMTYyMjg=",
        "organizations_url": "https://api.github.com/users/mzpqnxow/orgs",
        "received_events_url": "https://api.github.com/users/mzpqnxow/received_events",
        "repos_url": "https://api.github.com/users/mzpqnxow/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mzpqnxow/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mzpqnxow/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mzpqnxow"
    }
}