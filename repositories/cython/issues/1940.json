{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Hello,\r\n\r\nI have a question. I would like to distribute my cython-powered packages, but I see no easy way to build them in setup.py. I would like setup.py to:\r\n- install my package without cython (from pre-generated C files)\r\n- rebuild (run cythonize) package on `sdist`\r\n- not need to hard-code list of my cython modules (just use glob or something)\r\n- be able to work without .c files (should not be stored in git) or .pyx (should not be distributed). at least one of those sets will be always present of course.\r\n\r\nSome of the recommandations in docs actually doesn't work, for example:\r\n```\r\nsetup(\r\n    setup_requires=[\r\n        'cython>=0.x',\r\n    ],\r\n    extensions = [Extension(\"*\", [\"*.pyx\"])],\r\n    cmdclass={'build_ext': Cython.Build.build_ext},\r\n    ...\r\n)\r\n```\r\nThis doesn't work because we have to import Cython before setup_requires will be run.\r\n\r\nCurrently in my itchy package, I am using this quite complicated code:\r\n\r\n```python\r\nimport os\r\nfrom glob import glob\r\nfrom distutils.command.build_ext import build_ext as _build_ext\r\nfrom distutils.command.sdist import sdist as _sdist\r\nfrom distutils.core import setup\r\nfrom distutils.core import Extension\r\n\r\n\r\n\r\ndef generate_extensions():\r\n\treturn [\r\n\t\t# Compile cython-generated .c files into importable .so libraries.\r\n\t\tExtension(os.path.splitext(name)[0], [name])\r\n\t\tfor name in C_FILES\r\n\t]\r\n\r\n\r\n# In distribution version, there are no pyx files, when you clone package from git, there will be no c files.\r\nCYTHON_FILES = glob('itchy/*.pyx')\r\nC_FILES = glob('itchy/*.c')\r\nextensions = generate_extensions()\r\n\r\n\r\nclass build_ext(_build_ext):\r\n\tdef run(self):\r\n\t\t# Compile cython files (.pyx, some of the .py) into .c files if Cython is available.\r\n\t\ttry:\r\n\t\t\tfrom Cython.Build import cythonize\r\n\t\t\tif CYTHON_FILES:\r\n\t\t\t\tcythonize(CYTHON_FILES)\r\n\r\n\t\t\t\t# Update C_FILES in case they were originally missing.\r\n\t\t\t\tglobal C_FILES, extensions\r\n\t\t\t\tC_FILES = glob('itchy/*.c')\r\n\t\t\t\textensions = generate_extensions()\r\n\t\t\telse:\r\n\t\t\t\tprint('No .pyx files found, building extensions skipped. Pre-built versions will be used.')\r\n\t\texcept ImportError:\r\n\t\t\tprint('Cython is not installed, building extensions skipped. Pre-built versions will be used.')\r\n\t\t\tassert C_FILES, 'C files have to be present in distribution or Cython has to be installed'\r\n\t\t_build_ext.run(self)\r\n\r\n\r\nclass sdist(_sdist):\r\n\tdef run(self):\r\n\t\t# Make sure the compiled Cython files in the distribution are up-to-date\r\n\t\tself.run_command(\"build_ext\")\r\n\t\t_sdist.run(self)\r\n\r\n\r\nsetup(\r\n       ( ...)\r\n\text_modules = extensions,\r\n\tcmdclass = {\r\n\t\t'build_ext': build_ext,\r\n\t\t'sdist': sdist,\r\n\t},\r\n)\r\n```\r\n\r\nThanks for any advice!\r\nJan",
    "closed_at": "2017-10-16T19:26:38Z",
    "comment_data": [
        {
            "author_association": "OWNER",
            "body": "This isn't a bug or feature request. A better forum for such questions would be cython-users@googlegroups.com or stack overflow. ",
            "created_at": "2017-10-16T19:26:38Z",
            "html_url": "https://github.com/cython/cython/issues/1940#issuecomment-337006999",
            "id": 337006999,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/1940",
            "updated_at": "2017-10-16T19:26:38Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/337006999",
            "user": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1940/comments",
    "created_at": "2017-10-16T13:33:56Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars3.githubusercontent.com/u/486017?v=4",
                "events_url": "https://api.github.com/users/robertwb/events{/privacy}",
                "followers_url": "https://api.github.com/users/robertwb/followers",
                "following_url": "https://api.github.com/users/robertwb/following{/other_user}",
                "gists_url": "https://api.github.com/users/robertwb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/robertwb",
                "id": 486017,
                "login": "robertwb",
                "organizations_url": "https://api.github.com/users/robertwb/orgs",
                "received_events_url": "https://api.github.com/users/robertwb/received_events",
                "repos_url": "https://api.github.com/users/robertwb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/robertwb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/robertwb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/robertwb"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2017-10-16T19:26:38Z",
            "event": "closed",
            "id": 1295522596,
            "url": "https://api.github.com/repos/cython/cython/issues/events/1295522596"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/1940/events",
    "html_url": "https://github.com/cython/cython/issues/1940",
    "id": 265771885,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/1940/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 1940,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Packaging cython modules",
    "updated_at": "2017-10-16T19:26:38Z",
    "url": "https://api.github.com/repos/cython/cython/issues/1940",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/1970226?v=4",
        "events_url": "https://api.github.com/users/leftys/events{/privacy}",
        "followers_url": "https://api.github.com/users/leftys/followers",
        "following_url": "https://api.github.com/users/leftys/following{/other_user}",
        "gists_url": "https://api.github.com/users/leftys/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/leftys",
        "id": 1970226,
        "login": "leftys",
        "organizations_url": "https://api.github.com/users/leftys/orgs",
        "received_events_url": "https://api.github.com/users/leftys/received_events",
        "repos_url": "https://api.github.com/users/leftys/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/leftys/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/leftys/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/leftys"
    }
}