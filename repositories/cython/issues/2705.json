{
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "I'm getting a traceback when compiling the following with Cython 0.29:\r\n```\r\nimport cython\r\n\r\n@cython.ccall\r\n@cython.locals(a=dict)\r\ndef aa(a):\r\n  \r\n  try:\r\n    alias = a\r\n  except:\r\n    alias = None\r\n  for v in alias.values():\r\n    pass\r\n```",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Thanks for the report. First of all, I only get this in Py2 mode, where using `d.values()` is inefficient. You probably want to enable `language_level=3`.\r\n\r\nAs you probably noticed when cutting down the reproducer above, it's a combination of type inference and optimisations. The call to `dict.values()` normally gets optimised into a C-API call (`PyDict_Values()`) _before_ type inference, and therefore does not apply here (it should!). Apparently, a later step in the pipeline still assumes that the optimisation has been applied and makes inconsistent changes to the parse tree, which then leads to the compiler crash during code generation.\r\n\r\nWhen I remove the try-except, it works. I guess that's because a single assignment is handled differently from multiple alternative assignments here. That's clearly part of the issue. (Second thing to look into.)\r\n\r\nI think the right fix is to make sure we have the correct symbol table entry for the `alias` variable after type inference/analysis, the one that knows that it's backed by a C-API function.",
            "created_at": "2018-11-09T06:52:44Z",
            "html_url": "https://github.com/cython/cython/issues/2705#issuecomment-437267638",
            "id": 437267638,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2705",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzI2NzYzOA==",
            "updated_at": "2018-11-09T06:57:50Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/437267638",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2705/comments",
    "created_at": "2018-11-08T20:18:14Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-11-09T06:52:40Z",
            "event": "labeled",
            "id": 1956151795,
            "label": {
                "color": "444444",
                "name": "defect"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE5NTYxNTE3OTU=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1956151795"
        },
        {
            "actor": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-11-09T06:52:40Z",
            "event": "labeled",
            "id": 1956151797,
            "label": {
                "color": "444444",
                "name": "Type Analysis"
            },
            "node_id": "MDEyOkxhYmVsZWRFdmVudDE5NTYxNTE3OTc=",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1956151797"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2705/events",
    "html_url": "https://github.com/cython/cython/issues/2705",
    "id": 378900080,
    "labels": [
        {
            "color": "444444",
            "default": false,
            "id": 425558824,
            "name": "Type Analysis",
            "node_id": "MDU6TGFiZWw0MjU1NTg4MjQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/Type%20Analysis"
        },
        {
            "color": "444444",
            "default": false,
            "id": 425553654,
            "name": "defect",
            "node_id": "MDU6TGFiZWw0MjU1NTM2NTQ=",
            "url": "https://api.github.com/repos/cython/cython/labels/defect"
        }
    ],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2705/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNzg5MDAwODA=",
    "number": 2705,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "open",
    "title": "python compiler error, pure python mode",
    "updated_at": "2018-11-09T06:57:50Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2705",
    "user": {
        "avatar_url": "https://avatars0.githubusercontent.com/u/234443?v=4",
        "events_url": "https://api.github.com/users/jpe/events{/privacy}",
        "followers_url": "https://api.github.com/users/jpe/followers",
        "following_url": "https://api.github.com/users/jpe/following{/other_user}",
        "gists_url": "https://api.github.com/users/jpe/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jpe",
        "id": 234443,
        "login": "jpe",
        "node_id": "MDQ6VXNlcjIzNDQ0Mw==",
        "organizations_url": "https://api.github.com/users/jpe/orgs",
        "received_events_url": "https://api.github.com/users/jpe/received_events",
        "repos_url": "https://api.github.com/users/jpe/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jpe/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jpe/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jpe"
    }
}