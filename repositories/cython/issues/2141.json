{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I am trying to use the cython dev version in scikit-learn in order to use beta-test the const memoryview feature (#1869). As part of this effort I bump into the following problem: when you have two typedefs with the same definition you can not create a memoryview of one type from a memoryview of the other. Note the same error happens both in cython 0.28rc1 and cython 0.27.3.\r\n\r\nA snippet to reproduce the problem:\r\n```python\r\nctypedef fused my_floating_1:\r\n    double\r\n    float\r\n\r\nctypedef fused my_floating_2:\r\n    double\r\n    float\r\n\r\ndef test(my_floating_1[:] mv1, my_floating_2[:] _):\r\n    cdef my_floating_2[:] mv2 = mv1\r\n```\r\n\r\nThe error I get:\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nctypedef fused my_floating_2:\r\n    double\r\n    float\r\n\r\ndef test(my_floating_1[:] mv1, my_floating_2[:] _):\r\n    cdef my_floating_2[:] mv2 = mv1\r\n                               ^\r\n------------------------------------------------------------\r\n\r\n/tmp/test_cython_1.pyx:10:32: Different base types for memoryviews (double, float)\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\nctypedef fused my_floating_2:\r\n    double\r\n    float\r\n\r\ndef test(my_floating_1[:] mv1, my_floating_2[:] _):\r\n    cdef my_floating_2[:] mv2 = mv1\r\n                               ^\r\n------------------------------------------------------------\r\n\r\n/tmp/test_cython_1.pyx:10:32: Different base types for memoryviews (float, double)\r\n```\r\n\r\n<details>\r\n<summary>More context on how I bumped into this (trying to create a non-const memoryview from a const memoryview) </summary>\r\n\r\nAt the moment const and fused types do not play nice together as per https://github.com/cython/cython/issues/1772. As I mention in https://github.com/cython/cython/issues/1772#issuecomment-371484338, a work-around I found is to move const inside the definition of the fused type. The problem is that I then hit an error when trying to create a read-write memoryview from a read-only memoryview:\r\n\r\n```cython\r\nctypedef fused my_floating:\r\n    double\r\n    float\r\n\r\nctypedef fused const_my_floating:\r\n    const double\r\n    const float\r\n\r\ndef test(my_floating[:] rw, const_my_floating[:] ro_arg):\r\n    cdef const_my_floating[:] ro = rw\r\n```\r\n\r\nThe error I get:\r\n```\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n# def test(my_floating[:] rw):\r\n#     cdef const_my_floating[:] ro = rw\r\n\r\n# Different base types for memoryviews (float, const double)\r\ndef test(my_floating[:] rw, const_my_floating[:] ro_arg):\r\n    cdef const_my_floating[:] ro = rw\r\n                                  ^\r\n------------------------------------------------------------\r\n\r\n/tmp/test_cython.pyx:22:35: Different base types for memoryviews (double, const float)\r\n\r\nError compiling Cython file:\r\n------------------------------------------------------------\r\n...\r\n# def test(my_floating[:] rw):\r\n#     cdef const_my_floating[:] ro = rw\r\n\r\n# Different base types for memoryviews (float, const double)\r\ndef test(my_floating[:] rw, const_my_floating[:] ro_arg):\r\n    cdef const_my_floating[:] ro = rw\r\n                                  ^\r\n------------------------------------------------------------\r\n\r\n/tmp/test_cython.pyx:22:35: Different base types for memoryviews (float, const double)\r\n```\r\n\r\n\r\n</details>",
    "closed_at": "2018-03-12T09:07:32Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Sorry I just understand this is mentioned in http://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html#fused-types-and-arrays so that the Cartesian product of types is generated. Hmmm OK it seems like having a function that takes that has a signature like this:\r\n\r\n```\r\ndef func(const floating[:] ro, floating[:] rw):\r\n    ...\r\n```\r\n\r\nwill need https://github.com/cython/cython/issues/1772 to be fixed.",
            "created_at": "2018-03-12T09:07:32Z",
            "html_url": "https://github.com/cython/cython/issues/2141#issuecomment-372238161",
            "id": 372238161,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2141",
            "node_id": "MDEyOklzc3VlQ29tbWVudDM3MjIzODE2MQ==",
            "updated_at": "2018-03-12T09:07:32Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/372238161",
            "user": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/1680079?v=4",
                "events_url": "https://api.github.com/users/lesteve/events{/privacy}",
                "followers_url": "https://api.github.com/users/lesteve/followers",
                "following_url": "https://api.github.com/users/lesteve/following{/other_user}",
                "gists_url": "https://api.github.com/users/lesteve/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lesteve",
                "id": 1680079,
                "login": "lesteve",
                "node_id": "MDQ6VXNlcjE2ODAwNzk=",
                "organizations_url": "https://api.github.com/users/lesteve/orgs",
                "received_events_url": "https://api.github.com/users/lesteve/received_events",
                "repos_url": "https://api.github.com/users/lesteve/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lesteve/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lesteve/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lesteve"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2141/comments",
    "created_at": "2018-03-12T08:52:04Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars1.githubusercontent.com/u/1680079?v=4",
                "events_url": "https://api.github.com/users/lesteve/events{/privacy}",
                "followers_url": "https://api.github.com/users/lesteve/followers",
                "following_url": "https://api.github.com/users/lesteve/following{/other_user}",
                "gists_url": "https://api.github.com/users/lesteve/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lesteve",
                "id": 1680079,
                "login": "lesteve",
                "node_id": "MDQ6VXNlcjE2ODAwNzk=",
                "organizations_url": "https://api.github.com/users/lesteve/orgs",
                "received_events_url": "https://api.github.com/users/lesteve/received_events",
                "repos_url": "https://api.github.com/users/lesteve/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lesteve/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lesteve/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lesteve"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-03-12T09:07:32Z",
            "event": "closed",
            "id": 1515722856,
            "node_id": "MDExOkNsb3NlZEV2ZW50MTUxNTcyMjg1Ng==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1515722856"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2141/events",
    "html_url": "https://github.com/cython/cython/issues/2141",
    "id": 304284012,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2141/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzMDQyODQwMTI=",
    "number": 2141,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Different base types for memoryviews although both typedefs have the exact same definition",
    "updated_at": "2018-03-12T09:07:32Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2141",
    "user": {
        "avatar_url": "https://avatars1.githubusercontent.com/u/1680079?v=4",
        "events_url": "https://api.github.com/users/lesteve/events{/privacy}",
        "followers_url": "https://api.github.com/users/lesteve/followers",
        "following_url": "https://api.github.com/users/lesteve/following{/other_user}",
        "gists_url": "https://api.github.com/users/lesteve/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lesteve",
        "id": 1680079,
        "login": "lesteve",
        "node_id": "MDQ6VXNlcjE2ODAwNzk=",
        "organizations_url": "https://api.github.com/users/lesteve/orgs",
        "received_events_url": "https://api.github.com/users/lesteve/received_events",
        "repos_url": "https://api.github.com/users/lesteve/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lesteve/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lesteve/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lesteve"
    }
}