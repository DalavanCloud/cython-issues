{
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "`Cython.Build.cythonize` does not respect the `CC` and / or `GCC` environment variables and defaults to the `gcc` binary. This is especially problematic with `conda-build >= 3.0`, where the `{{ compiler('c') }}` requirement installs compilers of the form `x86_64-conda_cos6-linux-gnu-cc` instead of `cc`, etc.\r\n\r\nI created an example Cython package that [fails](https://gitlab.com/ostrokach/cython-bug/-/jobs/87513018) to build using [standard conda-build](https://gitlab.com/ostrokach/cython-bug/blob/master/.ci/conda-fail/build.sh) but [passes](https://gitlab.com/ostrokach/cython-bug/-/jobs/87513021) if I [create symlinks](https://gitlab.com/ostrokach/cython-bug/blob/master/.ci/conda-pass/build.sh) from `gcc` to `${GCC}`.\r\n\r\nSee also: [StackOverflow - Set default compiler when using Cython and setuptools to compile multiple extensions](https://stackoverflow.com/questions/47770000/set-default-compiler-when-using-cython-and-setuptools-to-compile-multiple-extens)",
    "closed_at": "2018-08-07T21:36:05Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "`cythonize` uses distutils, which makes use of `CC`. Are you sure the env vars are set correctly on your side?",
            "created_at": "2018-08-07T19:13:27Z",
            "html_url": "https://github.com/cython/cython/issues/2535#issuecomment-411169440",
            "id": 411169440,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2535",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTE2OTQ0MA==",
            "updated_at": "2018-08-07T19:13:27Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/411169440",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "I think the environment variables are set correctly.\r\n\r\nThe only difference between a passing and a failing script are the lines:\r\n```bash\r\nln -s ${CC} $(dirname ${CC})/cc\r\nln -s ${GCC} $(dirname ${GCC})/gcc\r\n```\r\n\r\nIt seems that distutils is in legacy mode, and its use is [no longer recommended](https://packaging.python.org/guides/tool-recommendations/)?",
            "created_at": "2018-08-07T19:19:28Z",
            "html_url": "https://github.com/cython/cython/issues/2535#issuecomment-411171196",
            "id": 411171196,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2535",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTE3MTE5Ng==",
            "updated_at": "2018-08-07T19:19:28Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/411171196",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/5614375?v=4",
                "events_url": "https://api.github.com/users/ostrokach/events{/privacy}",
                "followers_url": "https://api.github.com/users/ostrokach/followers",
                "following_url": "https://api.github.com/users/ostrokach/following{/other_user}",
                "gists_url": "https://api.github.com/users/ostrokach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ostrokach",
                "id": 5614375,
                "login": "ostrokach",
                "node_id": "MDQ6VXNlcjU2MTQzNzU=",
                "organizations_url": "https://api.github.com/users/ostrokach/orgs",
                "received_events_url": "https://api.github.com/users/ostrokach/received_events",
                "repos_url": "https://api.github.com/users/ostrokach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ostrokach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ostrokach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ostrokach"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`distutils` is in the stdlib, so it is not necessary to recommend its use. It is always used when building extension modules. And it definitely uses `$CC` on unixy systems.\r\n\r\nIn fact, there is nothing special about Cython at all here. If you can build other packages with binary modules, then you should be able to build Cython generated modules.",
            "created_at": "2018-08-07T19:27:08Z",
            "html_url": "https://github.com/cython/cython/issues/2535#issuecomment-411173322",
            "id": 411173322,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2535",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTE3MzMyMg==",
            "updated_at": "2018-08-07T19:27:08Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/411173322",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Maybe Cython may be missing a call to `distutils.sysconfig.customize_compiler(c)`?\r\n\r\n```python\r\nimport distutils.ccompiler\r\n\r\nc = distutils.ccompiler.new_compiler()\r\nprint(c.compiler)\r\n# prints ['cc']\r\n\r\ndistutils.sysconfig.customize_compiler(c)\r\nprint(c.compiler)\r\n# prints ['/path/to/my/${CC}', '-Wsign-compare', '-DNDEBUG', '-g', '-fwrapv', '-O3', '-Wall', '-Wstrict-prototypes']\r\n```",
            "created_at": "2018-08-07T19:42:54Z",
            "html_url": "https://github.com/cython/cython/issues/2535#issuecomment-411177761",
            "id": 411177761,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2535",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTE3Nzc2MQ==",
            "updated_at": "2018-08-07T19:44:25Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/411177761",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/5614375?v=4",
                "events_url": "https://api.github.com/users/ostrokach/events{/privacy}",
                "followers_url": "https://api.github.com/users/ostrokach/followers",
                "following_url": "https://api.github.com/users/ostrokach/following{/other_user}",
                "gists_url": "https://api.github.com/users/ostrokach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ostrokach",
                "id": 5614375,
                "login": "ostrokach",
                "node_id": "MDQ6VXNlcjU2MTQzNzU=",
                "organizations_url": "https://api.github.com/users/ostrokach/orgs",
                "received_events_url": "https://api.github.com/users/ostrokach/received_events",
                "repos_url": "https://api.github.com/users/ostrokach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ostrokach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ostrokach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ostrokach"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Again, Cython is _not_ calling the C compiler. It's done by distutils, which makes use of `$CC`.",
            "created_at": "2018-08-07T19:50:52Z",
            "html_url": "https://github.com/cython/cython/issues/2535#issuecomment-411179955",
            "id": 411179955,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2535",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTE3OTk1NQ==",
            "updated_at": "2018-08-07T19:50:52Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/411179955",
            "user": {
                "avatar_url": "https://avatars0.githubusercontent.com/u/491659?v=4",
                "events_url": "https://api.github.com/users/scoder/events{/privacy}",
                "followers_url": "https://api.github.com/users/scoder/followers",
                "following_url": "https://api.github.com/users/scoder/following{/other_user}",
                "gists_url": "https://api.github.com/users/scoder/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scoder",
                "id": 491659,
                "login": "scoder",
                "node_id": "MDQ6VXNlcjQ5MTY1OQ==",
                "organizations_url": "https://api.github.com/users/scoder/orgs",
                "received_events_url": "https://api.github.com/users/scoder/received_events",
                "repos_url": "https://api.github.com/users/scoder/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scoder/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scoder/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scoder"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thank you for your help, and sorry for the noise. \r\n\r\nThis issue is not related to Cython.\r\n\r\n----\r\n\r\nFor the benefit of others, for whatever reason, this issue only appears when the `conda-forge` channel is ahead of the `defaults` channel in the `~/.condarc` file... ",
            "created_at": "2018-08-07T21:36:05Z",
            "html_url": "https://github.com/cython/cython/issues/2535#issuecomment-411210530",
            "id": 411210530,
            "issue_url": "https://api.github.com/repos/cython/cython/issues/2535",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTIxMDUzMA==",
            "updated_at": "2018-08-07T21:36:05Z",
            "url": "https://api.github.com/repos/cython/cython/issues/comments/411210530",
            "user": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/5614375?v=4",
                "events_url": "https://api.github.com/users/ostrokach/events{/privacy}",
                "followers_url": "https://api.github.com/users/ostrokach/followers",
                "following_url": "https://api.github.com/users/ostrokach/following{/other_user}",
                "gists_url": "https://api.github.com/users/ostrokach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ostrokach",
                "id": 5614375,
                "login": "ostrokach",
                "node_id": "MDQ6VXNlcjU2MTQzNzU=",
                "organizations_url": "https://api.github.com/users/ostrokach/orgs",
                "received_events_url": "https://api.github.com/users/ostrokach/received_events",
                "repos_url": "https://api.github.com/users/ostrokach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ostrokach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ostrokach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ostrokach"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/cython/cython/issues/2535/comments",
    "created_at": "2018-08-07T17:38:38Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars2.githubusercontent.com/u/5614375?v=4",
                "events_url": "https://api.github.com/users/ostrokach/events{/privacy}",
                "followers_url": "https://api.github.com/users/ostrokach/followers",
                "following_url": "https://api.github.com/users/ostrokach/following{/other_user}",
                "gists_url": "https://api.github.com/users/ostrokach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ostrokach",
                "id": 5614375,
                "login": "ostrokach",
                "node_id": "MDQ6VXNlcjU2MTQzNzU=",
                "organizations_url": "https://api.github.com/users/ostrokach/orgs",
                "received_events_url": "https://api.github.com/users/ostrokach/received_events",
                "repos_url": "https://api.github.com/users/ostrokach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ostrokach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ostrokach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ostrokach"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2018-08-07T21:36:05Z",
            "event": "closed",
            "id": 1776372435,
            "node_id": "MDExOkNsb3NlZEV2ZW50MTc3NjM3MjQzNQ==",
            "url": "https://api.github.com/repos/cython/cython/issues/events/1776372435"
        }
    ],
    "events_url": "https://api.github.com/repos/cython/cython/issues/2535/events",
    "html_url": "https://github.com/cython/cython/issues/2535",
    "id": 348419796,
    "labels": [],
    "labels_url": "https://api.github.com/repos/cython/cython/issues/2535/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzNDg0MTk3OTY=",
    "number": 2535,
    "repository_url": "https://api.github.com/repos/cython/cython",
    "state": "closed",
    "title": "Cython.Build.cythonize does not respect CC or GCC environment variables",
    "updated_at": "2018-08-07T21:36:05Z",
    "url": "https://api.github.com/repos/cython/cython/issues/2535",
    "user": {
        "avatar_url": "https://avatars2.githubusercontent.com/u/5614375?v=4",
        "events_url": "https://api.github.com/users/ostrokach/events{/privacy}",
        "followers_url": "https://api.github.com/users/ostrokach/followers",
        "following_url": "https://api.github.com/users/ostrokach/following{/other_user}",
        "gists_url": "https://api.github.com/users/ostrokach/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ostrokach",
        "id": 5614375,
        "login": "ostrokach",
        "node_id": "MDQ6VXNlcjU2MTQzNzU=",
        "organizations_url": "https://api.github.com/users/ostrokach/orgs",
        "received_events_url": "https://api.github.com/users/ostrokach/received_events",
        "repos_url": "https://api.github.com/users/ostrokach/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ostrokach/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ostrokach/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ostrokach"
    }
}