{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/cython/cython/issues/1607/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/cython/cython/pulls/1607/commits"
        },
        "html": {
            "href": "https://github.com/cython/cython/pull/1607"
        },
        "issue": {
            "href": "https://api.github.com/repos/cython/cython/issues/1607"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/cython/cython/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/cython/cython/pulls/1607/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/cython/cython/pulls/1607"
        },
        "statuses": {
            "href": "https://api.github.com/repos/cython/cython/statuses/dd775d02b04334bb5c89b718f56008739aa12219"
        }
    },
    "assignee": null,
    "assignees": [],
    "base": {
        "label": "cython:master",
        "ref": "master",
        "repo": {
            "archive_url": "https://api.github.com/repos/cython/cython/{archive_format}{/ref}",
            "assignees_url": "https://api.github.com/repos/cython/cython/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/cython/cython/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/cython/cython/branches{/branch}",
            "clone_url": "https://github.com/cython/cython.git",
            "collaborators_url": "https://api.github.com/repos/cython/cython/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/cython/cython/comments{/number}",
            "commits_url": "https://api.github.com/repos/cython/cython/commits{/sha}",
            "compare_url": "https://api.github.com/repos/cython/cython/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/cython/cython/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/cython/cython/contributors",
            "created_at": "2010-11-21T07:44:20Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/cython/cython/deployments",
            "description": "A Python to C compiler",
            "downloads_url": "https://api.github.com/repos/cython/cython/downloads",
            "events_url": "https://api.github.com/repos/cython/cython/events",
            "fork": false,
            "forks": 486,
            "forks_count": 486,
            "forks_url": "https://api.github.com/repos/cython/cython/forks",
            "full_name": "cython/cython",
            "git_commits_url": "https://api.github.com/repos/cython/cython/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/cython/cython/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/cython/cython/git/tags{/sha}",
            "git_url": "git://github.com/cython/cython.git",
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_wiki": true,
            "homepage": "http://cython.org",
            "hooks_url": "https://api.github.com/repos/cython/cython/hooks",
            "html_url": "https://github.com/cython/cython",
            "id": 1099265,
            "issue_comment_url": "https://api.github.com/repos/cython/cython/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/cython/cython/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/cython/cython/issues{/number}",
            "keys_url": "https://api.github.com/repos/cython/cython/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/cython/cython/labels{/name}",
            "language": "Python",
            "languages_url": "https://api.github.com/repos/cython/cython/languages",
            "merges_url": "https://api.github.com/repos/cython/cython/merges",
            "milestones_url": "https://api.github.com/repos/cython/cython/milestones{/number}",
            "mirror_url": null,
            "name": "cython",
            "notifications_url": "https://api.github.com/repos/cython/cython/notifications{?since,all,participating}",
            "open_issues": 348,
            "open_issues_count": 348,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/486082?v=3",
                "events_url": "https://api.github.com/users/cython/events{/privacy}",
                "followers_url": "https://api.github.com/users/cython/followers",
                "following_url": "https://api.github.com/users/cython/following{/other_user}",
                "gists_url": "https://api.github.com/users/cython/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cython",
                "id": 486082,
                "login": "cython",
                "organizations_url": "https://api.github.com/users/cython/orgs",
                "received_events_url": "https://api.github.com/users/cython/received_events",
                "repos_url": "https://api.github.com/users/cython/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cython/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cython/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/cython"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/cython/cython/pulls{/number}",
            "pushed_at": "2017-02-15T21:15:09Z",
            "releases_url": "https://api.github.com/repos/cython/cython/releases{/id}",
            "size": 47416,
            "ssh_url": "git@github.com:cython/cython.git",
            "stargazers_count": 2105,
            "stargazers_url": "https://api.github.com/repos/cython/cython/stargazers",
            "statuses_url": "https://api.github.com/repos/cython/cython/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/cython/cython/subscribers",
            "subscription_url": "https://api.github.com/repos/cython/cython/subscription",
            "svn_url": "https://github.com/cython/cython",
            "tags_url": "https://api.github.com/repos/cython/cython/tags",
            "teams_url": "https://api.github.com/repos/cython/cython/teams",
            "trees_url": "https://api.github.com/repos/cython/cython/git/trees{/sha}",
            "updated_at": "2017-02-16T11:06:20Z",
            "url": "https://api.github.com/repos/cython/cython",
            "watchers": 2105,
            "watchers_count": 2105
        },
        "sha": "299ad1163ac8e72c1910da3e03013e7634a94b91",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/486082?v=3",
            "events_url": "https://api.github.com/users/cython/events{/privacy}",
            "followers_url": "https://api.github.com/users/cython/followers",
            "following_url": "https://api.github.com/users/cython/following{/other_user}",
            "gists_url": "https://api.github.com/users/cython/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/cython",
            "id": 486082,
            "login": "cython",
            "organizations_url": "https://api.github.com/users/cython/orgs",
            "received_events_url": "https://api.github.com/users/cython/received_events",
            "repos_url": "https://api.github.com/users/cython/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/cython/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/cython/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/cython"
        }
    },
    "body": "I've been working for quite some time on the usage of Pythran as a backend for\r\nthe Numpy operations that Cython can generate. The associated PR on github can\r\nbe found here: . This work has been sponsored by the OpenDreamKit project\r\n(https://github.com/OpenDreamKit/OpenDreamKit/).\r\n\r\nFirst of all, the Pythran project\r\n(https://github.com/serge-sans-paille/pythran) is a (subset of) Python to C++\r\ncompiler, that aims at optimizing \"scientific\" Python code.  It also provides a\r\nfull C++ implementation of a major set of the Numpy API.  Some of the advantage\r\nof this implementation is that it supports expression templates and SIMD\r\ninstructions (partially thanks to Boost.SIMD [1]).\r\n\r\nOne of the limitation of the current Numpy support of Cython is that it relies\r\non the original Numpy Python module for a lot of computations. The overall idea\r\nis to replace these calls by the Numpy implementation provided within the\r\nPythran project.\r\n\r\nI'll discuss in this mail the various choices that have been made, why and some\r\nimplementation details. Then we'll also show some benchmark to see the\r\npotential improvements, which is the point of all this in the end :)\r\n\r\nPythran limitations\r\n-------------------\r\n\r\nThe Pythran Numpy implementation has some limitations:\r\n\r\n* array \"views\" are not supported. That means that arrays must be stored in\r\n  contiguous memory. Fortran and C-style format are supported.\r\n* the endianness of the integers must be the same that the one of the targeted\r\n  architecture (note that Cython has the same limitation)\r\n\r\nThat's why we did two things:\r\n\r\n* the usage of the Pythran backend needs to be explicitly asked by the user by\r\n  providing the --np-pythran flag to the Cython compiler, or by using the\r\n  \"np_pythran\" flag to the cythonize call (for distutils)\r\n* in function arguments, Numpy buffers are replaced by fused types to be able\r\n  to fall back in case of unsupported buffers. More on this below.\r\n\r\nImplementation choices and details within Cython\r\n------------------------------------------------\r\n\r\na) PythranExpr\r\n\r\nWe defined a new type in PyrexTypes.py, which defines a Pythran buffer or\r\nexpression. A Pythran expression is associated to a Pythran expression\r\ntemplate, whose C++ type can be something like \"decltype(a+b)\". We thus compose\r\nevery expression/function call like this, which allows us to use Pythran's\r\nexpression template mechanism.\r\n\r\nWe also choose to let the C++ compiler deduced the final type of every\r\nexpression, and emit errors if something goes wrong. This choice allows not to\r\nhave to rewrite in Python all the (potentially implicit) conversion rules that\r\ncan apply in a C/C++ program, which could be error prone. The disadvantage is\r\nthat it may generate not that trivial error messages for the end-user.\r\n\r\nb) Fused types for function arguments\r\n\r\nAs Pythran has some limitations about the Numpy buffers it can support, we\r\nchose to replace Numpy buffer arguments by a fused type that can be either a\r\nPythran buffer or the original Numpy buffer. The decision is made to use one\r\ntype or another according to the limitations described above.\r\n\r\nThis allows a fallback to the original Cython implementation in case of an\r\nunsupported buffer type.\r\n\r\nTests\r\n-----\r\n\r\nA flag has been added to the runtests.py script. If provided with a path to a\r\nPythran installation, it will run the C++ tests in \"Pythran\" mode. This allows\r\nto reuse the whole test suite of Cython.\r\n\r\nBenchmark\r\n---------\r\n\r\nThe whole idea of this is to get better performances.\r\n\r\nHere is a simple benchmark of what this mode can achieve, using this cython code:\r\n\r\ndef sqrt_sum(numpy.ndarray[numpy.float_t, ndim=1] a, numpy.ndarray[numpy.float_t, ndim=1] b):\r\n    return numpy.sqrt(numpy.sqrt(a*a+b*b))\r\n\r\nOn my computer (Core i7-6700HQ), this gives there results, with an array of\r\n100000000 32-bit floats as input:\r\n\r\n- for the classical Cython version: 960ms\r\n- for the Cython version using the Pythran backend: 761ms\r\n- for the Cython version using the Pythran backend using SIMD instructions: 243ms\r\n\r\nwhich makes a speedup of ~3.9x using SIMD instructions.\r\n\r\nDocumentation\r\n-------------\r\n\r\nI put an example of how to use this with distutils in the documentation. It\r\ncould be put elsewhere if needed, or formatted differently.",
    "closed_at": null,
    "comment_data": [],
    "comments_url": "https://api.github.com/repos/cython/cython/issues/1607/comments",
    "commit_data": [
        {
            "author": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1874053?v=3",
                "events_url": "https://api.github.com/users/aguinet/events{/privacy}",
                "followers_url": "https://api.github.com/users/aguinet/followers",
                "following_url": "https://api.github.com/users/aguinet/following{/other_user}",
                "gists_url": "https://api.github.com/users/aguinet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/aguinet",
                "id": 1874053,
                "login": "aguinet",
                "organizations_url": "https://api.github.com/users/aguinet/orgs",
                "received_events_url": "https://api.github.com/users/aguinet/received_events",
                "repos_url": "https://api.github.com/users/aguinet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/aguinet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aguinet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/aguinet"
            },
            "comments_url": "https://api.github.com/repos/cython/cython/commits/dd775d02b04334bb5c89b718f56008739aa12219/comments",
            "commit": {
                "author": {
                    "date": "2017-01-15T10:22:37Z",
                    "email": "aguinet@quarkslab.com",
                    "name": "Adrien Guinet"
                },
                "comment_count": 0,
                "committer": {
                    "date": "2017-02-15T20:34:57Z",
                    "email": "aguinet@quarkslab.com",
                    "name": "Adrien Guinet"
                },
                "message": "Add a Pythran backend for Numpy operation\n\nWhen the user asked for it (thanks to the --np-pythran flag), use\nPythran's Numpy implementation as a backend for numpy operation. This\nflag forces the C++ mode, as the Pythran implementation is written in\nC++. Distutils integration through the 'np_pythran' flag of the\ncythonize API is also provided.\n\nThis commit also adds a Pythran mode for the tests, that can enable the\npythran mode for the C++ tests, and allows the reuse of Cython tests to\ntest for the Pythran integration.",
                "tree": {
                    "sha": "17a655a86ff7b27962feaed93aac4e6c74aa43e4",
                    "url": "https://api.github.com/repos/cython/cython/git/trees/17a655a86ff7b27962feaed93aac4e6c74aa43e4"
                },
                "url": "https://api.github.com/repos/cython/cython/git/commits/dd775d02b04334bb5c89b718f56008739aa12219"
            },
            "committer": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1874053?v=3",
                "events_url": "https://api.github.com/users/aguinet/events{/privacy}",
                "followers_url": "https://api.github.com/users/aguinet/followers",
                "following_url": "https://api.github.com/users/aguinet/following{/other_user}",
                "gists_url": "https://api.github.com/users/aguinet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/aguinet",
                "id": 1874053,
                "login": "aguinet",
                "organizations_url": "https://api.github.com/users/aguinet/orgs",
                "received_events_url": "https://api.github.com/users/aguinet/received_events",
                "repos_url": "https://api.github.com/users/aguinet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/aguinet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aguinet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/aguinet"
            },
            "html_url": "https://github.com/cython/cython/commit/dd775d02b04334bb5c89b718f56008739aa12219",
            "parents": [
                {
                    "html_url": "https://github.com/cython/cython/commit/299ad1163ac8e72c1910da3e03013e7634a94b91",
                    "sha": "299ad1163ac8e72c1910da3e03013e7634a94b91",
                    "url": "https://api.github.com/repos/cython/cython/commits/299ad1163ac8e72c1910da3e03013e7634a94b91"
                }
            ],
            "sha": "dd775d02b04334bb5c89b718f56008739aa12219",
            "url": "https://api.github.com/repos/cython/cython/commits/dd775d02b04334bb5c89b718f56008739aa12219"
        }
    ],
    "commits_url": "https://api.github.com/repos/cython/cython/pulls/1607/commits",
    "created_at": "2017-02-15T21:15:08Z",
    "diff_url": "https://github.com/cython/cython/pull/1607.diff",
    "head": {
        "label": "aguinet:feature/pythran",
        "ref": "feature/pythran",
        "repo": {
            "archive_url": "https://api.github.com/repos/aguinet/cython/{archive_format}{/ref}",
            "assignees_url": "https://api.github.com/repos/aguinet/cython/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/aguinet/cython/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/aguinet/cython/branches{/branch}",
            "clone_url": "https://github.com/aguinet/cython.git",
            "collaborators_url": "https://api.github.com/repos/aguinet/cython/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/aguinet/cython/comments{/number}",
            "commits_url": "https://api.github.com/repos/aguinet/cython/commits{/sha}",
            "compare_url": "https://api.github.com/repos/aguinet/cython/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/aguinet/cython/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/aguinet/cython/contributors",
            "created_at": "2017-02-15T18:34:44Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/aguinet/cython/deployments",
            "description": "A Python to C compiler",
            "downloads_url": "https://api.github.com/repos/aguinet/cython/downloads",
            "events_url": "https://api.github.com/repos/aguinet/cython/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/aguinet/cython/forks",
            "full_name": "aguinet/cython",
            "git_commits_url": "https://api.github.com/repos/aguinet/cython/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/aguinet/cython/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/aguinet/cython/git/tags{/sha}",
            "git_url": "git://github.com/aguinet/cython.git",
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_wiki": true,
            "homepage": "http://cython.org",
            "hooks_url": "https://api.github.com/repos/aguinet/cython/hooks",
            "html_url": "https://github.com/aguinet/cython",
            "id": 82093038,
            "issue_comment_url": "https://api.github.com/repos/aguinet/cython/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/aguinet/cython/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/aguinet/cython/issues{/number}",
            "keys_url": "https://api.github.com/repos/aguinet/cython/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/aguinet/cython/labels{/name}",
            "language": "Python",
            "languages_url": "https://api.github.com/repos/aguinet/cython/languages",
            "merges_url": "https://api.github.com/repos/aguinet/cython/merges",
            "milestones_url": "https://api.github.com/repos/aguinet/cython/milestones{/number}",
            "mirror_url": null,
            "name": "cython",
            "notifications_url": "https://api.github.com/repos/aguinet/cython/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1874053?v=3",
                "events_url": "https://api.github.com/users/aguinet/events{/privacy}",
                "followers_url": "https://api.github.com/users/aguinet/followers",
                "following_url": "https://api.github.com/users/aguinet/following{/other_user}",
                "gists_url": "https://api.github.com/users/aguinet/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/aguinet",
                "id": 1874053,
                "login": "aguinet",
                "organizations_url": "https://api.github.com/users/aguinet/orgs",
                "received_events_url": "https://api.github.com/users/aguinet/received_events",
                "repos_url": "https://api.github.com/users/aguinet/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/aguinet/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aguinet/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/aguinet"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/aguinet/cython/pulls{/number}",
            "pushed_at": "2017-02-15T20:35:49Z",
            "releases_url": "https://api.github.com/repos/aguinet/cython/releases{/id}",
            "size": 47681,
            "ssh_url": "git@github.com:aguinet/cython.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/aguinet/cython/stargazers",
            "statuses_url": "https://api.github.com/repos/aguinet/cython/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/aguinet/cython/subscribers",
            "subscription_url": "https://api.github.com/repos/aguinet/cython/subscription",
            "svn_url": "https://github.com/aguinet/cython",
            "tags_url": "https://api.github.com/repos/aguinet/cython/tags",
            "teams_url": "https://api.github.com/repos/aguinet/cython/teams",
            "trees_url": "https://api.github.com/repos/aguinet/cython/git/trees{/sha}",
            "updated_at": "2017-02-15T18:34:49Z",
            "url": "https://api.github.com/repos/aguinet/cython",
            "watchers": 0,
            "watchers_count": 0
        },
        "sha": "dd775d02b04334bb5c89b718f56008739aa12219",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1874053?v=3",
            "events_url": "https://api.github.com/users/aguinet/events{/privacy}",
            "followers_url": "https://api.github.com/users/aguinet/followers",
            "following_url": "https://api.github.com/users/aguinet/following{/other_user}",
            "gists_url": "https://api.github.com/users/aguinet/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/aguinet",
            "id": 1874053,
            "login": "aguinet",
            "organizations_url": "https://api.github.com/users/aguinet/orgs",
            "received_events_url": "https://api.github.com/users/aguinet/received_events",
            "repos_url": "https://api.github.com/users/aguinet/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/aguinet/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/aguinet/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/aguinet"
        }
    },
    "html_url": "https://github.com/cython/cython/pull/1607",
    "id": 106400624,
    "issue_url": "https://api.github.com/repos/cython/cython/issues/1607",
    "locked": false,
    "merge_commit_sha": "4f7bbe2122e996d7a94cbef5f312dbdeb1a5dbd0",
    "merged_at": null,
    "milestone": null,
    "number": 1607,
    "patch_url": "https://github.com/cython/cython/pull/1607.patch",
    "review_comment_url": "https://api.github.com/repos/cython/cython/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/cython/cython/pulls/1607/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/cython/cython/statuses/dd775d02b04334bb5c89b718f56008739aa12219",
    "title": "Add a Pythran backend for Numpy operation",
    "updated_at": "2017-02-15T21:15:08Z",
    "url": "https://api.github.com/repos/cython/cython/pulls/1607",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1874053?v=3",
        "events_url": "https://api.github.com/users/aguinet/events{/privacy}",
        "followers_url": "https://api.github.com/users/aguinet/followers",
        "following_url": "https://api.github.com/users/aguinet/following{/other_user}",
        "gists_url": "https://api.github.com/users/aguinet/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/aguinet",
        "id": 1874053,
        "login": "aguinet",
        "organizations_url": "https://api.github.com/users/aguinet/orgs",
        "received_events_url": "https://api.github.com/users/aguinet/received_events",
        "repos_url": "https://api.github.com/users/aguinet/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/aguinet/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/aguinet/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/aguinet"
    }
}